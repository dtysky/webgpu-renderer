(()=>{var e={1715:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] texcoord_0: vec2<f32>;\n  [[location(1)]] normal: vec3<f32>;\n  [[location(2)]] tangent: vec4<f32>;\n  [[location(3)]] color_0: vec3<f32>;\n  [[location(4)]] texcoord_1: vec2<f32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  var color: vec4<f32> = material.u_color;\n\n  #if defined(USE_COLOR_0)\n    color = color * vec4<f32>(vo.color_0, 1.);\n  #endif\n\n  return color;\n}\n"},1821:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] texcoord_0: vec2<f32>;\n  [[location(1)]] normal: vec3<f32>;\n  [[location(2)]] tangent: vec4<f32>;\n  [[location(3)]] color_0: vec3<f32>;\n  [[location(4)]] texcoord_1: vec2<f32>;\n};\n\n[[stage(vertex)]]\nfn main(attrs: Attrs) -> VertexOutput {\n  var output: VertexOutput;\n\n  output.Position = global.u_vp * mesh.u_world * vec4<f32>(attrs.position, 1.);\n\n  #if defined(USE_TEXCOORD_0)\n    output.texcoord_0 = attrs.texcoord_0;\n  #endif\n\n  #if defined(USE_NORMAL)\n    output.normal = attrs.normal;\n  #endif\n\n  #if defined(USE_TANGENT)\n    output.tangent = attrs.tangent;\n  #endif\n\n  #if defined(USE_COLOR_0)\n    output.color_0 = attrs.color_0;\n  #endif\n\n  #if defined(USE_TEXCOORD_1)\n    output.texcoord_1 = attrs.texcoord_1;\n  #endif\n\n  return output;\n}\n"},3718:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] cubeUV: vec3<f32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  let tex: vec4<f32> = textureSample(u_cubeTexture, u_sampler, vo.cubeUV);\n  return vec4<f32>(tex.rgb * material.u_color.rgb * material.u_exposure * material.u_factor, tex.a);\n}\n"},2705:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] cubeUV: vec3<f32>;\n};\n\n[[stage(vertex)]]\nfn main(attrs: Attrs) -> VertexOutput {\n  var output: VertexOutput;\n\n  let pos: vec4<f32> = vec4<f32>(attrs.position, 1., 1.);\n  output.position = pos;\n  let t: vec4<f32> = global.u_skyVP * pos;\n  output.cubeUV = normalize(t.xyz / t.w);\n\n  return output;\n}\n"},933:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] texcoord_0: vec2<f32>;\n  [[location(1)]] normal: vec3<f32>;\n  [[location(2)]] tangent: vec4<f32>;\n  [[location(3)]] color_0: vec3<f32>;\n  [[location(4)]] texcoord_1: vec2<f32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  return material.u_baseColorFactor * textureSample(u_baseColorTexture, u_sampler, vo.texcoord_0);\n}\n"},5128:e=>{e.exports="let c_radius: i32 = ${RADIUS};\nlet c_windowSize: i32 = ${WINDOW_SIZE};\n\n[[stage(compute), workgroup_size(c_windowSize, c_windowSize, 1)]]\nfn main(\n  [[builtin(workgroup_id)]] workGroupID : vec3<u32>,\n  [[builtin(local_invocation_id)]] localInvocationID : vec3<u32>\n) {\n  let size: vec2<i32> = textureDimensions(u_input, 0);\n  let windowSize: vec2<i32> = vec2<i32>(c_windowSize, c_windowSize);\n  let groupOffset: vec2<i32> = vec2<i32>(workGroupID.xy) * windowSize;\n  let baseIndex: vec2<i32> = groupOffset + vec2<i32>(localInvocationID.xy);\n  let baseUV: vec2<f32> = vec2<f32>(baseIndex) / vec2<f32>(size);\n\n  var weightsSum: f32 = 0.;\n  var res: vec4<f32> = vec4<f32>(0., 0., 0., 1.);\n  for (var r: i32 = -c_radius; r <= c_radius; r = r + 1) {\n    for (var c: i32 = -c_radius; c <= c_radius; c = c + 1) {\n      let iuv: vec2<i32> = baseIndex + vec2<i32>(r, c);\n\n      if (any(iuv < vec2<i32>(0)) || any(iuv >= size)) {\n        continue;\n      }\n\n      let weightIndex: i32 = (r + c_radius) * c_windowSize + (c + c_radius);\n      let weight: f32 = material.u_kernel[weightIndex / 4][weightIndex % 4];\n      weightsSum = weightsSum + weight;\n      res = res + weight * textureLoad(u_input, iuv, 0);\n    }\n  }\n  res = res / f32(weightsSum);\n\n  textureStore(u_output, baseIndex, res);\n}\n"},4784:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] uv: vec2<f32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  return textureSample(u_texture, u_sampler, vo.uv);\n}\n"},2177:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] uv: vec2<f32>;\n};\n\nvar<private> pos: array<vec2<f32>, 6> = array<vec2<f32>, 6>(\n  vec2<f32>(-1.0, -1.0),\n  vec2<f32>(1.0, -1.0),\n  vec2<f32>(-1.0, 1.0),\n  vec2<f32>(-1.0, 1.0),\n  vec2<f32>(1.0, -1.0),\n  vec2<f32>(1.0, 1.0)\n);\nvar<private> uv: array<vec2<f32>, 6> = array<vec2<f32>, 6>(\n  vec2<f32>(0.0, 1.0),\n  vec2<f32>(1.0, 1.0),\n  vec2<f32>(0.0, 0.0),\n  vec2<f32>(0.0, 0.0),\n  vec2<f32>(1.0, 1.0),\n  vec2<f32>(1.0, 0.0)\n);\n\n[[stage(vertex)]]\nfn main([[builtin(vertex_index)]] VertexIndex : u32) -> VertexOutput {\n  var output: VertexOutput;\n\n  output.position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n  output.uv = uv[VertexIndex];\n\n  #if defined(FLIP)\n    output.uv.y = 1. - output.uv.y;\n  #endif\n\n  return output;\n}\n"},9682:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] uv: vec2<f32>;\n};\n\nlet A: f32 = 2.51;\nlet B: f32 = 0.03;\nlet C: f32 = 2.43;\nlet D: f32 = 0.59;\nlet E: f32 = 0.14;\t\n\nfn acesToneMapping(color: vec3<f32>) -> vec3<f32> {\n  return (color * (A * color + B)) / (color * (C * color + D) + E); \n}\n\nfn gammaCorrect(color: vec3<f32>) -> vec3<f32> {\n  return pow(color, vec3<f32>(0.45454545454545453));\n}\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  let hdrColor: vec4<f32> = textureSample(u_texture, u_sampler, vo.uv);\n  var color = acesToneMapping(hdrColor.rgb);\n\n  return vec4<f32>(color, hdrColor.a);\n}\n"},5536:e=>{e.exports="let WINDOW_SIZE: i32 = ${WINDOW_SIZE};\n\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/basic/tone.chunk.wgsl\nlet A: f32 = 2.51;\nlet B: f32 = 0.03;\nlet C: f32 = 2.43;\nlet D: f32 = 0.59;\nlet E: f32 = 0.14;\t\n\nfn acesToneMapping(color: vec3<f32>) -> vec3<f32> {\n  return (color * (A * color + B)) / (color * (C * color + D) + E); \n}\n\nfn gammaCorrect(color: vec3<f32>, gamma: f32) -> vec3<f32> {\n  return pow(color, vec3<f32>(1. / gamma));\n}\n\n//require end\n;\n\nfn calcWeightNumber(params: vec2<f32>, a: f32, b: f32) -> f32 {\n  return params.x * exp(params.y * (a - b) * (a - b));\n}\n\nfn calcWeightVec2(params: vec2<f32>, a: vec2<i32>, b: vec2<i32>) -> f32 {\n  let diff: vec2<f32> = vec2<f32>(a - b);\n  return params.x * exp(params.y * dot(diff, diff));\n}\n\nfn calcWeightVec3(params: vec2<f32>, a: vec3<f32>, b: vec3<f32>) -> f32 {\n  let diff: vec3<f32> = a - b;\n  return params.x * exp(params.y * dot(diff, diff));\n}\n\nfn calcLum(color: vec3<f32>) -> f32 {\n  return dot(color, vec3<f32>(0.2125, 0.7154, 0.0721));\n}\n\nfn blur(center: vec2<i32>, size: vec2<i32>) -> vec4<f32> {\n  let radius: i32 = WINDOW_SIZE / 2;\n  let zigmaD: vec2<f32> = material.u_filterFactors[0].xy;\n  let zigmaC: vec2<f32> = material.u_filterFactors[1].xy;\n  let zigmaZ: vec2<f32> = material.u_filterFactors[2].xy;\n  let zigmaN: vec2<f32> = material.u_filterFactors[3].xy;\n  let centerColor: vec4<f32> = textureLoad(u_mixed, center, 0);\n  let centerPosition = textureLoad(u_gbPositionMetalOrSpec, center, 0).xyz;\n  let centerNormal = textureLoad(u_gbNormalGlass, center, 0).xyz;\n  var colors: array<array<vec3<f32>, ${WINDOW_SIZE}>, ${WINDOW_SIZE}>;\n  var lums: array<array<f32, ${WINDOW_SIZE}>, ${WINDOW_SIZE}>;\n\n  var minUV: vec2<i32> = max(center - vec2<i32>(radius, radius), vec2<i32>(0));\n  var maxUV: vec2<i32> = min(center + vec2<i32>(radius, radius), size);\n  var localUV: vec2<i32> = vec2<i32>(0, 0);\n  var sumLum: f32 = 0.;\n  var count: f32 = 0.;\n\n  for (var r: i32 = minUV.x; r <= maxUV.x; r = r + 1) {\n    localUV.y = 0;\n    for (var c: i32 = minUV.y; c <= maxUV.y; c = c + 1) {\n      let iuv: vec2<i32> = vec2<i32>(r, c);\n      let color: vec3<f32> = textureLoad(u_mixed, iuv, 0).rgb;\n      let lum: f32 = calcLum(color);\n      colors[localUV.x][localUV.y] = color;\n      lums[localUV.x][localUV.y] = lum;\n\n      sumLum = sumLum + lum;\n      count = count + 1.;\n      localUV.y = localUV.y + 1;\n    }\n    localUV.x = localUV.x + 1;\n  }\n\n  let meanLum: f32 = sumLum / count;\n\n  var std: f32 = 0.;\n  for (var r: i32 = 0; r < localUV.x; r = r + 1) {\n    for (var c: i32 = 0; c < localUV.y; c = c + 1) {\n      let lum: f32 = lums[r][c];\n      std = std + (lum - meanLum) * (lum - meanLum);\n    }\n  }\n  std = sqrt(std / (count - 1.));\n\n  let largestLum: f32 = max(meanLum + std * 2., 1.);\n\n  localUV = vec2<i32>(0, 0);\n  var weightsSum: f32 = 0.;\n  var res: vec3<f32> = vec3<f32>(0., 0., 0.);\n\n  for (var r: i32 = minUV.x; r <= maxUV.x; r = r + 1) {\n    localUV.y = 0;\n    for (var c: i32 = minUV.y; c <= maxUV.y; c = c + 1) {\n      var color: vec3<f32> = colors[localUV.x][localUV.y];\n      let lum: f32 = lums[localUV.x][localUV.y];\n\n      if (lum > largestLum) {\n        color = color * meanLum / lum;\n      }\n\n      let iuv: vec2<i32> = vec2<i32>(r, c);\n      let position: vec4<f32> = textureLoad(u_gbPositionMetalOrSpec, iuv, 0);\n      let normal: vec4<f32> = textureLoad(u_gbNormalGlass, iuv, 0);\n      let weight: f32 = calcWeightVec2(zigmaD, iuv, center)\n        * calcWeightVec3(zigmaC, color.rgb, centerColor.rgb)\n        * calcWeightVec3(zigmaN, normal.xyz, centerNormal.xyz)\n        * calcWeightNumber(zigmaZ, position.z, centerPosition.z);\n      weightsSum = weightsSum + weight;\n      res = res + weight * color;\n\n      localUV.y = localUV.y + 1;\n    }\n    localUV.x = localUV.x + 1;\n  }\n\n  res = res / weightsSum;\n\n  return vec4<f32>(res, centerColor.a);\n}\n\n[[stage(compute), workgroup_size(16, 16, 1)]]\nfn main(\n  [[builtin(workgroup_id)]] workGroupID : vec3<u32>,\n  [[builtin(local_invocation_id)]] localInvocationID : vec3<u32>\n) {\n  let size: vec2<i32> = textureDimensions(u_mixed);\n  let groupOffset: vec2<i32> = vec2<i32>(workGroupID.xy) * 16;\n  let baseIndex: vec2<i32> = groupOffset + vec2<i32>(localInvocationID.xy);\n\n  var mixed: vec4<f32>;\n\n  mixed = blur(baseIndex, size);\n\n\n  textureStore(u_output, baseIndex, vec4<f32>(acesToneMapping(mixed.rgb), mixed.a));\n}\n"},1708:e=>{e.exports="[[stage(compute), workgroup_size(16, 16, 1)]]\nfn main(\n  [[builtin(workgroup_id)]] workGroupID : vec3<u32>,\n  [[builtin(local_invocation_id)]] localInvocationID : vec3<u32>\n) {\n  let size: vec2<i32> = textureDimensions(u_current);\n  let groupOffset: vec2<i32> = vec2<i32>(workGroupID.xy) * 16;\n  let baseIndex: vec2<i32> = groupOffset + vec2<i32>(localInvocationID.xy);\n\n  let pre: vec4<f32> = textureLoad(u_pre, baseIndex, 0);\n  let current: vec4<f32> = textureLoad(u_current, baseIndex, 0);\n  let mixed: vec4<f32> = vec4<f32>(mix(current.rgb, pre.rgb, vec3<f32>(material.u_preWeight)), current.a);\n\n  textureStore(u_output, baseIndex, mixed);\n}\n"},4413:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] wPosition: vec4<f32>;\n  [[location(1)]] texcoord_0: vec2<f32>;\n  [[location(2)]] normal: vec3<f32>;\n  [[location(3)]] meshMatIndex: vec2<u32>;\n};\n\nstruct FragmentOutput {\n  [[location(0)]] positionMetalOrSpec: vec4<f32>;\n  [[location(1)]] baseColorRoughOrGloss: vec4<f32>;\n  [[location(2)]] normalGlass: vec4<f32>;\n  [[location(3)]] meshIndexMatIndexMatType: vec4<u32>;\n};\n\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/common.chunk.wgsl\nlet MAT_TYPE_METAL_ROUGH: u32 = 0u;\nlet MAT_TYPE_SPEC_GLOSS: u32 = 1u;\nlet MAT_TYPE_GLASS_METAL_ROUGH: u32 = 2u;\nlet MAT_TYPE_GLASS_SPEC_GLOSS: u32 = 3u;\nlet MAT_TYPE_LIGHT: u32 = 4u;\n\nfn isMatSpecGloss(matType: u32) -> bool {\n  return matType == MAT_TYPE_SPEC_GLOSS || matType == MAT_TYPE_GLASS_SPEC_GLOSS;\n}\n\nfn isMatGlass(matType: u32) -> bool {\n  return matType == MAT_TYPE_GLASS_METAL_ROUGH || matType == MAT_TYPE_GLASS_SPEC_GLOSS;\n}\n\nfn isMatLight(matType: u32) -> bool {\n  return matType == MAT_TYPE_LIGHT;\n}\n\nfn getRoughness(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).g;\n}\n\nfn getMetallic(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).b;\n}\n\nfn getSpecular(factor: vec3<f32>, textureId: i32, uv: vec2<f32>) -> vec3<f32> {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).rgb;\n}\n\nfn getGlossiness(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).a;\n}\n\nfn getBaseColor(factor: vec4<f32>, textureId: i32, uv: vec2<f32>) -> vec4<f32> {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_baseColorTextures, u_sampler, uv, textureId, 0.);\n}\n\n//require end\n;\n\nfn getFaceNormal(position: vec3<f32>) -> vec3<f32> {\n  return normalize(cross(dpdy(position), dpdx(position)));\n}\n\nfn getNormal(\n  vNormal: vec3<f32>, position: vec3<f32>, faceNormal: vec3<f32>,\n  textureId: i32, uv: vec2<f32>, normalScale: f32\n) -> vec3<f32> {\n  var normal: vec3<f32> = normalize(vNormal);\n  normal = normal * sign(dot(normal, faceNormal));\n\n  if (textureId == -1) {\n    return normal;\n  }\n\n  // http://www.thetenthplanet.de/archives/1180\n  let dp1: vec3<f32> = dpdx(position);\n  let dp2: vec3<f32> = dpdy(position);\n  let duv1: vec2<f32> = dpdx(uv);\n  let duv2: vec2<f32> = dpdy(uv);\n  let dp2perp: vec3<f32> = cross(dp2, normal);\n  let dp1perp: vec3<f32> = cross(normal, dp1);\n  var dpdu: vec3<f32> = dp2perp * duv1.x + dp1perp * duv2.x;\n  var dpdv: vec3<f32> = dp2perp * duv1.y + dp1perp * duv2.y;\n  let invmax: f32 = inverseSqrt(max(dot(dpdu, dpdu), dot(dpdv, dpdv)));\n  dpdu = dpdu * invmax;\n  dpdv = dpdv * invmax;\n  let tbn: mat3x3<f32> = mat3x3<f32>(dpdu, dpdv, normal);\n  var tNormal: vec3<f32> = 2. * textureSample(u_normalTextures, u_sampler, uv, textureId).xyz - 1.;\n  tNormal = tNormal * vec3<f32>(normalScale, normalScale, 1.);\n\n  return normalize(tbn * tNormal);\n}\n\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> FragmentOutput {\n  var fo: FragmentOutput;\n\n  let meshId: u32 = vo.meshMatIndex[0];\n  let matId: u32 = vo.meshMatIndex[1];\n  let metallicRoughnessFactorNormalScaleMaterialType: vec4<f32> = material.u_metallicRoughnessFactorNormalScaleMaterialTypes[matId];\n  let specularGlossinessFactor: vec4<f32> = material.u_specularGlossinessFactors[matId];\n  let textureIds: vec4<i32> = material.u_matId2TexturesId[matId];\n  let matType = u32(metallicRoughnessFactorNormalScaleMaterialType[3]);\n  let isSpecGloss: bool = isMatSpecGloss(matType);\n\n  fo.positionMetalOrSpec = vec4<f32>(vo.wPosition.xyz, 0.);\n\n  let baseColor: vec4<f32> = getBaseColor(material.u_baseColorFactors[matId], textureIds[0], vo.texcoord_0);\n  fo.baseColorRoughOrGloss = vec4<f32>(baseColor.rgb, 0.);\n\n  if (isSpecGloss) {\n    fo.positionMetalOrSpec.w = getSpecular(specularGlossinessFactor.xyz, textureIds[2], vo.texcoord_0).r;\n    fo.baseColorRoughOrGloss.w = getGlossiness(specularGlossinessFactor[3], textureIds[2], vo.texcoord_0);\n  } else {\n    fo.positionMetalOrSpec.w = getMetallic(metallicRoughnessFactorNormalScaleMaterialType[0], textureIds[2], vo.texcoord_0);\n    fo.baseColorRoughOrGloss.w = getRoughness(metallicRoughnessFactorNormalScaleMaterialType[1], textureIds[2], vo.texcoord_0);\n  }\n\n  let faceNormal: vec3<f32> = getFaceNormal(vo.wPosition.xyz);\n  fo.normalGlass = vec4<f32>(\n    getNormal(vo.normal, vo.wPosition.xyz, faceNormal, textureIds[1], vo.texcoord_0, metallicRoughnessFactorNormalScaleMaterialType[2]),\n    baseColor.a\n  );\n\n  // alpha is used for judge hited\n  fo.meshIndexMatIndexMatType = vec4<u32>(meshId, matId, matType, 2u);\n\n  return fo;\n}\n"},9286:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] wPosition: vec4<f32>;\n  [[location(1)]] texcoord_0: vec2<f32>;\n  [[location(2)]] normal: vec3<f32>;\n  [[location(3)]] meshMatIndex: vec2<u32>;\n};\n\n[[stage(vertex)]]\nfn main(attrs: Attrs) -> VertexOutput {\n  var output: VertexOutput;\n  \n  let wPosition: vec4<f32> = vec4<f32>(attrs.position, 1.);\n  \n  output.position = global.u_vp * wPosition;\n  output.wPosition = wPosition;\n  output.texcoord_0 = attrs.texcoord_0;\n  output.normal = attrs.normal;\n  output.meshMatIndex.x = attrs.meshMatIndex.x;\n  output.meshMatIndex.y = attrs.meshMatIndex.y;\n\n  return output;\n}\n"},461:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] Position: vec4<f32>;\n  [[location(0)]] texcoord_0: vec2<f32>;\n  [[location(1)]] normal: vec3<f32>;\n  [[location(2)]] tangent: vec4<f32>;\n  [[location(3)]] color_0: vec3<f32>;\n  [[location(4)]] texcoord_1: vec2<f32>;\n};\n\nstruct FragmentOutput {\n  [[location(0)]] positionMetalOrSpec: vec4<f32>;\n  [[location(1)]] baseColorRoughOrGloss: vec4<f32>;\n  [[location(2)]] normalGlass: vec4<f32>;\n  [[location(3)]] meshIndexMatIndexMatType: vec4<u32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> FragmentOutput {\n  var fo: FragmentOutput;\n\n  fo.baseColorRoughOrGloss = vec4<f32>(material.u_lightColor.rgb, 0.);\n  fo.meshIndexMatIndexMatType = vec4<u32>(0u, 0u, 4u, 2u);\n\n  return fo;\n}\n"},5050:e=>{e.exports="struct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] uv: vec2<f32>;\n};\n\n[[stage(fragment)]]\nfn main(vo: VertexOutput) -> [[location(0)]] vec4<f32> {\n  let uv: vec2<f32> = vo.uv;\n\n  if (uv.x < .33) {\n    return vec4<f32>(textureSample(u_gbPositionMetalOrSpec, u_sampler, uv).rgb, 1.);\n  }\n  \n  if (uv.x < .66) {\n    return vec4<f32>(textureSample(u_gbBaseColorRoughOrGloss, u_sampler, uv).rgb, 1.);\n  }\n  \n  return vec4<f32>(textureSample(u_gbNormalGlass, u_sampler, uv).rgb, 1.);\n}\n"},1540:e=>{e.exports="let PI: f32 = 3.14159265358979;\nlet MAX_LIGHTS_COUNT: u32 = 4u;\nlet MAX_RAY_LENGTH: f32 = 9999.;\nlet BVH_DEPTH: i32 = ${BVH_DEPTH};\nlet EPS: f32 = 0.005;\nlet RAY_DIR_OFFSET: f32 = .01;\nlet RAY_NORMAL_OFFSET: f32 = .01;\n\nstruct VertexOutput {\n  [[builtin(position)]] position: vec4<f32>;\n  [[location(0)]] uv: vec2<f32>;\n};\n\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/basic/common.chunk.wgsl\nlet LIGHT_TYPE_INVALID: u32 = 0u;\nlet LIGHT_TYPE_AREA: u32 = 1u;\nlet LIGHT_TYPE_DIRECTIONAL: u32 = 2u;\nlet LIGHT_TYPE_POINT: u32 = 3u;\nlet LIGHT_TYPE_SPOT: u32 = 4u;\n\nlet LIGHT_AREA_RRCT: u32 = 0u;\nlet LIGHT_AREA_DISC: u32 = 1u;\n\n//require end\n;\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/common.chunk.wgsl\nlet MAT_TYPE_METAL_ROUGH: u32 = 0u;\nlet MAT_TYPE_SPEC_GLOSS: u32 = 1u;\nlet MAT_TYPE_GLASS_METAL_ROUGH: u32 = 2u;\nlet MAT_TYPE_GLASS_SPEC_GLOSS: u32 = 3u;\nlet MAT_TYPE_LIGHT: u32 = 4u;\n\nfn isMatSpecGloss(matType: u32) -> bool {\n  return matType == MAT_TYPE_SPEC_GLOSS || matType == MAT_TYPE_GLASS_SPEC_GLOSS;\n}\n\nfn isMatGlass(matType: u32) -> bool {\n  return matType == MAT_TYPE_GLASS_METAL_ROUGH || matType == MAT_TYPE_GLASS_SPEC_GLOSS;\n}\n\nfn isMatLight(matType: u32) -> bool {\n  return matType == MAT_TYPE_LIGHT;\n}\n\nfn getRoughness(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).g;\n}\n\nfn getMetallic(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).b;\n}\n\nfn getSpecular(factor: vec3<f32>, textureId: i32, uv: vec2<f32>) -> vec3<f32> {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).rgb;\n}\n\nfn getGlossiness(factor: f32, textureId: i32, uv: vec2<f32>) -> f32 {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_metalRoughOrSpecGlossTextures, u_sampler, uv, textureId, 0.).a;\n}\n\nfn getBaseColor(factor: vec4<f32>, textureId: i32, uv: vec2<f32>) -> vec4<f32> {\n  if (textureId == -1) {\n    return factor;\n  }\n\n  return factor * textureSampleLevel(u_baseColorTextures, u_sampler, uv, textureId, 0.);\n}\n\n//require end\n;\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/pbr/common.chunk.wgsl\nstruct PBRData {\n  reflectance0: vec3<f32>;\n  reflectance90: vec3<f32>;\n  alphaRoughness: f32;\n  diffuseColor: vec3<f32>;\n  specularColor: vec3<f32>;\n  baseColor: vec3<f32>;\n  ao: vec3<f32>;\n  roughness: f32;\n};\n\nfn pbrSpecularReflection(reflectance0: vec3<f32>, reflectance90: vec3<f32>, VdotH: f32)-> vec3<f32> {\n  return reflectance0 + (reflectance90 - reflectance0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\nfn pbrGeometricOcclusion(NdotL: f32, NdotV: f32, alphaRoughness: f32)-> f32 {\n  let r: f32 = alphaRoughness * alphaRoughness;\n\n  let attenuationL: f32 = 2.0 * NdotL / (NdotL + sqrt(r + (1.0 - r) * (NdotL * NdotL)));\n  let attenuationV: f32 = 2.0 * NdotV / (NdotV + sqrt(r + (1.0 - r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\nfn pbrMicrofacetDistribution(alphaRoughness: f32, NdotH: f32)-> f32 {\n  let roughnessSq: f32 = alphaRoughness * alphaRoughness;\n  let f: f32 = NdotH * NdotH * (roughnessSq - NdotH) + 1.0;\n  return roughnessSq * 0.3183098861837907 / (f * f);\n}\n\nfn pbrPrepareData(\n  isSpecGloss: bool,\n  baseColor: vec3<f32>,\n  metal: f32, rough: f32,\n  spec: vec3<f32>, gloss: f32\n) -> PBRData {\n  var pbr: PBRData;\n\n  var specularColor: vec3<f32>;\n  var roughness: f32;\n\n  // metallic roughness\n  if (!isSpecGloss) {\n    roughness = clamp(rough, 0.04, 1.0);\n    let metallic: f32 = clamp(metal, 0.0, 1.0);\n    let f0: vec3<f32> = vec3<f32>(0.04, 0.04, 0.04);\n\n    specularColor = mix(f0, baseColor, vec3<f32>(metallic));\n    pbr.diffuseColor = (1.0 - metallic) * (baseColor * (vec3<f32>(1.0, 1.0, 1.0) - f0));\n  }\n  else {\n  // specular glossiness\n    roughness = 1.0 - gloss;\n    specularColor = spec;\n    pbr.diffuseColor = baseColor * (1.0 - max(max(specularColor.r, specularColor.g), specularColor.b));\n  }\n  \n  pbr.baseColor = baseColor;\n  pbr.specularColor = specularColor;\n  pbr.roughness = roughness;\n  \n  let reflectance: f32 = max(max(specularColor.r, specularColor.g), specularColor.b);\n  pbr.reflectance90 = vec3<f32>(clamp(reflectance * 25.0, 0.0, 1.0));\n  pbr.reflectance0 = specularColor.rgb;\n  pbr.alphaRoughness = roughness * roughness;\n\n  return pbr;\n}\n\nfn pbrCalculateLo(\n  pbr: PBRData, normal: vec3<f32>,\n  viewDir: vec3<f32>, lightDir: vec3<f32>\n)-> vec3<f32> {\n  let H: vec3<f32> = normalize(lightDir + viewDir);\n  let NdotV: f32 = clamp(abs(dot(normal, viewDir)), 0.001, 1.0);\n  let NdotL: f32 = clamp(dot(normal, lightDir), 0.001, 1.0);\n  let NdotH: f32 = clamp(dot(normal, H), 0.0, 1.0);\n  let LdotH: f32 = clamp(abs(dot(lightDir, H)), 0.0, 1.0);\n  let VdotH: f32 = clamp(dot(viewDir, H), 0.0, 1.0);\n  // Calculate the shading terms for the microfacet specular shading model\n  let F: vec3<f32> = pbrSpecularReflection(pbr.reflectance0, pbr.reflectance90, VdotH);\n  let G: f32 = pbrGeometricOcclusion(NdotL, NdotV, pbr.alphaRoughness);\n  let D: f32 = pbrMicrofacetDistribution(pbr.alphaRoughness, NdotH);\n\n  let specContrib: vec3<f32> = F * G * D / (4.0 * NdotL * NdotV);\n  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n  return NdotL * specContrib;\n}\n\n//require end\n;\n\nstruct Ray {\n  origin: vec3<f32>;\n  dir: vec3<f32>;\n  invDir: vec3<f32>;\n};\n\nstruct HitPoint {\n  hit: bool;\n  hited: f32;\n  position: vec3<f32>;\n  baseColor: vec3<f32>;\n  metal: f32;\n  rough: f32;\n  spec: vec3<f32>;\n  gloss: f32;\n  glass: f32;\n  normal: vec3<f32>;\n  // sign: if render back, is -1, or 1\n  sign: f32;\n  meshIndex: u32;\n  matIndex: u32;\n  isSpecGloss: bool;\n  isGlass: bool;\n  isLight: bool;\n  matType: u32;\n  pbrData: PBRData;\n};\n\nstruct Light {\n  color: vec3<f32>;\n  throughEng: vec3<f32>;\n  next: Ray;\n};\n\nstruct BVHNode {\n  child0Index: u32;\n  child1Index: u32;\n  max: vec3<f32>;\n  min: vec3<f32>;\n};\n\nstruct BVHLeaf {\n  primitives: u32;\n  indexes: vec3<u32>;\n};\n\nstruct FragmentInfo {\n  hit: bool;\n  hitPoint: vec3<f32>;\n  t: f32;\n  // areal coordinates\n  weights: vec3<f32>;\n  p0: vec3<f32>;\n  p1: vec3<f32>;\n  p2: vec3<f32>;\n  uv0: vec2<f32>;\n  uv1: vec2<f32>;\n  uv2: vec2<f32>;\n  n0: vec3<f32>;\n  n1: vec3<f32>;\n  n2: vec3<f32>;\n  meshIndex: u32;\n  matIndex: u32;\n  matType: u32;\n};\n\nstruct Child {\n  isLeaf: bool;\n  offset: u32;\n};\n\nfn getRandom(uv: vec2<f32>, i: i32) -> vec4<f32> {\n  let noise: vec4<f32> = textureSampleLevel(u_noise, u_sampler, uv, 0.);\n\n  return fract(material.u_randoms[i] + noise);\n}\n\nfn genRay(origin: vec3<f32>, dir: vec3<f32>) -> Ray {\n  var ray: Ray;\n  ray.origin = origin;\n  ray.dir = dir;\n  ray.invDir = 1. / ray.dir;\n\n  return ray;\n}\n\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/gbInfo.chunk.wgsl\nfn genWorldRayByGBuffer(uv: vec2<f32>, gBInfo: HitPoint) -> Ray {\n  let pixelSSPos: vec4<f32> = vec4<f32>(uv.x * 2. - 1., 1. - uv.y * 2., 0., 1.);\n  var pixelWorldPos: vec4<f32> = global.u_viewInverse * global.u_projInverse * pixelSSPos;\n  pixelWorldPos = pixelWorldPos / pixelWorldPos.w;\n\n  return genRay(pixelWorldPos.xyz, normalize(gBInfo.position - pixelWorldPos.xyz));\n};\n\nfn getGBInfo(index: vec2<i32>) -> HitPoint {\n  var info: HitPoint;\n\n  let wPMtlSpec: vec4<f32> = textureLoad(u_gbPositionMetalOrSpec, index, 0);\n  let dfRghGls: vec4<f32> = textureLoad(u_gbBaseColorRoughOrGloss, index, 0);\n  let nomGlass: vec4<f32> = textureLoad(u_gbNormalGlass, index, 0);\n  let meshIdMatIdMatType: vec4<u32> = textureLoad(u_gbMeshIndexMatIndexMatType, index, 0);\n\n  info.position = wPMtlSpec.xyz;\n  info.metal = wPMtlSpec.w;\n  info.baseColor = dfRghGls.xyz;\n  info.rough = dfRghGls.w;\n  info.spec = vec3<f32>(wPMtlSpec.w);\n  info.gloss = dfRghGls.w;\n  info.normal = nomGlass.xyz;\n  info.sign = 1.;\n  info.glass = nomGlass.w;\n  info.meshIndex = meshIdMatIdMatType.x;\n  info.matIndex = meshIdMatIdMatType.y;\n  let matType: u32 = meshIdMatIdMatType.z;\n  info.hit = meshIdMatIdMatType.w == 2u;\n  info.hited = f32(meshIdMatIdMatType.w);\n  info.isSpecGloss = isMatSpecGloss(matType);\n  info.isGlass = isMatGlass(matType);\n  info.isLight = info.hit && isMatLight(matType);\n  info.matType = matType;\n  info.pbrData = pbrPrepareData(info.isSpecGloss, info.baseColor, info.metal, info.rough, info.spec, info.gloss);\n\n  return info;\n};\n\n//require end\n;\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/hitTest.chunk.wgsl\nfn decodeChild(index: u32) -> Child {\n  return Child((index >> 31u) != 0u, (index << 1u) >> 1u);\n}\n\nfn getBVHNodeInfo(offset: u32) -> BVHNode {\n  var node: BVHNode;\n  let data0: vec4<f32> = u_bvh.value[offset];\n  let data1: vec4<f32> = u_bvh.value[offset + 1u];\n  node.child0Index = bitcast<u32>(data0[0]);\n  node.child1Index = bitcast<u32>(data1[0]);\n  node.min = data0.yzw;\n  node.max = data1.yzw;\n\n  return node;\n}\n\nfn getBVHLeafInfo(offset: u32) -> BVHLeaf {\n  var leaf: BVHLeaf;\n  let data1: vec4<f32> = u_bvh.value[offset];\n  leaf.primitives = bitcast<u32>(data1.x);\n  leaf.indexes.x = bitcast<u32>(data1.y);\n  leaf.indexes.y = bitcast<u32>(data1.z);\n  leaf.indexes.z = bitcast<u32>(data1.w);\n\n  return leaf;\n}\n\nfn getFaceNormal(frag: FragmentInfo) -> vec3<f32> {\n  return normalize(cross(frag.p1 - frag.p0, frag.p2 - frag.p0));\n}\n\nfn getNormal(\n  frag: FragmentInfo, uv: vec2<f32>,\n  textureId: i32, normalScale: f32\n) -> vec3<f32> {\n  var normal: vec3<f32> = normalize(\n    frag.n0 * frag.weights[0] + frag.n0 * frag.weights[1] + frag.n0 * frag.weights[2]\n  );\n  normal = normal;\n\n  if (textureId == -1) {\n    return normal;\n  }\n\n  // // http://www.thetenthplanet.de/archives/1180\n  let dp1: vec3<f32> = frag.p1 - frag.p0;\n  let dp2: vec3<f32> = frag.p2 - frag.p0;\n  let duv1: vec2<f32> = frag.uv2 - frag.uv0;\n  let duv2: vec2<f32> = frag.uv1 - frag.uv0;\n  let dp2perp: vec3<f32> = cross(dp2, normal);\n  let dp1perp: vec3<f32> = cross(normal, dp1);\n  var dpdu: vec3<f32> = dp2perp * duv1.x + dp1perp * duv2.x;\n  var dpdv: vec3<f32> = dp2perp * duv1.y + dp1perp * duv2.y;\n  let invmax: f32 = inverseSqrt(max(dot(dpdu, dpdu), dot(dpdv, dpdv)));\n  dpdu = dpdu * invmax;\n  dpdv = dpdv * invmax;\n  let tbn: mat3x3<f32> = mat3x3<f32>(dpdu, dpdv, normal);\n  var tNormal: vec3<f32> = 2. * textureSampleLevel(u_normalTextures, u_sampler, uv, textureId, 0.).xyz - 1.;\n  tNormal = tNormal * vec3<f32>(normalScale, normalScale, 1.);\n\n  return normalize(tbn * tNormal);\n}\n\n// https://tavianator.com/2011/ray_box.html\nfn boxHitTest(ray: Ray, max: vec3<f32>, min: vec3<f32>) -> f32 {\n  let t1: vec3<f32> = (min - ray.origin) * ray.invDir;\n  let t2: vec3<f32> = (max - ray.origin) * ray.invDir;\n  let tvmin: vec3<f32> = min(t1, t2);\n  let tvmax: vec3<f32> = max(t1, t2);\n  let tmin: f32 = max(tvmin.x, max(tvmin.y, tvmin.z));\n  let tmax: f32 = min(tvmax.x, min(tvmax.y, tvmax.z));\n\n  if (tmax - tmin < 0.) {\n    return -1.;\n  }\n  \n  if (tmin > 0.) {\n    return tmin;\n  }\n\n  return tmax;\n}\n\nfn triangleHitTest(ray: Ray, leaf: BVHLeaf) -> FragmentInfo {\n  var info: FragmentInfo;\n  let indexes: vec3<u32> = leaf.indexes;\n  info.p0 = u_positions.value[indexes[0]];\n  info.p1 = u_positions.value[indexes[1]];\n  info.p2 = u_positions.value[indexes[2]];\n\n  // if ray is very near to its egde, test will be failed, especially when trangle is very small\n  let e0: vec3<f32> = info.p1 - info.p0;\n  let e1: vec3<f32> = info.p2 - info.p0;\n  let p: vec3<f32> = cross(ray.dir, e1);\n  var det: f32 = dot(e0, p);\n  var t: vec3<f32> = ray.origin - info.p0;\n\n  if (det < 0.) {\n    t = -t;\n    det = -det;\n  }\n\n  if (det < 0.0001) {\n    return info;\n  }\n\n  let u: f32 = dot(t, p);\n\n  if (u < 0. || u > det) {\n    return info;\n  }\n\n  let q: vec3<f32> = cross(t, e0);\n  let v: f32 = dot(ray.dir, q);\n\n  if (v < 0. || v + u - det > 0.) {\n    return info;\n  }\n\n  let lt: f32 = dot(e1, q);\n\n  if (lt < 0.) {\n    return info;\n  }\n\n  let invDet: f32 = 1. / det;\n  info.weights = vec3<f32>(0., u, v) * invDet;\n  info.weights.x = 1. - info.weights.y - info.weights.z;\n\n  info.hit = true;\n  info.t = lt * invDet;\n  info.hitPoint = ray.origin + ray.dir * info.t;\n  info.uv0 = u_uvs.value[indexes.x];\n  info.uv1 = u_uvs.value[indexes.y];\n  info.uv2 = u_uvs.value[indexes.z];\n  info.n0 = u_normals.value[indexes.x];\n  info.n1 = u_normals.value[indexes.y];\n  info.n2 = u_normals.value[indexes.z];\n  info.meshIndex = u_meshMatIndexes.value[indexes.x].x;\n  info.matIndex = u_meshMatIndexes.value[indexes.x].y;\n  let metallicRoughnessFactorNormalScaleMaterialType: vec4<f32> = material.u_metallicRoughnessFactorNormalScaleMaterialTypes[info.matIndex];\n  info.matType = u32(metallicRoughnessFactorNormalScaleMaterialType[3]);\n\n  return info;\n}\n\nfn leafHitTest(ray: Ray, offset: u32, ignoreGlass: bool) -> FragmentInfo {\n  var info: FragmentInfo;\n  info.t = MAX_RAY_LENGTH;\n  var leaf: BVHLeaf = getBVHLeafInfo(offset);\n  let primitives: u32 = leaf.primitives;\n  \n  for (var i: u32 = 0u; i < primitives; i = i + 1u) {\n    leaf = getBVHLeafInfo(offset + i);\n    let cInfo: FragmentInfo = triangleHitTest(ray, leaf);\n\n    if (ignoreGlass && isMatGlass(cInfo.matType)) {\n      continue;\n    }\n\n    if (cInfo.hit && cInfo.t < info.t) {\n      info = cInfo;\n    }\n  }\n\n  return info;\n}\n\nfn fillHitPoint(frag: FragmentInfo, ray: Ray) -> HitPoint {\n  var info: HitPoint;\n\n  info.hit = true;\n  info.hited = frag.t;\n  info.meshIndex = frag.meshIndex;\n  info.matIndex = frag.matIndex;\n  let metallicRoughnessFactorNormalScaleMaterialType: vec4<f32> = material.u_metallicRoughnessFactorNormalScaleMaterialTypes[frag.matIndex];\n  info.position = frag.p0 * frag.weights[0] + frag.p1 * frag.weights[1] + frag.p2 * frag.weights[2];\n  let uv: vec2<f32> = frag.uv0 * frag.weights[0] + frag.uv1 * frag.weights[1] + frag.uv2 * frag.weights[2];\n  let textureIds: vec4<i32> = material.u_matId2TexturesId[frag.matIndex];  \n  let faceNormal: vec3<f32> = getFaceNormal(frag);\n  info.sign = sign(dot(faceNormal, -ray.dir));\n  info.normal = info.sign * getNormal(frag, uv, textureIds[1], metallicRoughnessFactorNormalScaleMaterialType[2]);\n  let baseColor: vec4<f32> = getBaseColor(material.u_baseColorFactors[frag.matIndex], textureIds[0], uv);\n  info.baseColor = baseColor.rgb;\n  info.glass = baseColor.a;\n  info.matType = frag.matType;\n  info.isSpecGloss = isMatSpecGloss(frag.matType);\n  info.isGlass = isMatGlass(frag.matType);\n\n  if (info.isSpecGloss) {\n    let specularGlossinessFactors: vec4<f32> = material.u_specularGlossinessFactors[frag.matIndex];\n    info.spec = getSpecular(specularGlossinessFactors.xyz, textureIds[2], uv).rgb;\n    info.gloss = getGlossiness(specularGlossinessFactors[3], textureIds[2], uv);\n  } else {\n    info.metal = getMetallic(metallicRoughnessFactorNormalScaleMaterialType[0], textureIds[2], uv);\n    info.rough = getRoughness(metallicRoughnessFactorNormalScaleMaterialType[1], textureIds[2], uv);\n  }\n\n  info.pbrData = pbrPrepareData(info.isSpecGloss, info.baseColor, info.metal, info.rough, info.spec, info.gloss);\n\n  return info;\n}\n\nfn hitTest(ray: Ray) -> HitPoint {\n  var hit: HitPoint;\n  var fragInfo: FragmentInfo;\n  fragInfo.t = MAX_RAY_LENGTH;\n  var node: BVHNode;\n  var nodeStack: array<u32, ${BVH_DEPTH}>;\n  nodeStack[0] = 0u;\n  var stackDepth: i32 = 0;\n  \n  loop {\n     if (stackDepth < 0) {\n       break;\n     }\n\n    let child = decodeChild(nodeStack[stackDepth]);\n    stackDepth = stackDepth - 1;\n\n    if (child.isLeaf) {\n      let info: FragmentInfo = leafHitTest(ray, child.offset, false);\n\n      if (info.hit && info.t < fragInfo.t) {\n        fragInfo = info;\n      }\n\n      continue;\n    }\n\n    node = getBVHNodeInfo(child.offset);\n    let hited: f32 = boxHitTest(ray, node.max, node.min);\n\n    // if ray.origin is in bvh box, the minT may be less than zero, hited will be maxT\n    // if (hited < 0. || hited > fragInfo.t) {\n    if (hited < 0.) {\n      continue;\n    }\n\n    stackDepth = stackDepth + 1;\n    nodeStack[stackDepth] = node.child0Index;\n    stackDepth = stackDepth + 1;\n    nodeStack[stackDepth] = node.child1Index;\n  }\n\n  if (fragInfo.hit) {\n    hit = fillHitPoint(fragInfo, ray);\n  }\n\n  return hit;\n}\n\nfn hitTestShadow(ray: Ray, maxT: f32) -> FragmentInfo {\n  var fragInfo: FragmentInfo;\n  var node: BVHNode;\n  var nodeStack: array<u32, ${BVH_DEPTH}>;\n  nodeStack[0] = 0u;\n  var stackDepth: i32 = 0;\n  \n  loop {\n     if (stackDepth < 0) {\n       break;\n     }\n\n    let child = decodeChild(nodeStack[stackDepth]);\n    stackDepth = stackDepth - 1;\n\n    if (child.isLeaf) {\n      let info: FragmentInfo = leafHitTest(ray, child.offset, true);\n\n      if (info.hit && info.t < maxT && info.t > EPS) {\n        return info;\n      }\n\n      continue;\n    }\n\n    node = getBVHNodeInfo(child.offset);\n    let hited: f32 = boxHitTest(ray, node.max, node.min);\n\n    if (hited < 0.) {\n      continue;\n    }\n\n    stackDepth = stackDepth + 1;\n    nodeStack[stackDepth] = node.child0Index;\n    stackDepth = stackDepth + 1;\n    nodeStack[stackDepth] = node.child1Index;\n  }\n\n  return fragInfo;\n}\n\nfn hitTestXZPlane(ray: Ray, inverseMat: mat4x4<f32>) -> vec3<f32> {\n  let invDir: vec3<f32> = normalize((inverseMat * vec4<f32>(ray.dir, 0.)).xyz);\n  let normal: vec3<f32> = vec3<f32>(0., 0., 1.);\n  let dot: f32 = dot(invDir, normal);\n\n  if (abs(dot) < EPS) {\n    return vec3<f32>(MAX_RAY_LENGTH, MAX_RAY_LENGTH, MAX_RAY_LENGTH);\n  }\n  \n  let invOrigin: vec3<f32> = (inverseMat * vec4<f32>(ray.origin, 1.)).xyz;\n  let t: f32 = dot(-invOrigin, normal) / dot;\n\n  if (t < EPS) {\n    return vec3<f32>(MAX_RAY_LENGTH, MAX_RAY_LENGTH, MAX_RAY_LENGTH);\n  }\n\n  return vec3<f32>(invOrigin.xy + t * invDir.xy, t);\n}\n\nfn hitTestLights(ray: Ray) -> vec4<f32> {\n  let areaLight: LightInfo = global.u_lightInfos[0];\n  var res: vec4<f32> = vec4<f32>(areaLight.color.rgb, MAX_RAY_LENGTH);\n  // only support one area light now\n  if (areaLight.lightType != LIGHT_TYPE_AREA) {\n    return res;\n  }\n\n  let xyt: vec3<f32> = hitTestXZPlane(ray, areaLight.worldTransformInverse);\n\n  var hit: bool = false;\n  if (areaLight.areaMode == LIGHT_AREA_DISC) {\n    hit = length(xyt.xy) < areaLight.areaSize.x;\n  } else {\n    hit = all(abs(xyt.xy) < areaLight.areaSize / 2.);\n  }\n\n  if (hit) {\n    res.a = xyt.z;\n  }\n\n  return res;\n}\n\n//require end\n;\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/sample.chunk.wgsl\n\nfn getDiffuseProb(hit: HitPoint) -> f32 {\n  let lumDiffuse: f32 = max(.01, dot(hit.pbrData.diffuseColor, vec3<f32>(0.2125, 0.7154, 0.0721)));\n  let lumSpecular: f32 = max(.01, dot(hit.pbrData.specularColor, vec3<f32>(0.2125, 0.7154, 0.0721)));\n\n  return lumDiffuse / (lumDiffuse + lumSpecular);\n}\n\n// https://graphics.pixar.com/library/OrthonormalB/paper.pdf\nfn orthonormalBasis(normal: vec3<f32>) -> mat3x3<f32> {\n  // sign function return 0 if x is 0\n  // let zsign: f32 = sign(normal.z) * 1.;\n  var zsign: f32 = 1.;\n  if (normal.z < 0.) {\n    zsign = -1.;\n  }\n  let a: f32 = -1.0 / (zsign + normal.z);\n  let b: f32 = normal.x * normal.y * a;\n  let s: vec3<f32> = vec3<f32>(1.0 + zsign * normal.x * normal.x * a, zsign * b, -zsign * normal.x);\n  let t: vec3<f32> = vec3<f32>(b, zsign + normal.y * normal.y * a, -normal.y);\n\n  return mat3x3<f32>(s, t, normal);\n}\n\n// http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#SamplingaUnitDisk\nfn sampleCircle(pi: vec2<f32>) -> vec2<f32> {\n  let p: vec2<f32> = 2.0 * pi - 1.0;\n  let greater: bool = abs(p.x) > abs(p.y);\n  var r: f32;\n  var theta: f32;\n\n  if (greater) {\n    r = p.x;\n    theta = 0.25 * PI * p.y / p.x;\n  } else {\n    r = p.y;\n    theta = PI * (0.5 - 0.25 * p.x / p.y);\n  }\n\n  return r * vec2<f32>(cos(theta), sin(theta));\n}\n\nfn fresnelSchlickWeight(cosTheta: f32) -> f32 {\n  let w: f32 = 1.0 - cosTheta;\n\n  return (w * w) * (w * w) * w;\n}\n\nfn fresnelSchlickTIR(cosTheta: f32, r0: f32, ni: f32) -> f32 {\n  // moving from a more dense to a less dense medium\n  var cos: f32 = cosTheta;\n  if (cosTheta < 0.0) {\n    let inv_eta: f32 = ni;\n    let SinT2: f32 = inv_eta * inv_eta * (1.0 - cosTheta * cosTheta);\n    if (SinT2 > 1.0) {\n      return 1.0; // total internal reflection\n    }\n\n    cos = sqrt(1. - SinT2);\n  }\n\n  return mix(fresnelSchlickWeight(cos), 1.0, r0);\n}\n\n// http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#Cosine-WeightedHemisphereSampling\nfn cosineSampleHemisphere(p: vec2<f32>) -> vec3<f32> {\n  let h: vec2<f32> = sampleCircle(p);\n  let z: f32 = sqrt(max(0.0, 1.0 - h.x * h.x - h.y * h.y));\n\n  return vec3<f32>(h, z);\n}\n\nfn calcDiffuseLightDir(basis: mat3x3<f32>, sign: f32, random: vec2<f32>) -> vec3<f32> {\n  return basis * sign * cosineSampleHemisphere(random);\n}\n\n// GGX distrubtion\nfn calcSpecularLightDir(basis: mat3x3<f32>, ray: Ray, hit: HitPoint, random: vec2<f32>) -> vec3<f32> {\n  let phi: f32 = PI * 2. * random.x;\n  let alpha: f32 = hit.pbrData.alphaRoughness;\n  let cosTheta: f32 = sqrt((1.0 - random.y) / (1.0 + (alpha * alpha - 1.0) * random.y));\n  let sinTheta: f32 = sqrt(1.0 - cosTheta * cosTheta);\n  let halfVector: vec3<f32> = basis * hit.sign * vec3<f32>(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n\n  return reflect(ray.dir, halfVector);\n}\n\nfn calcBrdfDir(ray: Ray, hit: HitPoint, isDiffuse: bool, random: vec2<f32>) -> vec3<f32> {\n  let basis: mat3x3<f32> = orthonormalBasis(hit.normal);\n\n  if (isDiffuse) {\n    return calcDiffuseLightDir(basis, hit.sign, random);\n  }\n\n  return calcSpecularLightDir(basis, ray, hit, random);\n}\n\nstruct BSDFDirRes {\n  dir: vec3<f32>;\n  isBTDF: bool;\n};\n\n// dir and (0. is brdf, 1. is btdf)\n// we suppose all glass are thick glass\nfn calcBsdfDir(ray: Ray, hit: HitPoint, reflectProbability: f32) -> BSDFDirRes {\n  let nAir: f32 = 1.;\n  let nGlass: f32 = 1. / hit.glass;\n  var ior: f32 = nGlass; // backface, nGlass / nAir\n  var res: BSDFDirRes;\n\n  if (hit.sign > 0.) {\n    ior = hit.glass; // nAir / nGlass\n  }\n\n  let cosTheta: f32 = dot(hit.normal, -ray.dir);\n  var r0: f32 = (nAir - nGlass) / (nAir + nGlass);\n  r0 = r0 * r0;\n  let F: f32 = fresnelSchlickTIR(cosTheta, r0, ior);\n\n  //@todo: if backface and not full reflection, force refraction\n  if (F > reflectProbability) {\n    res.dir = reflect(ray.dir, hit.normal);\n    res.isBTDF = false;\n  } else {\n    res.dir = refract(ray.dir, hit.normal, ior);\n    res.isBTDF = true;\n  }\n\n  return res;\n}\n\n//require end\n;\n//from require /mnt/h/ComplexMind/ray-tracing-webgpu/src/buildin/shaders/ray-tracing/lighting.chunk.wgsl\nfn calcBrdfDirectOrSpecular(\n  pbr: PBRData, normal: vec3<f32>,\n  viewDir: vec3<f32>, lightDir: vec3<f32>,\n  isDirect: bool, probDiffuse: f32\n)-> vec3<f32> {\n  let H: vec3<f32> = normalize(lightDir + viewDir);\n  let NdotV: f32 = clamp(abs(dot(normal, viewDir)), 0.001, 1.0);\n  let NdotL: f32 = clamp(abs(dot(normal, lightDir)), 0.001, 1.0);\n  let NdotH: f32 = clamp(abs(dot(normal, H)), 0.0, 1.0);\n  let LdotH: f32 = clamp(abs(dot(lightDir, H)), 0.0, 1.0);\n  let VdotH: f32 = clamp(dot(viewDir, H), 0.0, 1.0);\n  // Calculate the shading terms for the microfacet specular shading model\n  let F: vec3<f32> = pbrSpecularReflection(pbr.reflectance0, pbr.reflectance90, VdotH);\n  let G: f32 = pbrGeometricOcclusion(NdotL, NdotV, pbr.alphaRoughness);\n  let D: f32 = pbrMicrofacetDistribution(pbr.alphaRoughness, NdotH);\n\n  let specular: vec3<f32> = F * G * D / (4.0 * NdotL * NdotV);\n\n  if (isDirect) {\n    let diffuse: vec3<f32> = NdotL * 0.3183098861837907 * pbr.diffuseColor;\n    return specular + diffuse;\n  }\n\n  let specularPdf: f32 = D * NdotH / (4.0 * LdotH);\n  return NdotL * specular / (mix(specularPdf, 0., probDiffuse));\n}\n\nfn calcDirectColor(ray: Ray, hit: HitPoint, random: vec2<f32>) -> vec3<f32> {\n  // sample area lights, get radiance or shadow\n  let areaLight: LightInfo = global.u_lightInfos[0];\n\n  // only support one area light now\n  if (areaLight.lightType != LIGHT_TYPE_AREA) {\n    return vec3<f32>(0.);\n  }\n\n  var samplePoint2D: vec2<f32>;\n  let normal: vec3<f32> = normalize((areaLight.worldTransform * vec4<f32>(0., 0., -1., 0.)).xyz);\n  var area: f32;\n  if (areaLight.areaMode == LIGHT_AREA_DISC) {\n    samplePoint2D = sampleCircle(random) * areaLight.areaSize.x;\n    area = 2. * PI * areaLight.areaSize.x;\n  } else {\n    samplePoint2D = (random) * areaLight.areaSize;\n    area = samplePoint2D.x * samplePoint2D.y;\n    samplePoint2D = samplePoint2D * 2. - areaLight.areaSize;\n  }\n\n  let samplePoint: vec4<f32> = areaLight.worldTransform * vec4<f32>(samplePoint2D.x, samplePoint2D.y, 0., 1.);\n  var sampleDir: vec3<f32> = samplePoint.xyz - hit.position;\n\n  let cosine: f32 = dot(normal, sampleDir);\n  if (cosine > 0.) {\n    // backface\n    return vec3<f32>(0.);\n  }\n\n  let maxT: f32 = length(sampleDir);\n  sampleDir = normalize(sampleDir);\n  let sampleLight: Ray = genRay(hit.position + RAY_DIR_OFFSET * sampleDir + RAY_NORMAL_OFFSET * hit.normal, sampleDir);\n  let shadowInfo: FragmentInfo = hitTestShadow(sampleLight, maxT);\n\n  if (shadowInfo.hit) {\n    return vec3<f32>(0.);\n  }\n\n  let pdf: f32 = maxT * maxT / (area * -cosine);\n  let directLight: vec3<f32> = areaLight.color.rgb / pdf;\n  let brdf = calcBrdfDirectOrSpecular(hit.pbrData, hit.normal, -ray.dir, sampleDir, true, 0.);\n\n  return directLight * brdf;\n}\n\nfn calcDiffuseFactor(ray: Ray, hit: HitPoint, nextDir: vec3<f32>, probDiffuse: f32) -> vec3<f32> {\n  // let diffusePdf: f32 = NdotL * 0.3183098861837907;\n  return hit.pbrData.diffuseColor / probDiffuse;\n}\n\nfn calcSpecularFactor(ray: Ray, hit: HitPoint, nextDir: vec3<f32>, probDiffuse: f32) -> vec3<f32> {\n  return calcBrdfDirectOrSpecular(hit.pbrData, hit.normal, -ray.dir, nextDir.xyz, false, probDiffuse);\n}\n\nfn calcTransmissionFactor(ray: Ray, hit: HitPoint, nextDir: vec3<f32>) -> vec3<f32> {\n  return hit.baseColor;\n}\n\nfn calcOutColor(ray: Ray, hit: HitPoint) -> vec3<f32> {\n  // rgbd\n  let bgColor: vec4<f32> = textureSampleLevel(u_envTexture, u_sampler, ray.dir, 0.);\n  return bgColor.rgb / bgColor.a * global.u_envColor.rgb;\n}\n\n//require end\n;\n\nfn calcLight(ray: Ray, hit: HitPoint, baseUV: vec2<f32>, bounce: i32, isLast: bool, isOut: bool, debugIndex: i32) -> Light {\n  var light: Light;\n  let random = getRandom(baseUV, bounce);\n\n  if (isOut) {\n    // rgbd\n    light.color = calcOutColor(ray, hit);\n    return light;\n  }\n\n  var nextDir: vec3<f32>;\n  var isBTDF: bool = false;\n  if (hit.isGlass) {\n    // bsdf\n    if (isLast) {\n      return light;\n    }\n    \n    let next: BSDFDirRes = calcBsdfDir(ray, hit, random.x);\n    nextDir = next.dir;\n    isBTDF = next.isBTDF;\n\n    if (isBTDF) {\n      light.throughEng = calcTransmissionFactor(ray, hit, nextDir.xyz);\n    } else {\n      light.throughEng = calcSpecularFactor(ray, hit, nextDir.xyz, 0.);\n    }\n  } else {\n    // brdf\n    light.color = calcDirectColor(ray, hit, random.zw);\n\n    if (isLast) {\n      return light;\n    }\n\n    let probDiffuse: f32 = getDiffuseProb(hit);\n    let isDiffuse: bool = random.z < probDiffuse;\n    nextDir = calcBrdfDir(ray, hit, isDiffuse, random.xy);\n\n    if (isDiffuse) {\n      light.throughEng = calcDiffuseFactor(ray, hit, nextDir.xyz, probDiffuse);\n    } else {\n      light.throughEng = calcSpecularFactor(ray, hit, nextDir.xyz, probDiffuse);\n    }\n  }\n\n  // avoid self intersection\n  if (isBTDF) {\n    // transmission\n    light.next = genRay(hit.position + light.next.dir * RAY_DIR_OFFSET - RAY_NORMAL_OFFSET * hit.normal, nextDir.xyz);\n  } else {\n    light.next = genRay(hit.position + light.next.dir * RAY_DIR_OFFSET + RAY_NORMAL_OFFSET * hit.normal, nextDir.xyz);\n  }\n\n  return light;\n}\n\nfn traceLight(startRay: Ray, gBInfo: HitPoint, baseUV: vec2<f32>, debugIndex: i32) -> vec3<f32> {\n  var light: Light = calcLight(startRay, gBInfo, baseUV, 0, false, false, debugIndex);\n  var lightColor: vec3<f32> = light.color;\n  var throughEng: vec3<f32> = light.throughEng;\n  var hit: HitPoint;\n  var ray: Ray = light.next;\n  var lightHited: vec4<f32>;\n  var bounce: i32 = 0;\n\n  loop {\n    let preIsGlass = hit.isGlass;\n    lightHited = hitTestLights(ray);\n    hit = hitTest(ray);\n    let isHitLight: bool = lightHited.a <= hit.hited;\n    let isOut: bool = !hit.hit || isHitLight;\n    // if hit none-glass material, finish tracing\n    let isLast: bool = !hit.isGlass;\n\n    if (preIsGlass && isHitLight) {\n      light.color = lightHited.rgb;\n    } else {\n      light = calcLight(ray, hit, baseUV, bounce, isLast, isOut, debugIndex);\n      ray = light.next;\n    }\n\n    lightColor = lightColor + light.color * throughEng;\n    throughEng = throughEng * light.throughEng;\n    bounce = bounce + 1;\n\n    if (max(throughEng.x, max(throughEng.y, throughEng.z)) < 0.01 || isOut) {\n      break;\n    }\n  }\n\n  // var hited: f32 = 0.;\n  // if (hit.hit) {\n  //   hited = 1.;\n  // }\n  // ray = startRay;\n  // hit = gBInfo;\n  // light = calcLight(ray, hit, baseUV, 0, false, false, debugIndex);\n  // u_debugInfo.rays[debugIndex].preOrigin = vec4<f32>(ray.origin, hit.sign);\n  // u_debugInfo.rays[debugIndex].preDir = vec4<f32>(ray.dir, f32(hit.matType));\n  // ray = light.next;\n  // hit = hitTest(ray);\n  // light = calcLight(ray, hit, baseUV, 1, false, false, debugIndex);\n  // u_debugInfo.rays[debugIndex].origin = vec4<f32>(ray.origin, hit.sign);\n  // u_debugInfo.rays[debugIndex].dir = vec4<f32>(ray.dir, f32(hit.matType));\n  // u_debugInfo.rays[debugIndex].normal = vec4<f32>(hit.normal, hit.glass);\n  // ray = light.next;\n  // hit = hitTest(ray);\n  // light = calcLight(ray, hit, baseUV, 2, false, false, debugIndex);\n  // u_debugInfo.rays[debugIndex].nextOrigin = vec4<f32>(ray.origin, hit.sign);\n  // u_debugInfo.rays[debugIndex].nextDir = vec4<f32>(ray.dir, f32(bounce));\n\n  return lightColor;\n}\n\n[[stage(compute), workgroup_size(16, 16, 1)]]\nfn main(\n  [[builtin(workgroup_id)]] workGroupID : vec3<u32>,\n  [[builtin(local_invocation_id)]] localInvocationID : vec3<u32>\n) {\n  let screenSize: vec2<i32> = textureDimensions(u_gbPositionMetalOrSpec, 0);\n  let groupOffset: vec2<i32> = vec2<i32>(workGroupID.xy) * 16;\n  let baseIndex: vec2<i32> = groupOffset + vec2<i32>(localInvocationID.xy);\n  let baseUV: vec2<f32> = vec2<f32>(baseIndex) / vec2<f32>(screenSize);\n  let gBInfo: HitPoint = getGBInfo(baseIndex);\n  let debugIndex: i32 = baseIndex.x + baseIndex.y * screenSize.x;\n\n  if (gBInfo.isLight) {\n    textureStore(u_output, baseIndex, vec4<f32>(gBInfo.baseColor, 1.));\n    return;\n  }\n\n  if (!gBInfo.hit) {\n    let t: vec4<f32> = global.u_skyVP * vec4<f32>(baseUV.x * 2. - 1., 1. - baseUV.y * 2., 1., 1.);\n    let cubeUV: vec3<f32> = normalize(t.xyz / t.w);\n    let bgColor: vec4<f32> = textureSampleLevel(u_envTexture, u_sampler, cubeUV, 0.);\n    // rgbd\n    textureStore(u_output, baseIndex, vec4<f32>(bgColor.rgb / bgColor.a * global.u_envColor.rgb, 1.));\n    return;\n  }\n\n  let worldRay: Ray = genWorldRayByGBuffer(baseUV, gBInfo);\n  let light: vec3<f32> = traceLight(worldRay, gBInfo, baseUV, debugIndex);\n  textureStore(u_output, baseIndex, vec4<f32>(light, 1.));\n}\n"},8872:(e,t,n)=>{"use strict";n.r(t),n.d(t,{glMatrix:()=>r,mat2:()=>a,mat2d:()=>o,mat3:()=>i,mat4:()=>s,quat:()=>c,quat2:()=>f,vec2:()=>h,vec3:()=>u,vec4:()=>l});var r={};n.r(r),n.d(r,{ARRAY_TYPE:()=>p,EPSILON:()=>d,RANDOM:()=>m,equals:()=>y,setMatrixArrayType:()=>v,toRadian:()=>b});var a={};n.r(a),n.d(a,{LDU:()=>U,add:()=>F,adjoint:()=>I,clone:()=>x,copy:()=>w,create:()=>_,determinant:()=>A,equals:()=>j,exactEquals:()=>N,frob:()=>G,fromRotation:()=>D,fromScaling:()=>R,fromValues:()=>S,identity:()=>M,invert:()=>P,mul:()=>H,multiply:()=>E,multiplyScalar:()=>k,multiplyScalarAndAdd:()=>z,rotate:()=>C,scale:()=>L,set:()=>T,str:()=>V,sub:()=>q,subtract:()=>B,transpose:()=>O});var o={};n.r(o),n.d(o,{add:()=>le,clone:()=>Y,copy:()=>W,create:()=>$,determinant:()=>J,equals:()=>pe,exactEquals:()=>de,frob:()=>ue,fromRotation:()=>ae,fromScaling:()=>oe,fromTranslation:()=>ie,fromValues:()=>Z,identity:()=>X,invert:()=>Q,mul:()=>me,multiply:()=>ee,multiplyScalar:()=>fe,multiplyScalarAndAdd:()=>he,rotate:()=>te,scale:()=>ne,set:()=>K,str:()=>se,sub:()=>ve,subtract:()=>ce,translate:()=>re});var i={};n.r(i),n.d(i,{add:()=>je,adjoint:()=>Oe,clone:()=>ye,copy:()=>_e,create:()=>ge,determinant:()=>Pe,equals:()=>$e,exactEquals:()=>qe,frob:()=>Ne,fromMat2d:()=>Ve,fromMat4:()=>be,fromQuat:()=>Ge,fromRotation:()=>De,fromScaling:()=>Re,fromTranslation:()=>Le,fromValues:()=>xe,identity:()=>Me,invert:()=>Te,mul:()=>Ye,multiply:()=>Ie,multiplyScalar:()=>ze,multiplyScalarAndAdd:()=>He,normalFromMat4:()=>Ue,projection:()=>Fe,rotate:()=>Ee,scale:()=>Ce,set:()=>we,str:()=>Be,sub:()=>We,subtract:()=>ke,translate:()=>Ae,transpose:()=>Se});var s={};n.r(s),n.d(s,{add:()=>Rt,adjoint:()=>rt,clone:()=>Ze,copy:()=>Ke,create:()=>Xe,determinant:()=>at,equals:()=>Bt,exactEquals:()=>Ft,frob:()=>Dt,fromQuat:()=>Tt,fromQuat2:()=>yt,fromRotation:()=>pt,fromRotationTranslation:()=>bt,fromRotationTranslationScale:()=>Mt,fromRotationTranslationScaleOrigin:()=>St,fromScaling:()=>dt,fromTranslation:()=>ht,fromValues:()=>Qe,fromXRotation:()=>mt,fromYRotation:()=>vt,fromZRotation:()=>gt,frustum:()=>Ot,getRotation:()=>wt,getScaling:()=>xt,getTranslation:()=>_t,identity:()=>et,invert:()=>nt,lookAt:()=>Et,mul:()=>Nt,multiply:()=>ot,multiplyScalar:()=>Gt,multiplyScalarAndAdd:()=>Ut,ortho:()=>At,perspective:()=>Pt,perspectiveFromFieldOfView:()=>It,rotate:()=>ut,rotateX:()=>lt,rotateY:()=>ct,rotateZ:()=>ft,scale:()=>st,set:()=>Je,str:()=>Lt,sub:()=>jt,subtract:()=>Vt,targetTo:()=>Ct,translate:()=>it,transpose:()=>tt});var u={};n.r(u),n.d(u,{add:()=>Wt,angle:()=>Sn,bezier:()=>vn,ceil:()=>Qt,clone:()=>zt,copy:()=>$t,create:()=>kt,cross:()=>dn,dist:()=>Dn,distance:()=>on,div:()=>Ln,divide:()=>Kt,dot:()=>hn,equals:()=>In,exactEquals:()=>Pn,floor:()=>Jt,forEach:()=>Un,fromValues:()=>qt,hermite:()=>mn,inverse:()=>cn,len:()=>Vn,length:()=>Ht,lerp:()=>pn,max:()=>tn,min:()=>en,mul:()=>Cn,multiply:()=>Zt,negate:()=>ln,normalize:()=>fn,random:()=>gn,rotateX:()=>xn,rotateY:()=>wn,rotateZ:()=>Mn,round:()=>nn,scale:()=>rn,scaleAndAdd:()=>an,set:()=>Yt,sqrDist:()=>Rn,sqrLen:()=>Gn,squaredDistance:()=>sn,squaredLength:()=>un,str:()=>On,sub:()=>En,subtract:()=>Xt,transformMat3:()=>yn,transformMat4:()=>bn,transformQuat:()=>_n,zero:()=>Tn});var l={};n.r(l),n.d(l,{add:()=>zn,ceil:()=>Yn,clone:()=>Bn,copy:()=>jn,create:()=>Fn,cross:()=>ur,dist:()=>_r,distance:()=>er,div:()=>yr,divide:()=>$n,dot:()=>sr,equals:()=>vr,exactEquals:()=>mr,floor:()=>Wn,forEach:()=>Sr,fromValues:()=>Nn,inverse:()=>or,len:()=>wr,length:()=>nr,lerp:()=>lr,max:()=>Zn,min:()=>Xn,mul:()=>br,multiply:()=>qn,negate:()=>ar,normalize:()=>ir,random:()=>cr,round:()=>Kn,scale:()=>Qn,scaleAndAdd:()=>Jn,set:()=>kn,sqrDist:()=>xr,sqrLen:()=>Mr,squaredDistance:()=>tr,squaredLength:()=>rr,str:()=>pr,sub:()=>gr,subtract:()=>Hn,transformMat4:()=>fr,transformQuat:()=>hr,zero:()=>dr});var c={};n.r(c),n.d(c,{add:()=>ta,calculateW:()=>Rr,clone:()=>Kr,conjugate:()=>jr,copy:()=>Jr,create:()=>Tr,dot:()=>aa,equals:()=>ha,exactEquals:()=>fa,exp:()=>Vr,fromEuler:()=>zr,fromMat3:()=>kr,fromValues:()=>Qr,getAngle:()=>Ar,getAxisAngle:()=>Ir,identity:()=>Or,invert:()=>Nr,len:()=>sa,length:()=>ia,lerp:()=>oa,ln:()=>Gr,mul:()=>na,multiply:()=>Er,normalize:()=>ca,pow:()=>Ur,random:()=>Br,rotateX:()=>Cr,rotateY:()=>Lr,rotateZ:()=>Dr,rotationTo:()=>da,scale:()=>ra,set:()=>ea,setAxes:()=>ma,setAxisAngle:()=>Pr,slerp:()=>Fr,sqlerp:()=>pa,sqrLen:()=>la,squaredLength:()=>ua,str:()=>Hr});var f={};n.r(f),n.d(f,{add:()=>Ba,clone:()=>ga,conjugate:()=>$a,copy:()=>Sa,create:()=>va,dot:()=>za,equals:()=>eo,exactEquals:()=>Ja,fromMat4:()=>Ma,fromRotation:()=>wa,fromRotationTranslation:()=>_a,fromRotationTranslationValues:()=>ya,fromTranslation:()=>xa,fromValues:()=>ba,getDual:()=>Ia,getReal:()=>Pa,getTranslation:()=>Ca,identity:()=>Ta,invert:()=>qa,len:()=>Wa,length:()=>Ya,lerp:()=>Ha,mul:()=>ja,multiply:()=>Na,normalize:()=>Ka,rotateAroundAxis:()=>Fa,rotateByQuatAppend:()=>Ga,rotateByQuatPrepend:()=>Ua,rotateX:()=>Da,rotateY:()=>Ra,rotateZ:()=>Va,scale:()=>ka,set:()=>Oa,setDual:()=>Ea,setReal:()=>Aa,sqrLen:()=>Za,squaredLength:()=>Xa,str:()=>Qa,translate:()=>La});var h={};n.r(h),n.d(h,{add:()=>io,angle:()=>Ro,ceil:()=>co,clone:()=>no,copy:()=>ao,create:()=>to,cross:()=>Oo,dist:()=>zo,distance:()=>bo,div:()=>ko,divide:()=>lo,dot:()=>To,equals:()=>Fo,exactEquals:()=>Uo,floor:()=>fo,forEach:()=>$o,fromValues:()=>ro,inverse:()=>Mo,len:()=>Bo,length:()=>_o,lerp:()=>Po,max:()=>po,min:()=>ho,mul:()=>jo,multiply:()=>uo,negate:()=>wo,normalize:()=>So,random:()=>Io,rotate:()=>Do,round:()=>mo,scale:()=>vo,scaleAndAdd:()=>go,set:()=>oo,sqrDist:()=>Ho,sqrLen:()=>qo,squaredDistance:()=>yo,squaredLength:()=>xo,str:()=>Go,sub:()=>No,subtract:()=>so,transformMat2:()=>Ao,transformMat2d:()=>Eo,transformMat3:()=>Co,transformMat4:()=>Lo,zero:()=>Vo});var d=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function v(e){p=e}var g=Math.PI/180;function b(e){return e*g}function y(e,t){return Math.abs(e-t)<=d*Math.max(1,Math.abs(e),Math.abs(t))}function _(){var e=new p(4);return p!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function x(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function w(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function M(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function S(e,t,n,r){var a=new p(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function T(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function O(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function P(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*o-a*r;return i?(i=1/i,e[0]=o*i,e[1]=-r*i,e[2]=-a*i,e[3]=n*i,e):null}function I(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function A(e){return e[0]*e[3]-e[2]*e[1]}function E(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*s+o*u,e[1]=a*s+i*u,e[2]=r*l+o*c,e[3]=a*l+i*c,e}function C(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+o*s,e[1]=a*u+i*s,e[2]=r*-s+o*u,e[3]=a*-s+i*u,e}function L(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],u=n[1];return e[0]=r*s,e[1]=a*s,e[2]=o*u,e[3]=i*u,e}function D(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function R(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function V(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function G(e){return Math.hypot(e[0],e[1],e[2],e[3])}function U(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function F(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function B(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function N(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function j(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=d*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-l)<=d*Math.max(1,Math.abs(o),Math.abs(l))}function k(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function z(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var H=E,q=B;function $(){var e=new p(6);return p!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Y(e){var t=new p(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function W(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function X(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Z(e,t,n,r,a,o){var i=new p(6);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i[4]=a,i[5]=o,i}function K(e,t,n,r,a,o,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e}function Q(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=n*o-r*a;return u?(u=1/u,e[0]=o*u,e[1]=-r*u,e[2]=-a*u,e[3]=n*u,e[4]=(a*s-o*i)*u,e[5]=(r*i-n*s)*u,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=n[0],c=n[1],f=n[2],h=n[3],d=n[4],p=n[5];return e[0]=r*l+o*c,e[1]=a*l+i*c,e[2]=r*f+o*h,e[3]=a*f+i*h,e[4]=r*d+o*p+s,e[5]=a*d+i*p+u,e}function te(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*l,e[1]=a*c+i*l,e[2]=r*-l+o*c,e[3]=a*-l+i*c,e[4]=s,e[5]=u,e}function ne(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=n[0],c=n[1];return e[0]=r*l,e[1]=a*l,e[2]=o*c,e[3]=i*c,e[4]=s,e[5]=u,e}function re(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=n[0],c=n[1];return e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=r*l+o*c+s,e[5]=a*l+i*c+u,e}function ae(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function oe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function se(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ue(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function ce(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function he(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function de(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function pe(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=t[0],l=t[1],c=t[2],f=t[3],h=t[4],p=t[5];return Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-l)<=d*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-c)<=d*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-f)<=d*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))}var me=ee,ve=ce;function ge(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function ye(e){var t=new p(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function _e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xe(e,t,n,r,a,o,i,s,u){var l=new p(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=r,l[4]=a,l[5]=o,l[6]=i,l[7]=s,l[8]=u,l}function we(e,t,n,r,a,o,i,s,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=s,e[7]=u,e[8]=l,e}function Me(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Se(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Te(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=c*i-s*l,h=-c*o+s*u,d=l*o-i*u,p=n*f+r*h+a*d;return p?(p=1/p,e[0]=f*p,e[1]=(-c*r+a*l)*p,e[2]=(s*r-a*i)*p,e[3]=h*p,e[4]=(c*n-a*u)*p,e[5]=(-s*n+a*o)*p,e[6]=d*p,e[7]=(-l*n+r*u)*p,e[8]=(i*n-r*o)*p,e):null}function Oe(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=i*c-s*l,e[1]=a*l-r*c,e[2]=r*s-a*i,e[3]=s*u-o*c,e[4]=n*c-a*u,e[5]=a*o-n*s,e[6]=o*l-i*u,e[7]=r*u-n*l,e[8]=n*i-r*o,e}function Pe(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],s=e[6],u=e[7],l=e[8];return t*(l*o-i*u)+n*(-l*a+i*s)+r*(u*a-o*s)}function Ie(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=n[0],d=n[1],p=n[2],m=n[3],v=n[4],g=n[5],b=n[6],y=n[7],_=n[8];return e[0]=h*r+d*i+p*l,e[1]=h*a+d*s+p*c,e[2]=h*o+d*u+p*f,e[3]=m*r+v*i+g*l,e[4]=m*a+v*s+g*c,e[5]=m*o+v*u+g*f,e[6]=b*r+y*i+_*l,e[7]=b*a+y*s+_*c,e[8]=b*o+y*u+_*f,e}function Ae(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=s,e[5]=u,e[6]=h*r+d*i+l,e[7]=h*a+d*s+c,e[8]=h*o+d*u+f,e}function Ee(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*i,e[1]=d*a+h*s,e[2]=d*o+h*u,e[3]=d*i-h*r,e[4]=d*s-h*a,e[5]=d*u-h*o,e[6]=l,e[7]=c,e[8]=f,e}function Ce(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Le(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function De(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Re(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ge(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,s=r+r,u=a+a,l=n*i,c=r*i,f=r*s,h=a*i,d=a*s,p=a*u,m=o*i,v=o*s,g=o*u;return e[0]=1-f-p,e[3]=c-g,e[6]=h+v,e[1]=c+g,e[4]=1-l-p,e[7]=d-m,e[2]=h-v,e[5]=d+m,e[8]=1-l-f,e}function Ue(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],b=n*s-r*i,y=n*u-a*i,_=n*l-o*i,x=r*u-a*s,w=r*l-o*s,M=a*l-o*u,S=c*m-f*p,T=c*v-h*p,O=c*g-d*p,P=f*v-h*m,I=f*g-d*m,A=h*g-d*v,E=b*A-y*I+_*P+x*O-w*T+M*S;return E?(E=1/E,e[0]=(s*A-u*I+l*P)*E,e[1]=(u*O-i*A-l*T)*E,e[2]=(i*I-s*O+l*S)*E,e[3]=(a*I-r*A-o*P)*E,e[4]=(n*A-a*O+o*T)*E,e[5]=(r*O-n*I-o*S)*E,e[6]=(m*M-v*w+g*x)*E,e[7]=(v*_-p*M-g*y)*E,e[8]=(p*w-m*_+g*b)*E,e):null}function Fe(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Be(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ne(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function je(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function ke(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function ze(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function He(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function qe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function $e(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=t[0],h=t[1],p=t[2],m=t[3],v=t[4],g=t[5],b=t[6],y=t[7],_=t[8];return Math.abs(n-f)<=d*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-p)<=d*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=d*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(i-v)<=d*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-g)<=d*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-b)<=d*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(l-y)<=d*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=d*Math.max(1,Math.abs(c),Math.abs(_))}var Ye=Ie,We=ke;function Xe(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ze(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ke(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,n,r,a,o,i,s,u,l,c,f,h,d,m,v){var g=new p(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=a,g[5]=o,g[6]=i,g[7]=s,g[8]=u,g[9]=l,g[10]=c,g[11]=f,g[12]=h,g[13]=d,g[14]=m,g[15]=v,g}function Je(e,t,n,r,a,o,i,s,u,l,c,f,h,d,p,m,v){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=m,e[15]=v,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],o=t[6],i=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=a,e[13]=i,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function nt(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],b=n*s-r*i,y=n*u-a*i,_=n*l-o*i,x=r*u-a*s,w=r*l-o*s,M=a*l-o*u,S=c*m-f*p,T=c*v-h*p,O=c*g-d*p,P=f*v-h*m,I=f*g-d*m,A=h*g-d*v,E=b*A-y*I+_*P+x*O-w*T+M*S;return E?(E=1/E,e[0]=(s*A-u*I+l*P)*E,e[1]=(a*I-r*A-o*P)*E,e[2]=(m*M-v*w+g*x)*E,e[3]=(h*w-f*M-d*x)*E,e[4]=(u*O-i*A-l*T)*E,e[5]=(n*A-a*O+o*T)*E,e[6]=(v*_-p*M-g*y)*E,e[7]=(c*M-h*_+d*y)*E,e[8]=(i*I-s*O+l*S)*E,e[9]=(r*O-n*I-o*S)*E,e[10]=(p*w-m*_+g*b)*E,e[11]=(f*_-c*w-d*b)*E,e[12]=(s*T-i*P-u*S)*E,e[13]=(n*P-r*T+a*S)*E,e[14]=(m*y-p*x-v*b)*E,e[15]=(c*x-f*y+h*b)*E,e):null}function rt(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15];return e[0]=s*(h*g-d*v)-f*(u*g-l*v)+m*(u*d-l*h),e[1]=-(r*(h*g-d*v)-f*(a*g-o*v)+m*(a*d-o*h)),e[2]=r*(u*g-l*v)-s*(a*g-o*v)+m*(a*l-o*u),e[3]=-(r*(u*d-l*h)-s*(a*d-o*h)+f*(a*l-o*u)),e[4]=-(i*(h*g-d*v)-c*(u*g-l*v)+p*(u*d-l*h)),e[5]=n*(h*g-d*v)-c*(a*g-o*v)+p*(a*d-o*h),e[6]=-(n*(u*g-l*v)-i*(a*g-o*v)+p*(a*l-o*u)),e[7]=n*(u*d-l*h)-i*(a*d-o*h)+c*(a*l-o*u),e[8]=i*(f*g-d*m)-c*(s*g-l*m)+p*(s*d-l*f),e[9]=-(n*(f*g-d*m)-c*(r*g-o*m)+p*(r*d-o*f)),e[10]=n*(s*g-l*m)-i*(r*g-o*m)+p*(r*l-o*s),e[11]=-(n*(s*d-l*f)-i*(r*d-o*f)+c*(r*l-o*s)),e[12]=-(i*(f*v-h*m)-c*(s*v-u*m)+p*(s*h-u*f)),e[13]=n*(f*v-h*m)-c*(r*v-a*m)+p*(r*h-a*f),e[14]=-(n*(s*v-u*m)-i*(r*v-a*m)+p*(r*u-a*s)),e[15]=n*(s*h-u*f)-i*(r*h-a*f)+c*(r*u-a*s),e}function at(e){var t=e[0],n=e[1],r=e[2],a=e[3],o=e[4],i=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],h=e[11],d=e[12],p=e[13],m=e[14],v=e[15];return(t*i-n*o)*(f*v-h*m)-(t*s-r*o)*(c*v-h*p)+(t*u-a*o)*(c*m-f*p)+(n*s-r*i)*(l*v-h*d)-(n*u-a*i)*(l*m-f*d)+(r*u-a*s)*(l*p-c*d)}function ot(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],b=t[15],y=n[0],_=n[1],x=n[2],w=n[3];return e[0]=y*r+_*s+x*f+w*m,e[1]=y*a+_*u+x*h+w*v,e[2]=y*o+_*l+x*d+w*g,e[3]=y*i+_*c+x*p+w*b,y=n[4],_=n[5],x=n[6],w=n[7],e[4]=y*r+_*s+x*f+w*m,e[5]=y*a+_*u+x*h+w*v,e[6]=y*o+_*l+x*d+w*g,e[7]=y*i+_*c+x*p+w*b,y=n[8],_=n[9],x=n[10],w=n[11],e[8]=y*r+_*s+x*f+w*m,e[9]=y*a+_*u+x*h+w*v,e[10]=y*o+_*l+x*d+w*g,e[11]=y*i+_*c+x*p+w*b,y=n[12],_=n[13],x=n[14],w=n[15],e[12]=y*r+_*s+x*f+w*m,e[13]=y*a+_*u+x*h+w*v,e[14]=y*o+_*l+x*d+w*g,e[15]=y*i+_*c+x*p+w*b,e}function it(e,t,n){var r,a,o,i,s,u,l,c,f,h,d,p,m=n[0],v=n[1],g=n[2];return t===e?(e[12]=t[0]*m+t[4]*v+t[8]*g+t[12],e[13]=t[1]*m+t[5]*v+t[9]*g+t[13],e[14]=t[2]*m+t[6]*v+t[10]*g+t[14],e[15]=t[3]*m+t[7]*v+t[11]*g+t[15]):(r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],d=t[10],p=t[11],e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=f,e[9]=h,e[10]=d,e[11]=p,e[12]=r*m+s*v+f*g+t[12],e[13]=a*m+u*v+h*g+t[13],e[14]=o*m+l*v+d*g+t[14],e[15]=i*m+c*v+p*g+t[15]),e}function st(e,t,n){var r=n[0],a=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ut(e,t,n,r){var a,o,i,s,u,l,c,f,h,p,m,v,g,b,y,_,x,w,M,S,T,O,P,I,A=r[0],E=r[1],C=r[2],L=Math.hypot(A,E,C);return L<d?null:(A*=L=1/L,E*=L,C*=L,a=Math.sin(n),i=1-(o=Math.cos(n)),s=t[0],u=t[1],l=t[2],c=t[3],f=t[4],h=t[5],p=t[6],m=t[7],v=t[8],g=t[9],b=t[10],y=t[11],_=A*A*i+o,x=E*A*i+C*a,w=C*A*i-E*a,M=A*E*i-C*a,S=E*E*i+o,T=C*E*i+A*a,O=A*C*i+E*a,P=E*C*i-A*a,I=C*C*i+o,e[0]=s*_+f*x+v*w,e[1]=u*_+h*x+g*w,e[2]=l*_+p*x+b*w,e[3]=c*_+m*x+y*w,e[4]=s*M+f*S+v*T,e[5]=u*M+h*S+g*T,e[6]=l*M+p*S+b*T,e[7]=c*M+m*S+y*T,e[8]=s*O+f*P+v*I,e[9]=u*O+h*P+g*I,e[10]=l*O+p*P+b*I,e[11]=c*O+m*P+y*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function lt(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*a+l*r,e[5]=i*a+c*r,e[6]=s*a+f*r,e[7]=u*a+h*r,e[8]=l*a-o*r,e[9]=c*a-i*r,e[10]=f*a-s*r,e[11]=h*a-u*r,e}function ct(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],u=t[3],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a-l*r,e[1]=i*a-c*r,e[2]=s*a-f*r,e[3]=u*a-h*r,e[8]=o*r+l*a,e[9]=i*r+c*a,e[10]=s*r+f*a,e[11]=u*r+h*a,e}function ft(e,t,n){var r=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],s=t[2],u=t[3],l=t[4],c=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*a+l*r,e[1]=i*a+c*r,e[2]=s*a+f*r,e[3]=u*a+h*r,e[4]=l*a-o*r,e[5]=c*a-i*r,e[6]=f*a-s*r,e[7]=h*a-u*r,e}function ht(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,n){var r,a,o,i=n[0],s=n[1],u=n[2],l=Math.hypot(i,s,u);return l<d?null:(i*=l=1/l,s*=l,u*=l,r=Math.sin(t),o=1-(a=Math.cos(t)),e[0]=i*i*o+a,e[1]=s*i*o+u*r,e[2]=u*i*o-s*r,e[3]=0,e[4]=i*s*o-u*r,e[5]=s*s*o+a,e[6]=u*s*o+i*r,e[7]=0,e[8]=i*u*o+s*r,e[9]=s*u*o-i*r,e[10]=u*u*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bt(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=r+r,u=a+a,l=o+o,c=r*s,f=r*u,h=r*l,d=a*u,p=a*l,m=o*l,v=i*s,g=i*u,b=i*l;return e[0]=1-(d+m),e[1]=f+b,e[2]=h-g,e[3]=0,e[4]=f-b,e[5]=1-(c+m),e[6]=p+v,e[7]=0,e[8]=h+g,e[9]=p-v,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function yt(e,t){var n=new p(3),r=-t[0],a=-t[1],o=-t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=r*r+a*a+o*o+i*i;return f>0?(n[0]=2*(s*i+c*r+u*o-l*a)/f,n[1]=2*(u*i+c*a+l*r-s*o)/f,n[2]=2*(l*i+c*o+s*a-u*r)/f):(n[0]=2*(s*i+c*r+u*o-l*a),n[1]=2*(u*i+c*a+l*r-s*o),n[2]=2*(l*i+c*o+s*a-u*r)),bt(e,t,n),e}function _t(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function xt(e,t){var n=t[0],r=t[1],a=t[2],o=t[4],i=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(o,i,s),e[2]=Math.hypot(u,l,c),e}function wt(e,t){var n=new p(3);xt(n,t);var r=1/n[0],a=1/n[1],o=1/n[2],i=t[0]*r,s=t[1]*a,u=t[2]*o,l=t[4]*r,c=t[5]*a,f=t[6]*o,h=t[8]*r,d=t[9]*a,m=t[10]*o,v=i+c+m,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(f-d)/g,e[1]=(h-u)/g,e[2]=(s-l)/g):i>c&&i>m?(g=2*Math.sqrt(1+i-c-m),e[3]=(f-d)/g,e[0]=.25*g,e[1]=(s+l)/g,e[2]=(h+u)/g):c>m?(g=2*Math.sqrt(1+c-i-m),e[3]=(h-u)/g,e[0]=(s+l)/g,e[1]=.25*g,e[2]=(f+d)/g):(g=2*Math.sqrt(1+m-i-c),e[3]=(s-l)/g,e[0]=(h+u)/g,e[1]=(f+d)/g,e[2]=.25*g),e}function Mt(e,t,n,r){var a=t[0],o=t[1],i=t[2],s=t[3],u=a+a,l=o+o,c=i+i,f=a*u,h=a*l,d=a*c,p=o*l,m=o*c,v=i*c,g=s*u,b=s*l,y=s*c,_=r[0],x=r[1],w=r[2];return e[0]=(1-(p+v))*_,e[1]=(h+y)*_,e[2]=(d-b)*_,e[3]=0,e[4]=(h-y)*x,e[5]=(1-(f+v))*x,e[6]=(m+g)*x,e[7]=0,e[8]=(d+b)*w,e[9]=(m-g)*w,e[10]=(1-(f+p))*w,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function St(e,t,n,r,a){var o=t[0],i=t[1],s=t[2],u=t[3],l=o+o,c=i+i,f=s+s,h=o*l,d=o*c,p=o*f,m=i*c,v=i*f,g=s*f,b=u*l,y=u*c,_=u*f,x=r[0],w=r[1],M=r[2],S=a[0],T=a[1],O=a[2],P=(1-(m+g))*x,I=(d+_)*x,A=(p-y)*x,E=(d-_)*w,C=(1-(h+g))*w,L=(v+b)*w,D=(p+y)*M,R=(v-b)*M,V=(1-(h+m))*M;return e[0]=P,e[1]=I,e[2]=A,e[3]=0,e[4]=E,e[5]=C,e[6]=L,e[7]=0,e[8]=D,e[9]=R,e[10]=V,e[11]=0,e[12]=n[0]+S-(P*S+E*T+D*O),e[13]=n[1]+T-(I*S+C*T+R*O),e[14]=n[2]+O-(A*S+L*T+V*O),e[15]=1,e}function Tt(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n+n,s=r+r,u=a+a,l=n*i,c=r*i,f=r*s,h=a*i,d=a*s,p=a*u,m=o*i,v=o*s,g=o*u;return e[0]=1-f-p,e[1]=c+g,e[2]=h-v,e[3]=0,e[4]=c-g,e[5]=1-l-p,e[6]=d+m,e[7]=0,e[8]=h+v,e[9]=d-m,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ot(e,t,n,r,a,o,i){var s=1/(n-t),u=1/(a-r),l=1/(o-i);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(a+r)*u,e[10]=(i+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=i*o*2*l,e[15]=0,e}function Pt(e,t,n,r,a){var o,i=1/Math.tan(t/2);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(r-a),e[10]=(a+r)*o,e[14]=2*a*r*o):(e[10]=-1,e[14]=-2*r),e}function It(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(i+s),l=2/(a+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(i-s)*u*.5,e[9]=(a-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function At(e,t,n,r,a,o,i){var s=1/(t-n),u=1/(r-a),l=1/(o-i);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(a+r)*u,e[14]=(i+o)*l,e[15]=1,e}function Et(e,t,n,r){var a,o,i,s,u,l,c,f,h,p,m=t[0],v=t[1],g=t[2],b=r[0],y=r[1],_=r[2],x=n[0],w=n[1],M=n[2];return Math.abs(m-x)<d&&Math.abs(v-w)<d&&Math.abs(g-M)<d?et(e):(c=m-x,f=v-w,h=g-M,a=y*(h*=p=1/Math.hypot(c,f,h))-_*(f*=p),o=_*(c*=p)-b*h,i=b*f-y*c,(p=Math.hypot(a,o,i))?(a*=p=1/p,o*=p,i*=p):(a=0,o=0,i=0),s=f*i-h*o,u=h*a-c*i,l=c*o-f*a,(p=Math.hypot(s,u,l))?(s*=p=1/p,u*=p,l*=p):(s=0,u=0,l=0),e[0]=a,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=i,e[9]=l,e[10]=h,e[11]=0,e[12]=-(a*m+o*v+i*g),e[13]=-(s*m+u*v+l*g),e[14]=-(c*m+f*v+h*g),e[15]=1,e)}function Ct(e,t,n,r){var a=t[0],o=t[1],i=t[2],s=r[0],u=r[1],l=r[2],c=a-n[0],f=o-n[1],h=i-n[2],d=c*c+f*f+h*h;d>0&&(c*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-l*f,m=l*c-s*h,v=s*f-u*c;return(d=p*p+m*m+v*v)>0&&(p*=d=1/Math.sqrt(d),m*=d,v*=d),e[0]=p,e[1]=m,e[2]=v,e[3]=0,e[4]=f*v-h*m,e[5]=h*p-c*v,e[6]=c*m-f*p,e[7]=0,e[8]=c,e[9]=f,e[10]=h,e[11]=0,e[12]=a,e[13]=o,e[14]=i,e[15]=1,e}function Lt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Rt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Vt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Gt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Ut(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Ft(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Bt(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=e[6],l=e[7],c=e[8],f=e[9],h=e[10],p=e[11],m=e[12],v=e[13],g=e[14],b=e[15],y=t[0],_=t[1],x=t[2],w=t[3],M=t[4],S=t[5],T=t[6],O=t[7],P=t[8],I=t[9],A=t[10],E=t[11],C=t[12],L=t[13],D=t[14],R=t[15];return Math.abs(n-y)<=d*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=d*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(a-x)<=d*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-w)<=d*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(i-M)<=d*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(s-S)<=d*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-T)<=d*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(l-O)<=d*Math.max(1,Math.abs(l),Math.abs(O))&&Math.abs(c-P)<=d*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-I)<=d*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(h-A)<=d*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-E)<=d*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(m-C)<=d*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(v-L)<=d*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(g-D)<=d*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(b-R)<=d*Math.max(1,Math.abs(b),Math.abs(R))}var Nt=ot,jt=Vt;function kt(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function zt(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ht(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function qt(e,t,n){var r=new p(3);return r[0]=e,r[1]=t,r[2]=n,r}function $t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Yt(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Wt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Xt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Zt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Kt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Qt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Jt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function en(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function tn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function nn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function rn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function an(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function on(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function sn(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function un(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function ln(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function cn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function fn(e,t){var n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function hn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dn(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],u=n[2];return e[0]=a*u-o*s,e[1]=o*i-r*u,e[2]=r*s-a*i,e}function pn(e,t,n,r){var a=t[0],o=t[1],i=t[2];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e}function mn(e,t,n,r,a,o){var i=o*o,s=i*(2*o-3)+1,u=i*(o-2)+o,l=i*(o-1),c=i*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+a[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+a[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+a[2]*c,e}function vn(e,t,n,r,a,o){var i=1-o,s=i*i,u=o*o,l=s*i,c=3*o*s,f=3*u*i,h=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*f+a[0]*h,e[1]=t[1]*l+n[1]*c+r[1]*f+a[1]*h,e[2]=t[2]*l+n[2]*c+r[2]*f+a[2]*h,e}function gn(e,t){t=t||1;var n=2*m()*Math.PI,r=2*m()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function bn(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function yn(e,t,n){var r=t[0],a=t[1],o=t[2];return e[0]=r*n[0]+a*n[3]+o*n[6],e[1]=r*n[1]+a*n[4]+o*n[7],e[2]=r*n[2]+a*n[5]+o*n[8],e}function _n(e,t,n){var r=n[0],a=n[1],o=n[2],i=n[3],s=t[0],u=t[1],l=t[2],c=a*l-o*u,f=o*s-r*l,h=r*u-a*s,d=a*h-o*f,p=o*c-r*h,m=r*f-a*c,v=2*i;return c*=v,f*=v,h*=v,d*=2,p*=2,m*=2,e[0]=s+c+d,e[1]=u+f+p,e[2]=l+h+m,e}function xn(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function wn(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Mn(e,t,n,r){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function Sn(e,t){var n=e[0],r=e[1],a=e[2],o=t[0],i=t[1],s=t[2],u=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(o*o+i*i+s*s),l=u&&hn(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function Tn(e){return e[0]=0,e[1]=0,e[2]=0,e}function On(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Pn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function In(e,t){var n=e[0],r=e[1],a=e[2],o=t[0],i=t[1],s=t[2];return Math.abs(n-o)<=d*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=d*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=d*Math.max(1,Math.abs(a),Math.abs(s))}var An,En=Xt,Cn=Zt,Ln=Kt,Dn=on,Rn=sn,Vn=Ht,Gn=un,Un=(An=kt(),function(e,t,n,r,a,o){var i,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,i=n;i<s;i+=t)An[0]=e[i],An[1]=e[i+1],An[2]=e[i+2],a(An,An,o),e[i]=An[0],e[i+1]=An[1],e[i+2]=An[2];return e});function Fn(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Bn(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Nn(e,t,n,r){var a=new p(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function jn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function kn(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function zn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Hn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function qn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function $n(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Yn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Wn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Xn(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function Zn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function Kn(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function Qn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Jn(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function er(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return Math.hypot(n,r,a,o)}function tr(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+a*a+o*o}function nr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function rr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}function ar(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function or(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function ir(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i,e}function sr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ur(e,t,n,r){var a=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],i=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],l=n[2]*r[3]-n[3]*r[2],c=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*l-h*u+d*s,e[1]=-c*l+h*i-d*o,e[2]=c*u-f*i+d*a,e[3]=-c*s+f*o-h*a,e}function lr(e,t,n,r){var a=t[0],o=t[1],i=t[2],s=t[3];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e[2]=i+r*(n[2]-i),e[3]=s+r*(n[3]-s),e}function cr(e,t){var n,r,a,o,i,s;t=t||1;do{i=(n=2*m()-1)*n+(r=2*m()-1)*r}while(i>=1);do{s=(a=2*m()-1)*a+(o=2*m()-1)*o}while(s>=1);var u=Math.sqrt((1-i)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*a*u,e[3]=t*o*u,e}function fr(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,e[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,e[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,e[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,e}function hr(e,t,n){var r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*o-u*a,f=l*a+u*r-i*o,h=l*o+i*a-s*r,d=-i*r-s*a-u*o;return e[0]=c*l+d*-i+f*-u-h*-s,e[1]=f*l+d*-s+h*-i-c*-u,e[2]=h*l+d*-u+c*-s-f*-i,e[3]=t[3],e}function dr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function pr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function mr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vr(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=t[0],s=t[1],u=t[2],l=t[3];return Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-u)<=d*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-l)<=d*Math.max(1,Math.abs(o),Math.abs(l))}var gr=Hn,br=qn,yr=$n,_r=er,xr=tr,wr=nr,Mr=rr,Sr=function(){var e=Fn();return function(t,n,r,a,o,i){var s,u;for(n||(n=4),r||(r=0),u=a?Math.min(a*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,i),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Tr(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Or(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Pr(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Ir(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>d?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Ar(e,t){var n=aa(e,t);return Math.acos(2*n*n-1)}function Er(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*c+i*s+a*l-o*u,e[1]=a*c+i*u+o*s-r*l,e[2]=o*c+i*l+r*u-a*s,e[3]=i*c-r*s-a*u-o*l,e}function Cr(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+i*s,e[1]=a*u+o*s,e[2]=o*u-a*s,e[3]=i*u-r*s,e}function Lr(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u-o*s,e[1]=a*u+i*s,e[2]=o*u+r*s,e[3]=i*u-a*s,e}function Dr(e,t,n){n*=.5;var r=t[0],a=t[1],o=t[2],i=t[3],s=Math.sin(n),u=Math.cos(n);return e[0]=r*u+a*s,e[1]=a*u-r*s,e[2]=o*u+i*s,e[3]=i*u-o*s,e}function Rr(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function Vr(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=Math.sqrt(n*n+r*r+a*a),s=Math.exp(o),u=i>0?s*Math.sin(i)/i:0;return e[0]=n*u,e[1]=r*u,e[2]=a*u,e[3]=s*Math.cos(i),e}function Gr(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=Math.sqrt(n*n+r*r+a*a),s=i>0?Math.atan2(i,o)/i:0;return e[0]=n*s,e[1]=r*s,e[2]=a*s,e[3]=.5*Math.log(n*n+r*r+a*a+o*o),e}function Ur(e,t,n){return Gr(e,t),ra(e,e,n),Vr(e,e),e}function Fr(e,t,n,r){var a,o,i,s,u,l=t[0],c=t[1],f=t[2],h=t[3],p=n[0],m=n[1],v=n[2],g=n[3];return(o=l*p+c*m+f*v+h*g)<0&&(o=-o,p=-p,m=-m,v=-v,g=-g),1-o>d?(a=Math.acos(o),i=Math.sin(a),s=Math.sin((1-r)*a)/i,u=Math.sin(r*a)/i):(s=1-r,u=r),e[0]=s*l+u*p,e[1]=s*c+u*m,e[2]=s*f+u*v,e[3]=s*h+u*g,e}function Br(e){var t=m(),n=m(),r=m(),a=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=o*Math.sin(2*Math.PI*r),e[3]=o*Math.cos(2*Math.PI*r),e}function Nr(e,t){var n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o,s=i?1/i:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-a*s,e[3]=o*s,e}function jr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function kr(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*o+o]-t[3*i+i]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*o+i]-t[3*i+o])*n,e[o]=(t[3*o+a]+t[3*a+o])*n,e[i]=(t[3*i+a]+t[3*a+i])*n}return e}function zr(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var o=Math.sin(t),i=Math.cos(t),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return e[0]=o*u*c-i*s*l,e[1]=i*s*c+o*u*l,e[2]=i*u*l-o*s*c,e[3]=i*u*c+o*s*l,e}function Hr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var qr,$r,Yr,Wr,Xr,Zr,Kr=Bn,Qr=Nn,Jr=jn,ea=kn,ta=zn,na=Er,ra=Qn,aa=sr,oa=lr,ia=nr,sa=ia,ua=rr,la=ua,ca=ir,fa=mr,ha=vr,da=(qr=kt(),$r=qt(1,0,0),Yr=qt(0,1,0),function(e,t,n){var r=hn(t,n);return r<-.999999?(dn(qr,$r,t),Vn(qr)<1e-6&&dn(qr,Yr,t),fn(qr,qr),Pr(e,qr,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(dn(qr,t,n),e[0]=qr[0],e[1]=qr[1],e[2]=qr[2],e[3]=1+r,ca(e,e))}),pa=(Wr=Tr(),Xr=Tr(),function(e,t,n,r,a,o){return Fr(Wr,t,a,o),Fr(Xr,n,r,o),Fr(e,Wr,Xr,2*o*(1-o)),e}),ma=(Zr=ge(),function(e,t,n,r){return Zr[0]=n[0],Zr[3]=n[1],Zr[6]=n[2],Zr[1]=r[0],Zr[4]=r[1],Zr[7]=r[2],Zr[2]=-t[0],Zr[5]=-t[1],Zr[8]=-t[2],ca(e,kr(e,Zr))});function va(){var e=new p(8);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function ga(e){var t=new p(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ba(e,t,n,r,a,o,i,s){var u=new p(8);return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=a,u[5]=o,u[6]=i,u[7]=s,u}function ya(e,t,n,r,a,o,i){var s=new p(8);s[0]=e,s[1]=t,s[2]=n,s[3]=r;var u=.5*a,l=.5*o,c=.5*i;return s[4]=u*r+l*n-c*t,s[5]=l*r+c*e-u*n,s[6]=c*r+u*t-l*e,s[7]=-u*e-l*t-c*n,s}function _a(e,t,n){var r=.5*n[0],a=.5*n[1],o=.5*n[2],i=t[0],s=t[1],u=t[2],l=t[3];return e[0]=i,e[1]=s,e[2]=u,e[3]=l,e[4]=r*l+a*u-o*s,e[5]=a*l+o*i-r*u,e[6]=o*l+r*s-a*i,e[7]=-r*i-a*s-o*u,e}function xa(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function wa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ma(e,t){var n=Tr();wt(n,t);var r=new p(3);return _t(r,t),_a(e,n,r),e}function Sa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Ta(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Oa(e,t,n,r,a,o,i,s,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=o,e[5]=i,e[6]=s,e[7]=u,e}var Pa=Jr;function Ia(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Aa=Jr;function Ea(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Ca(e,t){var n=t[4],r=t[5],a=t[6],o=t[7],i=-t[0],s=-t[1],u=-t[2],l=t[3];return e[0]=2*(n*l+o*i+r*u-a*s),e[1]=2*(r*l+o*s+a*i-n*u),e[2]=2*(a*l+o*u+n*s-r*i),e}function La(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=.5*n[0],u=.5*n[1],l=.5*n[2],c=t[4],f=t[5],h=t[6],d=t[7];return e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=i*s+a*l-o*u+c,e[5]=i*u+o*s-r*l+f,e[6]=i*l+r*u-a*s+h,e[7]=-r*s-a*u-o*l+d,e}function Da(e,t,n){var r=-t[0],a=-t[1],o=-t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=s*i+c*r+u*o-l*a,h=u*i+c*a+l*r-s*o,d=l*i+c*o+s*a-u*r,p=c*i-s*r-u*a-l*o;return Cr(e,t,n),r=e[0],a=e[1],o=e[2],i=e[3],e[4]=f*i+p*r+h*o-d*a,e[5]=h*i+p*a+d*r-f*o,e[6]=d*i+p*o+f*a-h*r,e[7]=p*i-f*r-h*a-d*o,e}function Ra(e,t,n){var r=-t[0],a=-t[1],o=-t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=s*i+c*r+u*o-l*a,h=u*i+c*a+l*r-s*o,d=l*i+c*o+s*a-u*r,p=c*i-s*r-u*a-l*o;return Lr(e,t,n),r=e[0],a=e[1],o=e[2],i=e[3],e[4]=f*i+p*r+h*o-d*a,e[5]=h*i+p*a+d*r-f*o,e[6]=d*i+p*o+f*a-h*r,e[7]=p*i-f*r-h*a-d*o,e}function Va(e,t,n){var r=-t[0],a=-t[1],o=-t[2],i=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=s*i+c*r+u*o-l*a,h=u*i+c*a+l*r-s*o,d=l*i+c*o+s*a-u*r,p=c*i-s*r-u*a-l*o;return Dr(e,t,n),r=e[0],a=e[1],o=e[2],i=e[3],e[4]=f*i+p*r+h*o-d*a,e[5]=h*i+p*a+d*r-f*o,e[6]=d*i+p*o+f*a-h*r,e[7]=p*i-f*r-h*a-d*o,e}function Ga(e,t,n){var r=n[0],a=n[1],o=n[2],i=n[3],s=t[0],u=t[1],l=t[2],c=t[3];return e[0]=s*i+c*r+u*o-l*a,e[1]=u*i+c*a+l*r-s*o,e[2]=l*i+c*o+s*a-u*r,e[3]=c*i-s*r-u*a-l*o,s=t[4],u=t[5],l=t[6],c=t[7],e[4]=s*i+c*r+u*o-l*a,e[5]=u*i+c*a+l*r-s*o,e[6]=l*i+c*o+s*a-u*r,e[7]=c*i-s*r-u*a-l*o,e}function Ua(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],u=n[1],l=n[2],c=n[3];return e[0]=r*c+i*s+a*l-o*u,e[1]=a*c+i*u+o*s-r*l,e[2]=o*c+i*l+r*u-a*s,e[3]=i*c-r*s-a*u-o*l,s=n[4],u=n[5],l=n[6],c=n[7],e[4]=r*c+i*s+a*l-o*u,e[5]=a*c+i*u+o*s-r*l,e[6]=o*c+i*l+r*u-a*s,e[7]=i*c-r*s-a*u-o*l,e}function Fa(e,t,n,r){if(Math.abs(r)<d)return Sa(e,t);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),i=o*n[0]/a,s=o*n[1]/a,u=o*n[2]/a,l=Math.cos(r),c=t[0],f=t[1],h=t[2],p=t[3];e[0]=c*l+p*i+f*u-h*s,e[1]=f*l+p*s+h*i-c*u,e[2]=h*l+p*u+c*s-f*i,e[3]=p*l-c*i-f*s-h*u;var m=t[4],v=t[5],g=t[6],b=t[7];return e[4]=m*l+b*i+v*u-g*s,e[5]=v*l+b*s+g*i-m*u,e[6]=g*l+b*u+m*s-v*i,e[7]=b*l-m*i-v*s-g*u,e}function Ba(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Na(e,t,n){var r=t[0],a=t[1],o=t[2],i=t[3],s=n[4],u=n[5],l=n[6],c=n[7],f=t[4],h=t[5],d=t[6],p=t[7],m=n[0],v=n[1],g=n[2],b=n[3];return e[0]=r*b+i*m+a*g-o*v,e[1]=a*b+i*v+o*m-r*g,e[2]=o*b+i*g+r*v-a*m,e[3]=i*b-r*m-a*v-o*g,e[4]=r*c+i*s+a*l-o*u+f*b+p*m+h*g-d*v,e[5]=a*c+i*u+o*s-r*l+h*b+p*v+d*m-f*g,e[6]=o*c+i*l+r*u-a*s+d*b+p*g+f*v-h*m,e[7]=i*c-r*s-a*u-o*l+p*b-f*m-h*v-d*g,e}var ja=Na;function ka(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var za=aa;function Ha(e,t,n,r){var a=1-r;return za(t,n)<0&&(r=-r),e[0]=t[0]*a+n[0]*r,e[1]=t[1]*a+n[1]*r,e[2]=t[2]*a+n[2]*r,e[3]=t[3]*a+n[3]*r,e[4]=t[4]*a+n[4]*r,e[5]=t[5]*a+n[5]*r,e[6]=t[6]*a+n[6]*r,e[7]=t[7]*a+n[7]*r,e}function qa(e,t){var n=Xa(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function $a(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Ya=ia,Wa=Ya,Xa=ua,Za=Xa;function Ka(e,t){var n=Xa(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,a=t[1]/n,o=t[2]/n,i=t[3]/n,s=t[4],u=t[5],l=t[6],c=t[7],f=r*s+a*u+o*l+i*c;e[0]=r,e[1]=a,e[2]=o,e[3]=i,e[4]=(s-r*f)/n,e[5]=(u-a*f)/n,e[6]=(l-o*f)/n,e[7]=(c-i*f)/n}return e}function Qa(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Ja(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function eo(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],u=e[6],l=e[7],c=t[0],f=t[1],h=t[2],p=t[3],m=t[4],v=t[5],g=t[6],b=t[7];return Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-h)<=d*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=d*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-v)<=d*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-g)<=d*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-b)<=d*Math.max(1,Math.abs(l),Math.abs(b))}function to(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function no(e){var t=new p(2);return t[0]=e[0],t[1]=e[1],t}function ro(e,t){var n=new p(2);return n[0]=e,n[1]=t,n}function ao(e,t){return e[0]=t[0],e[1]=t[1],e}function oo(e,t,n){return e[0]=t,e[1]=n,e}function io(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function so(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function uo(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function lo(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function co(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function fo(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ho(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function po(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function mo(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function vo(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function go(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function bo(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function yo(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function _o(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function xo(e){var t=e[0],n=e[1];return t*t+n*n}function wo(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Mo(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function So(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function To(e,t){return e[0]*t[0]+e[1]*t[1]}function Oo(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Po(e,t,n,r){var a=t[0],o=t[1];return e[0]=a+r*(n[0]-a),e[1]=o+r*(n[1]-o),e}function Io(e,t){t=t||1;var n=2*m()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Ao(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e}function Eo(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e}function Co(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e}function Lo(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e}function Do(e,t,n,r){var a=t[0]-n[0],o=t[1]-n[1],i=Math.sin(r),s=Math.cos(r);return e[0]=a*s-o*i+n[0],e[1]=a*i+o*s+n[1],e}function Ro(e,t){var n=e[0],r=e[1],a=t[0],o=t[1],i=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+o*o),s=i&&(n*a+r*o)/i;return Math.acos(Math.min(Math.max(s,-1),1))}function Vo(e){return e[0]=0,e[1]=0,e}function Go(e){return"vec2("+e[0]+", "+e[1]+")"}function Uo(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fo(e,t){var n=e[0],r=e[1],a=t[0],o=t[1];return Math.abs(n-a)<=d*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))}var Bo=_o,No=so,jo=uo,ko=lo,zo=bo,Ho=yo,qo=xo,$o=function(){var e=to();return function(t,n,r,a,o,i){var s,u;for(n||(n=2),r||(r=0),u=a?Math.min(a*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],o(e,e,i),t[s]=e[0],t[s+1]=e[1];return t}}()},9349:()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t,n,r){var a=r.value;if("function"!=typeof a)throw new TypeError("@boundMethod decorator can only be applied to methods not: ".concat(e(a)));var o=!1;return{configurable:!0,get:function(){if(o||this===t.prototype||this.hasOwnProperty(n)||"function"!=typeof a)return a;var e=a.bind(this);return o=!0,Object.defineProperty(this,n,{configurable:!0,get:function(){return e},set:function(e){a=e,delete this[n]}}),o=!1,e},set:function(e){a=e}}}var n,r,a,o;const i=globalThis.trustedTypes,s=i?i.createPolicy("lit-html",{createHTML:e=>e}):void 0,u=`lit$${(Math.random()+"").slice(9)}$`,l="?"+u,c=`<${l}>`,f=document,h=(e="")=>f.createComment(e),d=e=>null===e||"object"!=typeof e&&"function"!=typeof e,p=Array.isArray,m=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,v=/-->/g,g=/>/g,b=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,y=/'/g,_=/"/g,x=/^(?:script|style|textarea)$/i,w=(e,...t)=>({_$litType$:1,strings:e,values:t}),M=Symbol.for("lit-noChange"),S=Symbol.for("lit-nothing"),T=new WeakMap,O=f.createTreeWalker(f,129,null,!1);class P{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let a=0,o=0;const f=e.length-1,d=this.parts,[p,w]=((e,t)=>{const n=e.length-1,r=[];let a,o=2===t?"<svg>":"",i=m;for(let t=0;t<n;t++){const n=e[t];let s,l,f=-1,h=0;for(;h<n.length&&(i.lastIndex=h,l=i.exec(n),null!==l);)h=i.lastIndex,i===m?"!--"===l[1]?i=v:void 0!==l[1]?i=g:void 0!==l[2]?(x.test(l[2])&&(a=RegExp("</"+l[2],"g")),i=b):void 0!==l[3]&&(i=b):i===b?">"===l[0]?(i=null!=a?a:m,f=-1):void 0===l[1]?f=-2:(f=i.lastIndex-l[2].length,s=l[1],i=void 0===l[3]?b:'"'===l[3]?_:y):i===_||i===y?i=b:i===v||i===g?i=m:(i=b,a=void 0);const d=i===b&&e[t+1].startsWith("/>")?" ":"";o+=i===m?n+c:f>=0?(r.push(s),n.slice(0,f)+"$lit$"+n.slice(f)+u+d):n+u+(-2===f?(r.push(void 0),t):d)}const l=o+(e[n]||"<?>")+(2===t?"</svg>":"");return[void 0!==s?s.createHTML(l):l,r]})(e,t);if(this.el=P.createElement(p,n),O.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(r=O.nextNode())&&d.length<f;){if(1===r.nodeType){if(r.hasAttributes()){const e=[];for(const t of r.getAttributeNames())if(t.endsWith("$lit$")||t.startsWith(u)){const n=w[o++];if(e.push(t),void 0!==n){const e=r.getAttribute(n.toLowerCase()+"$lit$").split(u),t=/([.?@])?(.*)/.exec(n);d.push({type:1,index:a,name:t[2],strings:e,ctor:"."===t[1]?L:"?"===t[1]?D:"@"===t[1]?R:C})}else d.push({type:6,index:a})}for(const t of e)r.removeAttribute(t)}if(x.test(r.tagName)){const e=r.textContent.split(u),t=e.length-1;if(t>0){r.textContent=i?i.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],h()),O.nextNode(),d.push({type:2,index:++a});r.append(e[t],h())}}}else if(8===r.nodeType)if(r.data===l)d.push({type:2,index:a});else{let e=-1;for(;-1!==(e=r.data.indexOf(u,e+1));)d.push({type:7,index:a}),e+=u.length-1}a++}}static createElement(e,t){const n=f.createElement("template");return n.innerHTML=e,n}}function I(e,t,n=e,r){var a,o,i,s;if(t===M)return t;let u=void 0!==r?null===(a=n.i)||void 0===a?void 0:a[r]:n.o;const l=d(t)?void 0:t._$litDirective$;return(null==u?void 0:u.constructor)!==l&&(null===(o=null==u?void 0:u.O)||void 0===o||o.call(u,!1),void 0===l?u=void 0:(u=new l(e),u.T(e,n,r)),void 0!==r?(null!==(i=(s=n).i)&&void 0!==i?i:s.i=[])[r]=u:n.o=u),void 0!==u&&(t=I(e,u.S(e,t.values),u,r)),t}class A{constructor(e,t){this.l=[],this.N=void 0,this.D=e,this.M=t}u(e){var t;const{el:{content:n},parts:r}=this.D,a=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:f).importNode(n,!0);O.currentNode=a;let o=O.nextNode(),i=0,s=0,u=r[0];for(;void 0!==u;){if(i===u.index){let t;2===u.type?t=new E(o,o.nextSibling,this,e):1===u.type?t=new u.ctor(o,u.name,u.strings,this,e):6===u.type&&(t=new V(o,this,e)),this.l.push(t),u=r[++s]}i!==(null==u?void 0:u.index)&&(o=O.nextNode(),i++)}return a}v(e){let t=0;for(const n of this.l)void 0!==n&&(void 0!==n.strings?(n.I(e,n,t),t+=n.strings.length-2):n.I(e[t])),t++}}class E{constructor(e,t,n,r){this.type=2,this.N=void 0,this.A=e,this.B=t,this.M=n,this.options=r}setConnected(e){var t;null===(t=this.P)||void 0===t||t.call(this,e)}get parentNode(){return this.A.parentNode}get startNode(){return this.A}get endNode(){return this.B}I(e,t=this){e=I(this,e,t),d(e)?e===S||null==e||""===e?(this.H!==S&&this.R(),this.H=S):e!==this.H&&e!==M&&this.m(e):void 0!==e._$litType$?this._(e):void 0!==e.nodeType?this.$(e):(e=>{var t;return p(e)||"function"==typeof(null===(t=e)||void 0===t?void 0:t[Symbol.iterator])})(e)?this.g(e):this.m(e)}k(e,t=this.B){return this.A.parentNode.insertBefore(e,t)}$(e){this.H!==e&&(this.R(),this.H=this.k(e))}m(e){const t=this.A.nextSibling;null!==t&&3===t.nodeType&&(null===this.B?null===t.nextSibling:t===this.B.previousSibling)?t.data=e:this.$(f.createTextNode(e)),this.H=e}_(e){var t;const{values:n,_$litType$:r}=e,a="number"==typeof r?this.C(e):(void 0===r.el&&(r.el=P.createElement(r.h,this.options)),r);if((null===(t=this.H)||void 0===t?void 0:t.D)===a)this.H.v(n);else{const e=new A(a,this),t=e.u(this.options);e.v(n),this.$(t),this.H=e}}C(e){let t=T.get(e.strings);return void 0===t&&T.set(e.strings,t=new P(e)),t}g(e){p(this.H)||(this.H=[],this.R());const t=this.H;let n,r=0;for(const a of e)r===t.length?t.push(n=new E(this.k(h()),this.k(h()),this,this.options)):n=t[r],n.I(a),r++;r<t.length&&(this.R(n&&n.B.nextSibling,r),t.length=r)}R(e=this.A.nextSibling,t){var n;for(null===(n=this.P)||void 0===n||n.call(this,!1,!0,t);e&&e!==this.B;){const t=e.nextSibling;e.remove(),e=t}}}class C{constructor(e,t,n,r,a){this.type=1,this.H=S,this.N=void 0,this.V=void 0,this.element=e,this.name=t,this.M=r,this.options=a,n.length>2||""!==n[0]||""!==n[1]?(this.H=Array(n.length-1).fill(S),this.strings=n):this.H=S}get tagName(){return this.element.tagName}I(e,t=this,n,r){const a=this.strings;let o=!1;if(void 0===a)e=I(this,e,t,0),o=!d(e)||e!==this.H&&e!==M,o&&(this.H=e);else{const r=e;let i,s;for(e=a[0],i=0;i<a.length-1;i++)s=I(this,r[n+i],t,i),s===M&&(s=this.H[i]),o||(o=!d(s)||s!==this.H[i]),s===S?e=S:e!==S&&(e+=(null!=s?s:"")+a[i+1]),this.H[i]=s}o&&!r&&this.W(e)}W(e){e===S?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class L extends C{constructor(){super(...arguments),this.type=3}W(e){this.element[this.name]=e===S?void 0:e}}class D extends C{constructor(){super(...arguments),this.type=4}W(e){e&&e!==S?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class R extends C{constructor(){super(...arguments),this.type=5}I(e,t=this){var n;if((e=null!==(n=I(this,e,t,0))&&void 0!==n?n:S)===M)return;const r=this.H,a=e===S&&r!==S||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,o=e!==S&&(r===S||a);a&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,e),this.H=e}handleEvent(e){var t,n;"function"==typeof this.H?this.H.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this.H.handleEvent(e)}}class V{constructor(e,t,n){this.element=e,this.type=6,this.N=void 0,this.V=void 0,this.M=t,this.options=n}I(e){I(this,e)}}null===(r=(n=globalThis).litHtmlPlatformSupport)||void 0===r||r.call(n,P,E),(null!==(a=(o=globalThis).litHtmlVersions)&&void 0!==a?a:o.litHtmlVersions=[]).push("2.0.0-rc.3");const G=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,U=Symbol();class F{constructor(e,t){if(t!==U)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e}get styleSheet(){return G&&void 0===this.t&&(this.t=new CSSStyleSheet,this.t.replaceSync(this.cssText)),this.t}toString(){return this.cssText}}const B=new Map,N=e=>{let t=B.get(e);return void 0===t&&B.set(e,t=new F(e,U)),t},j=(e,...t)=>{const n=1===e.length?e[0]:t.reduce(((t,n,r)=>t+(e=>{if(e instanceof F)return e.cssText;if("number"==typeof e)return e;throw Error("Value passed to 'css' function must be a 'css' function result: "+e+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+e[r+1]),e[0]);return N(n)},k=G?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return(e=>N("string"==typeof e?e:e+""))(t)})(e):e;var z,H,q,$;const Y={toAttribute(e,t){switch(t){case Boolean:e=e?"":null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},W=(e,t)=>t!==e&&(t==t||e==e),X={attribute:!0,type:String,converter:Y,reflect:!1,hasChanged:W};class Z extends HTMLElement{constructor(){super(),this.i=new Map,this.o=void 0,this.l=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this.h=null,this.u()}static addInitializer(e){var t;null!==(t=this.v)&&void 0!==t||(this.v=[]),this.v.push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const r=this.p(n,t);void 0!==r&&(this.m.set(r,n),e.push(r))})),e}static createProperty(e,t=X){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const a=this[e];this[t]=r,this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||X}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),this.elementProperties=new Map(e.elementProperties),this.m=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(k(e))}else void 0!==e&&t.push(k(e));return t}static p(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this.g=new Promise((e=>this.enableUpdating=e)),this.L=new Map,this._(),this.requestUpdate(),null===(e=this.constructor.v)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this.U)&&void 0!==t?t:this.U=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this.U)||void 0===t||t.splice(this.U.indexOf(e)>>>0,1)}_(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this.i.set(t,this[t]),delete this[t])}))}createRenderRoot(){var e;const t=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{G?e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):t.forEach((t=>{const n=document.createElement("style");n.textContent=t.cssText,e.appendChild(n)}))})(t,this.constructor.elementStyles),t}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this.U)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)})),this.l&&(this.l(),this.o=this.l=void 0)}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this.U)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)})),this.o=new Promise((e=>this.l=e))}attributeChangedCallback(e,t,n){this.K(e,n)}j(e,t,n=X){var r,a;const o=this.constructor.p(e,n);if(void 0!==o&&!0===n.reflect){const i=(null!==(a=null===(r=n.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==a?a:Y.toAttribute)(t,n.type);this.h=e,null==i?this.removeAttribute(o):this.setAttribute(o,i),this.h=null}}K(e,t){var n,r,a;const o=this.constructor,i=o.m.get(e);if(void 0!==i&&this.h!==i){const e=o.getPropertyOptions(i),s=e.converter,u=null!==(a=null!==(r=null===(n=s)||void 0===n?void 0:n.fromAttribute)&&void 0!==r?r:"function"==typeof s?s:null)&&void 0!==a?a:Y.fromAttribute;this.h=i,this[i]=u(t,e.type),this.h=null}}requestUpdate(e,t,n){let r=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||W)(this[e],t)?(this.L.has(e)||this.L.set(e,t),!0===n.reflect&&this.h!==e&&(void 0===this.k&&(this.k=new Map),this.k.set(e,n))):r=!1),!this.isUpdatePending&&r&&(this.g=this.q())}async q(){this.isUpdatePending=!0;try{for(await this.g;this.o;)await this.o}catch(e){Promise.reject(e)}const e=this.performUpdate();return null!=e&&await e,!this.isUpdatePending}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this.i&&(this.i.forEach(((e,t)=>this[t]=e)),this.i=void 0);let t=!1;const n=this.L;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this.U)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this.$()}catch(e){throw t=!1,this.$(),e}t&&this.E(n)}willUpdate(e){}E(e){var t;null===(t=this.U)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}$(){this.L=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this.g}shouldUpdate(e){return!0}update(e){void 0!==this.k&&(this.k.forEach(((e,t)=>this.j(t,this[t],e))),this.k=void 0),this.$()}updated(e){}firstUpdated(e){}}var K,Q,J,ee,te,ne;Z.finalized=!0,Z.elementProperties=new Map,Z.elementStyles=[],Z.shadowRootOptions={mode:"open"},null===(H=(z=globalThis).reactiveElementPlatformSupport)||void 0===H||H.call(z,{ReactiveElement:Z}),(null!==(q=($=globalThis).reactiveElementVersions)&&void 0!==q?q:$.reactiveElementVersions=[]).push("1.0.0-rc.2"),(null!==(K=(ne=globalThis).litElementVersions)&&void 0!==K?K:ne.litElementVersions=[]).push("3.0.0-rc.2");class re extends Z{constructor(){super(...arguments),this.renderOptions={host:this},this.t=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();super.update(e),this.t=((e,t,n)=>{var r,a;const o=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let i=o._$litPart$;if(void 0===i){const e=null!==(a=null==n?void 0:n.renderBefore)&&void 0!==a?a:null;o._$litPart$=i=new E(t.insertBefore(h(),e),e,void 0,n)}return i.I(e),i})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this.t)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.t)||void 0===e||e.setConnected(!1)}render(){return M}}re.finalized=!0,re._$litElement$=!0,null===(J=(Q=globalThis).litElementHydrateSupport)||void 0===J||J.call(Q,{LitElement:re}),null===(te=(ee=globalThis).litElementPlatformSupport)||void 0===te||te.call(ee,{LitElement:re});const ae=e=>null!=e?e:S,oe=e=>t=>"function"==typeof t?((e,t)=>(window.customElements.define(e,t),t))(e,t):((e,t)=>{const{kind:n,elements:r}=t;return{kind:n,elements:r,finisher(t){window.customElements.define(e,t)}}})(e,t),ie=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?{...t,finisher(n){n.createProperty(t.key,e)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:t.key,initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(n){n.createProperty(t.key,e)}};function se(e){return(t,n)=>void 0!==n?((e,t,n)=>{t.constructor.createProperty(n,e)})(e,t,n):ie(e,t)}const ue="Enter",le=()=>{},ce={label:"",value:"",select:le,unselect:le,disabled:!1,hidden:!1,selected:!1},fe=j`.select-wrapper{position:relative}.select{bottom:0;display:flex;flex-wrap:wrap;left:0;position:absolute;right:0;top:0;width:var(--select-width,100%)}.label:focus{outline:var(--select-outline,2px solid #e3e3e3)}.label:after{border-bottom:1px solid var(--color,#000);border-right:1px solid var(--color,#000);box-sizing:border-box;content:"";display:block;height:10px;margin-top:-2px;transform:rotate(45deg);transition:.2s ease-in-out;width:10px}.label.visible:after{margin-bottom:-4px;margin-top:0;transform:rotate(225deg)}select{-webkit-appearance:none;-moz-appearance:none;appearance:none;position:relative;opacity:0}select[multiple]{z-index:0}.label,select{align-items:center;background-color:var(--background-color,#fff);border-radius:var(--border-radius,4px);border:var(--border-width,1px) solid var(--border-color,#000);box-sizing:border-box;color:var(--color,#000);cursor:pointer;display:flex;font-family:var(--font-family,inherit);font-size:var(--font-size,14px);font-weight:var(--font-weight,400);min-height:var(--select-height,44px);justify-content:space-between;padding:var(--padding,0 10px);width:100%;z-index:1}@media only screen and (hover:none) and (pointer:coarse){select{z-index:2}}.dropdown{background-color:var(--border-color,#000);border-radius:var(--border-radius,4px);border:var(--border-width,1px) solid var(--border-color,#000);display:none;flex-direction:column;gap:var(--border-width,1px);justify-content:space-between;max-height:calc(var(--select-height,44px) * var(--dropdown-items,4) + var(--border-width,1px) * calc(var(--dropdown-items,4) - 1));overflow-y:scroll;position:absolute;top:calc(var(--select-height,44px) + var(--dropdown-gap,0px));width:calc(100% - var(--border-width,1px) * 2);z-index:var(--dropdown-z-index,2)}.dropdown.visible{display:flex;z-index:100}.disabled{background-color:var(--disabled-background-color,#bdc3c7);color:var(--disabled-color,#ecf0f1);cursor:default}.multi-selected{background-color:var(--selected-background-color,#e3e3e3);border-radius:var(--border-radius,4px);color:var(--selected-color,#000);display:flex;gap:8px;justify-content:space-between;padding:2px 4px}.multi-selected-wrapper{display:flex;flex-wrap:wrap;gap:4px;width:calc(100% - 30px)}.cross:after{content:'\\00d7';display:inline-block;height:100%;text-align:center;width:12px}`,he=j`.option{align-items:center;background-color:var(--background-color,#fff);box-sizing:border-box;color:var(--color,#000);cursor:pointer;display:flex;font-family:var(--font-family,inherit);font-size:var(--font-size,14px);font-weight:var(--font-weight,400);height:var(--select-height,44px);height:var(--select-height,44px);justify-content:flex-start;padding:var(--padding,0 10px);width:100%}.option:not(.disabled):focus,.option:not(.disabled):not(.selected):hover{background-color:var(--hover-background-color,#e3e3e3);color:var(--hover-color,#000)}.selected{background-color:var(--selected-background-color,#e3e3e3);color:var(--selected-color,#000)}.disabled{background-color:var(--disabled-background-color,#e3e3e3);color:var(--disabled-color,#000);cursor:default}`;var de=function(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i};let pe=class extends re{constructor(){super(...arguments),this.isSelected=!1,this.isDisabled=!1,this.isHidden=!1,this.optionValue="",this.displayedLabel="",this.optionIndex=-1}static get styles(){return he}connectedCallback(){super.connectedCallback(),this.isSelected=null!==this.getAttribute("selected"),this.isDisabled=null!==this.getAttribute("disabled"),this.isHidden=null!==this.getAttribute("hidden"),this.optionValue=this.getAttribute("value")||"",this.assignDisplayedLabel(),this.fireOnReadyCallback()}getOption(){return{label:this.displayedLabel,value:this.optionValue,select:this.select,unselect:this.unselect,selected:this.isSelected,disabled:this.isDisabled,hidden:this.isHidden}}select(){this.isSelected=!0,this.setAttribute("selected","")}unselect(){this.isSelected=!1,this.removeAttribute("selected")}setOnReadyCallback(e,t){this.onReady=e,this.optionIndex=t}setOnSelectCallback(e){this.onSelect=e}render(){const e=["option"];return this.isSelected&&e.push("selected"),this.isDisabled&&e.push("disabled"),w`<div class="${e.join(" ")}" @click="${this.fireOnSelectCallback}" @keydown="${this.fireOnSelectIfEnterPressed}" tabindex="${ae(this.isDisabled?void 0:"0")}"><slot hidden @slotchange="${this.assignDisplayedLabel}"></slot>${this.displayedLabel}</div>`}assignDisplayedLabel(){this.textContent?this.displayedLabel=this.textContent:this.getAttribute("label")&&(this.displayedLabel=this.getAttribute("label")||"")}fireOnReadyCallback(){this.onReady&&this.onReady(this.getOption(),this.optionIndex)}fireOnSelectCallback(e){e.stopPropagation(),this.onSelect&&!this.isDisabled&&this.onSelect(this.optionValue)}fireOnSelectIfEnterPressed(e){e.key===ue&&this.fireOnSelectCallback(e)}};de([se()],pe.prototype,"isSelected",void 0),de([se()],pe.prototype,"isDisabled",void 0),de([se()],pe.prototype,"isHidden",void 0),de([se()],pe.prototype,"optionValue",void 0),de([se()],pe.prototype,"displayedLabel",void 0),de([se()],pe.prototype,"optionIndex",void 0),de([t],pe.prototype,"getOption",null),de([t],pe.prototype,"select",null),de([t],pe.prototype,"unselect",null),de([t],pe.prototype,"fireOnReadyCallback",null),pe=de([oe("option-pure")],pe);var me=function(e,t,n,r){var a,o=arguments.length,i=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,n,i):a(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i};let ve=class extends re{constructor(){super(...arguments),this.options=[],this.visible=!1,this.selectedOption=ce,this._selectedOptions=[],this.disabled=!1,this.isMultipleSelect=!1,this.name="",this._id="",this.formName="",this.value="",this.values=[],this.defaultLabel="",this.totalRenderedChildOptions=-1,this.form=null,this.hiddenInput=null}static get styles(){return fe}connectedCallback(){super.connectedCallback(),this.disabled=null!==this.getAttribute("disabled"),this.isMultipleSelect=null!==this.getAttribute("multiple"),this.name=this.getAttribute("name")||"",this._id=this.getAttribute("id")||"",this.formName=this.name||this.id,this.defaultLabel=this.getAttribute("default-label")||""}open(){this.disabled||(this.visible=!0,this.removeEventListeners(),document.body.addEventListener("click",this.close,!0))}close(e){e&&this.contains(e.target)||(this.visible=!1,this.removeEventListeners())}enable(){this.disabled=!1}disable(){this.disabled=!0}get selectedIndex(){var e;return null===(e=this.nativeSelect)||void 0===e?void 0:e.selectedIndex}set selectedIndex(e){(e||0===e)&&this.selectOptionByValue(this.options[e].value)}get selectedOptions(){var e;return null===(e=this.nativeSelect)||void 0===e?void 0:e.selectedOptions}render(){const e=["label"];return this.disabled&&e.push("disabled"),this.visible&&e.push("visible"),w`<div class="select-wrapper"><select @change="${this.handleNativeSelectChange}" ?disabled="${this.disabled}" ?multiple="${this.isMultipleSelect}" name="${ae(this.name||void 0)}" id="${ae(this.id||void 0)}" size="1">${this.getNativeOptionsHtml()}</select><div class="select"><div class="${e.join(" ")}" @click="${this.visible?this.close:this.open}" @keydown="${this.openDropdownIfProperKeyIsPressed}" tabindex="0">${this.getDisplayedLabel()}</div><div class="dropdown${this.visible?" visible":""}"><slot @slotchange="${this.initializeSelect}"></slot></div></div></div>`}handleNativeSelectChange(){var e;this.selectedIndex=null===(e=this.nativeSelect)||void 0===e?void 0:e.selectedIndex}getNativeOptionsHtml(){return this.options.map(this.getSingleNativeOptionHtml)}getSingleNativeOptionHtml({value:e,label:t,hidden:n,disabled:r}){return w`<option value="${e}" ?selected="${this.isOptionSelected(e)}" ?hidden="${n}" ?disabled="${r}">${t}</option>`}isOptionSelected(e){let t=this.selectedOption.value===e;return this.isMultipleSelect&&(t=Boolean(this._selectedOptions.find((t=>t.value===e)))),t}openDropdownIfProperKeyIsPressed(e){e.key!==ue&&"Tab"!==e.key||this.open()}getDisplayedLabel(){return this.isMultipleSelect&&this._selectedOptions.length?this.getMultiSelectLabelHtml():this.selectedOption.label||this.defaultLabel}getMultiSelectLabelHtml(){return w`<div class="multi-selected-wrapper">${this._selectedOptions.map(this.getMultiSelectSelectedOptionHtml)}</div>`}getMultiSelectSelectedOptionHtml({label:e,value:t}){return w`<span class="multi-selected">${e} <span class="cross" @click="${e=>this.fireOnSelectCallback(e,t)}"></span></span>`}fireOnSelectCallback(e,t){e.stopPropagation(),this.selectOptionByValue(t)}initializeSelect(){this.processChildOptions(),this.selectDefaultOptionIfNoneSelected(),this.appendHiddenInputToClosestForm()}processChildOptions(){const e=this.querySelectorAll("option-pure");this.totalRenderedChildOptions=e.length;for(let t=0;t<e.length;t++)this.initializeSingleOption(e[t],t)}selectDefaultOptionIfNoneSelected(){!this.selectedOption.value&&!this.isMultipleSelect&&this.options.length&&this.selectOptionByValue(this.options[0].value)}initializeSingleOption(e,t){e.setOnSelectCallback(this.selectOptionByValue),this.options[t]=e.getOption(),this.options[t].selected&&this.selectOptionByValue(this.options[t].value)}removeEventListeners(){document.body.removeEventListener("click",this.close)}appendHiddenInputToClosestForm(){this.form=this.closest("form"),this.form&&!this.hiddenInput&&(this.hiddenInput=document.createElement("input"),this.hiddenInput.setAttribute("type","hidden"),this.hiddenInput.setAttribute("name",this.formName),this.form.appendChild(this.hiddenInput))}unselectAllOptions(){for(let e=0;e<this.options.length;e++)this.options[e].unselect()}selectOptionByValue(e){const t=this.options.find((({value:t})=>t===e));t&&this.setSelectValue(t)}setSelectValue(e){this.isMultipleSelect?this.setMultiSelectValue(e):this.setSingleSelectValue(e),this.updateHiddenInputInForm(),this.dispatchChangeEvent()}dispatchChangeEvent(){this.dispatchEvent(new Event("change"))}setMultiSelectValue(e){const t=this._selectedOptions.indexOf(e);-1!==t?(this.values.splice(t,1),this._selectedOptions.splice(t,1),e.unselect()):(this.values.push(e.value),this._selectedOptions.push(e),e.select()),this.requestUpdate()}setSingleSelectValue(e){this.unselectAllOptions(),this.close(),this.selectedOption=e,this.value=e.value,e.select()}updateHiddenInputInForm(){if(!this.form||!this.hiddenInput)return;this.hiddenInput.value=this.isMultipleSelect?this.values.join(","):this.value;const e=new Event("change",{bubbles:!0});this.hiddenInput.dispatchEvent(e)}};me([se()],ve.prototype,"options",void 0),me([se()],ve.prototype,"visible",void 0),me([se()],ve.prototype,"selectedOption",void 0),me([se()],ve.prototype,"_selectedOptions",void 0),me([se()],ve.prototype,"disabled",void 0),me([se()],ve.prototype,"isMultipleSelect",void 0),me([se()],ve.prototype,"name",void 0),me([se()],ve.prototype,"_id",void 0),me([se()],ve.prototype,"formName",void 0),me([se()],ve.prototype,"value",void 0),me([se()],ve.prototype,"values",void 0),me([se()],ve.prototype,"defaultLabel",void 0),me([se()],ve.prototype,"totalRenderedChildOptions",void 0),me([(({finisher:e,descriptor:t})=>(n,r)=>{var a;if(void 0===r){const r=null!==(a=n.originalKey)&&void 0!==a?a:n.key,o=null!=t?{kind:"method",placement:"prototype",key:r,descriptor:t(n.key)}:{...n,key:r};return null!=e&&(o.finisher=function(t){e(t,r)}),o}{const a=n.constructor;void 0!==t&&Object.defineProperty(n,r,t(r)),null==e||e(a,r)}})({descriptor:e=>({get(){var e;return null===(e=this.renderRoot)||void 0===e?void 0:e.querySelector("select")},enumerable:!0,configurable:!0})})],ve.prototype,"nativeSelect",void 0),me([t],ve.prototype,"close",null),me([t],ve.prototype,"getSingleNativeOptionHtml",null),me([t],ve.prototype,"getMultiSelectLabelHtml",null),me([t],ve.prototype,"getMultiSelectSelectedOptionHtml",null),me([t],ve.prototype,"initializeSelect",null),me([t],ve.prototype,"initializeSingleOption",null),me([t],ve.prototype,"removeEventListeners",null),me([t],ve.prototype,"appendHiddenInputToClosestForm",null),me([t],ve.prototype,"selectOptionByValue",null),ve=me([oe("select-pure")],ve)},4258:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r};Object.defineProperty(t,"__esModule",{value:!0}),n(9349);var i=n(3920),s=n(9977),u=function(){function e(){this._frameCount=0,this._viewMode="result"}return e.prototype.init=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,o,u,l=this;return a(this,(function(a){switch(a.label){case 0:return c=function(e){console.log(e),l._viewMode=e,l._frameCount=0},(f=document.createElement("div")).innerHTML='\n<select-pure name="View Mode" id="view-mode" style="position:absolute;right:0;width:128px;">\n  <option-pure value="result">Result</option-pure>\n  <option-pure value="bvh">Show BVH</option-pure>\n  <option-pure value="gbuffer">Show GBuffer</option-pure>\n  <option-pure value="origin">Origin</option-pure>\n</select-pure>\n  ',document.body.appendChild(f),document.querySelector("select-pure").addEventListener("change",(function(e){var t=e.target.value;c(t)})),e=i.renderEnv,t=this._scene=new i.Scene,n=this._scene.rootNode=new i.Node,this._camControl=new i.NodeControl("free"),n.addChild(this._camera=new i.Camera({clearColor:[0,1,0,1]},{near:.01,far:100,fov:Math.PI/3})),this._camera.pos.set([0,0,6]),r=this,[4,i.resource.load({type:"texture",name:"noise.tex",src:"./assets/textures/noise-rgba.webp"})];case 1:return r._noiseTex=a.sent(),u=this,[4,i.resource.load({type:"gltf",name:"scene.gltf",src:"./assets/models/walls/scene.gltf"})];case 2:return(o=u._model=a.sent()).cameras.length&&(this._camera=o.cameras[0]),t.rootNode.addChild(o.rootNode),this._gBufferRT=new i.RenderTexture({width:e.width,height:e.height,colors:[{name:"positionMetalOrSpec",format:"rgba16float"},{name:"baseColorRoughOrGloss",format:"rgba16float"},{name:"normalGlass",format:"rgba16float"},{name:"meshIndexMatIndexMatType",format:"rgba8uint"}],depthStencil:{needStencil:!1}}),this._gbufferLightMaterial=new i.Material(i.buildinEffects.rRTGBufferLight),this._gBufferDebugMesh=new i.ImageMesh(new i.Material(i.buildinEffects.iRTGShow)),this._connectGBufferRenderTexture(this._gBufferDebugMesh.material),this._rtOutput=new i.RenderTexture({width:e.width,height:e.height,forCompute:!0,colors:[{name:"color",format:"rgba16float"}]}),this._denoiseRTs={current:new i.RenderTexture({width:e.width,height:e.height,forCompute:!0,colors:[{name:"color",format:"rgba16float"}]}),pre:new i.RenderTexture({width:e.width,height:e.height,forCompute:!0,colors:[{name:"color",format:"rgba16float"}]}),final:new i.RenderTexture({width:e.width,height:e.height,forCompute:!0,colors:[{name:"color"}]})},this._denoiseTemporUnit=new i.ComputeUnit(i.buildinEffects.cRTDenoiseTempor,{x:Math.ceil(e.width/16),y:Math.ceil(e.height/16)}),this._denoiseSpaceUnit=new i.ComputeUnit(i.buildinEffects.cRTDenoiseSpace,{x:Math.ceil(e.width/16),y:Math.ceil(e.height/16)},{u_output:this._denoiseRTs.final},{WINDOW_SIZE:7}),this._connectGBufferRenderTexture(this._denoiseSpaceUnit),this._rtBlit=new i.ImageMesh(new i.Material(i.buildinEffects.iBlit,{u_texture:this._denoiseRTs.final})),this._rtDebugInfo=new s.DebugInfo,this._camControl.control(this._camera,new i.Node),this._camControl.onChange=function(){l._frameCount=0},[4,this._frame(16)];case 3:return a.sent(),[2]}var c,f}))}))},e.prototype.update=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this._frame(e)];case 1:return t.sent(),[2]}}))}))},e.prototype._frame=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){return t=this._scene,this._frameCount+=1,(n=(this._frameCount-1)/this._frameCount)>.999||(t.startFrame(e),!this._rtManager&&(this._rtManager=new i.RayTracingManager,this._rtManager.process(this._scene.cullCamera(this._camera),this._rtOutput),this._rtManager.rtUnit.setUniform("u_noise",this._noiseTex),this._connectGBufferRenderTexture(this._rtManager.rtUnit)),this._rtManager.rtUnit.setUniform("u_randoms",new Float32Array(16).map((function(e){return Math.random()}))),this._denoiseTemporUnit.setUniform("u_preWeight",new Float32Array([n])),"bvh"===this._viewMode?this._showBVH():"gbuffer"===this._viewMode?(this._renderGBuffer(),this._showGBufferResult()):(this._renderGBuffer(),this._scene.setRenderTarget(null),this._computeRTSS(),"result"===this._viewMode?(this._computeDenoise(),this._rtBlit.material.setUniform("u_texture",this._denoiseRTs.final)):this._rtBlit.material.setUniform("u_texture",this._rtOutput),this._scene.renderImages([this._rtBlit])),this._rtDebugMesh&&t.renderCamera(this._camera,[this._rtDebugMesh],!1),t.endFrame()),[2]}))}))},e.prototype._renderGBuffer=function(){var e=this;this._scene.setRenderTarget(this._gBufferRT);var t=this._scene.lights.map((function(t){return t.requireLightMesh(e._gbufferLightMaterial)})).filter((function(e){return!!e}));this._scene.renderCamera(this._camera,o([this._rtManager.gBufferMesh],t))},e.prototype._computeRTSS=function(){this._scene.computeUnits([this._rtManager.rtUnit])},e.prototype._computeDenoise=function(){var e=this._denoiseRTs,t=e.current,n=e.pre;this._denoiseTemporUnit.setUniform("u_output",t),this._denoiseTemporUnit.setUniform("u_pre",n),this._denoiseTemporUnit.setUniform("u_current",this._rtOutput),this._denoiseSpaceUnit.setUniform("u_mixed",t),this._scene.computeUnits([this._denoiseTemporUnit,this._denoiseSpaceUnit]),this._denoiseRTs.current=n,this._denoiseRTs.pre=t},e.prototype._showGBufferResult=function(){this._scene.setRenderTarget(null),this._scene.renderImages([this._gBufferDebugMesh])},e.prototype._showBVH=function(){this._scene.setRenderTarget(null),this._scene.renderCamera(this._camera,o(this._scene.cullCamera(this._camera),[this._rtManager.bvhDebugMesh]))},e.prototype._connectGBufferRenderTexture=function(e){e.setUniform("u_gbPositionMetalOrSpec",this._gBufferRT,"positionMetalOrSpec"),e.setUniform("u_gbBaseColorRoughOrGloss",this._gBufferRT,"baseColorRoughOrGloss"),e.setUniform("u_gbNormalGlass",this._gBufferRT,"normalGlass"),e.setUniform("u_gbMeshIndexMatIndexMatType",this._gBufferRT,"meshIndexMatIndexMatType")},e}();t.default=u},9977:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.sampleCircle=t.debugRayShadow=t.debugRayShadows=t.debugRay=t.DebugInfo=void 0;var o=n(3920),i=function(){function e(){}return e.prototype.setup=function(e){var t=o.renderEnv,n=this._size=28;this._cpu=new Float32Array(n*t.width*t.height),this._gpu=o.createGPUBuffer(this._cpu,GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC),this._view=o.createGPUBufferBySize(n*t.width*t.height*4,GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST),this._rtManager=e,this._rtManager.rtUnit.setUniform("u_debugInfo",this._cpu,this._gpu)},e.prototype.run=function(e){e.copyBuffer(this._gpu,this._view,this._cpu.byteLength)},e.prototype.showDebugInfo=function(e,t,n){return r(this,void 0,void 0,(function(){var r,i,s,u,l,c,f,h;return a(this,(function(a){switch(a.label){case 0:return[4,this._view.mapAsync(GPUMapMode.READ)];case 1:return a.sent(),r=new Float32Array(this._view.getMappedRange()),i=this._decodeDebugInfo(r,e,t,n),s=new Float32Array(6*i.length*3),u=new Float32Array(6*i.length*3),l=new Uint32Array(6*i.length),i.forEach((function(e,t){var n=e.preOrigin,r=e.preDir,a=e.origin,o=e.dir,i=e.nextOrigin,c=e.nextDir,f=3*t*6,h=6*t;s.set(n.slice(0,3),f),s.set(r.slice(0,3),f+3),u.set([1,0,0],f),u.set([1,0,0],f+3),s.set(a.slice(0,3),f+6),s.set(o.slice(0,3),f+9),u.set([0,1,0],f+6),u.set([0,1,0],f+9),s.set(i.slice(0,3),f+12),s.set(c.slice(0,3),f+15),u.set([0,0,1],f+12),u.set([0,0,1],f+15),l.set([3*t,3*t+1,3*t+2,3*t+3,3*t+4,3*t+5],h)})),c=new o.Geometry([{layout:{arrayStride:12,attributes:[{name:"position",shaderLocation:0,offset:0,format:"float32x3"}]},data:s},{layout:{arrayStride:12,attributes:[{name:"color_0",shaderLocation:1,offset:0,format:"float32x3"}]},data:u}],l,6*i.length),f=new o.Material(o.buildinEffects.rColor,{u_color:new Float32Array([1,1,1])},void 0,{cullMode:"none",primitiveType:"line-list",depthCompare:"always"}),h=new o.Mesh(c,f),this._view.unmap(),[2,{rays:i,mesh:h}]}}))}))},e.prototype._decodeDebugInfo=function(e,t,n,r){for(var a=[],i=t[1];i<t[1]+n[1]*r[1];i+=r[1])for(var s=t[0];s<t[0]+n[0]*r[0];s+=r[0]){var u=(i*o.renderEnv.width+s)*this._size;a.push({preOrigin:e.slice(u,u+4),preDir:e.slice(u+4,u+8),origin:e.slice(u+8,u+12),dir:e.slice(u+12,u+16),nextOrigin:e.slice(u+16,u+20),nextDir:e.slice(u+20,u+24),normal:e.slice(u+24,u+28)})}return console.log([].join("\n")),a},e}();t.DebugInfo=i;var s=[];function u(e,t,n){var r={origin:e.origin,dir:e.dir,invDir:new Float32Array(3)};o.math.vec3.div(r.invDir,new Float32Array([1,1,1]),r.dir);var a=e.dir[3];console.log("rayInfo",e),console.log("ray maxT",r,a),console.log(r.origin.map((function(e,t){return e+r.dir[t]*a}))),s.push("ParametricPlot3D[{"+r.dir[0]+"t + "+r.origin[0]+", "+r.dir[1]+"t + "+r.origin[1]+", "+r.dir[2]+"t + "+r.origin[2]+"}, {t, 0, "+a+"}]");var i=function(e,t,n,r){var a={hit:!1,t:n,hitPoint:null,weights:null},o=Array(e.maxDepth);o[0]=0;for(var i=0;i>=0;){var s=f(o[i]),u=s.isLeaf,l=s.offset;if(i-=1,u){var d=m(e,t,r,l);if(console.log("leaf hit",d.hit),d.hit&&d.t<n)return d}else{var p=h(e,l),v=c(t,p.max,p.min);console.log("box hit",l,p.child0Index,p.child1Index,p.max,p.min,v),v<0||(o[i+=1]=p.child0Index,o[i+=1]=p.child1Index)}}return a}(t,r,e.preOrigin[0],n);console.log(i)}t.debugRay=function(e,t,n){var r={origin:e.origin,dir:e.dir,invDir:new Float32Array(3)};o.math.vec3.div(r.invDir,new Float32Array([1,1,1]),r.dir),console.log("ray info",e),console.log("ray",r);var a=function(e,t,n){var r={hit:!1,t:1/0,hitPoint:null,weights:null},a=Array(e.maxDepth);a[0]=0;for(var o=0;o>=0;){var i=f(a[o]),s=i.isLeaf,u=i.offset;if(o-=1,s){var l=m(e,t,n,u);console.log("leaf hit",l.hit&&l.t<r.t),l.hit&&l.t<r.t&&(r=l)}else{var d=h(e,u),p=c(t,d.max,d.min);console.log("box hit",u,d,p,!(p<0||p>r.t)),p<0||(a[o+=1]=d.child0Index,a[o+=1]=d.child1Index)}}return r}(t,r,n);console.log(a)},t.debugRayShadows=function(e,t,n){s=[],e.forEach((function(e){return u(e,t,n)})),console.log("Show[\n"+s.join(",\n")+"\n]")},t.debugRayShadow=u,t.sampleCircle=function(e){var t,n,r=[2*e[0]-1,2*e[1]-1];console.log("start",e.slice(0,2),r),Math.abs(r[0])>Math.abs(r[1])?(t=r[0],n=.25*Math.PI*r[1]/r[0]):(t=r[1],n=Math.PI*(.5-.25*r[0]/r[1]));var a=t*Math.cos(n),o=t*Math.sin(n);console.log(t,n,Math.cos(n),Math.sin(n)),console.log(a,o,Math.sqrt(1-a*a-o*o))};var l=.005;function c(e,t,n){var r=o.math.vec3.sub(new Float32Array(3),n,e.origin);o.math.vec3.mul(r,r,e.invDir);var a=o.math.vec3.sub(new Float32Array(3),t,e.origin);o.math.vec3.mul(a,a,e.invDir);var i=o.math.vec3.min(new Float32Array(3),r,a),s=o.math.vec3.max(new Float32Array(3),r,a),u=Math.max(i[0],Math.max(i[1],i[2])),c=Math.min(s[0],Math.min(s[1],s[2]));return c-u<-l?-1:u>-l?u+l:c+l}function f(e){return{isLeaf:e>>31!=0,offset:e<<1>>1}}function h(e,t){var n=4*t,r=e.buffer.slice(n,n+4),a=e.buffer.slice(n+4,n+8);return{child0Index:new Uint32Array(r.buffer,0,1)[0],child1Index:new Uint32Array(a.buffer,0,1)[0],min:r.slice(1),max:a.slice(1)}}function d(e,t){var n=4*t,r=new Uint32Array(e.buffer.buffer,4*n,4);return{primitives:r[0],indexes:r.slice(1)}}function p(e,t,n){var r={hit:!1,t:1/0,hitPoint:null,weights:null},a=t.indexes,i=n.slice(4*a[0],4*a[0]+4),s=n.slice(4*a[1],4*a[1]+4),u=n.slice(4*a[2],4*a[2]+4),l=o.math.vec3.sub(new Float32Array(3),s,i),c=o.math.vec3.sub(new Float32Array(3),u,i),f=o.math.vec3.cross(new Float32Array(3),e.dir,c),h=o.math.vec3.dot(l,f),d=o.math.vec3.sub(new Float32Array(3),e.origin,i);if(h<0&&(o.math.vec3.scale(d,d,-1),h=-h),h<1e-4)return r;var p=o.math.vec3.dot(d,f);if(p<0||p>h)return r;var m=o.math.vec3.cross(new Float32Array(3),d,l),v=o.math.vec3.dot(e.dir,m);if(v<0||v+p-h>0)return r;var g=o.math.vec3.dot(c,m);if(g<0)return r;var b=1/h,y=o.math.vec3.add(new Float32Array(3),e.origin,o.math.vec3.scale(new Float32Array(3),e.dir,g*b)),_=o.math.vec3.scale(new Float32Array(3),new Float32Array([0,p,v]),b);return _[0]=1-_[1]-_[2],r.hit=!0,r.weights=_,r.hitPoint=y,r.t=g*b,r}function m(e,t,n,r){var a=d(e,r),o={hit:!1,t:1/0,hitPoint:null,weights:null};console.log(new Uint32Array([r+0|2147483648])[0],a);for(var i=0;i<a.primitives;i+=1){var s=p(t,a=d(e,r+i),n);console.log("triangle hit",new Uint32Array([r+i|2147483648])[0],s,s.hit&&s.t<o.t),s.hit&&s.t<o.t&&(o=s)}return o}},7583:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3920),i=n(4258),s=document.createElement("div");s.style.position="fixed",s.style.left=s.style.top="0",s.style.color="red",s.style.fontSize="24px",document.body.append(s);var u=new i.default,l=0;function c(e){return r(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return[4,u.update(e)];case 1:return n.sent(),t=1e3/e,Math.abs(t-l)>2&&(s.innerText=t.toFixed(2)+"fps"),l=t,[2]}}))}))}!function(){r(this,void 0,void 0,(function(){function e(n){return r(this,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,c(n-t)];case 1:return r.sent(),t=n,requestAnimationFrame(e),[2]}}))}))}var t;return a(this,(function(n){switch(n.label){case 0:return[4,o.init(document.querySelector("canvas#mainCanvas"))];case 1:return n.sent(),[4,u.init()];case 2:return n.sent(),t=0,[4,e(performance.now())];case 3:return n.sent(),[2]}}))}))}()},3523:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var r=n(8872),a=n(5553),o=n(4329),i=n(8140),s={};t.default=s;var u={USE_TEXCOORD_0:!1,USE_NORMAL:!1,USE_TANGENT:!1,USE_COLOR_0:!1,USE_TEXCOORD_1:!1};t.init=function(){var e={value:new Float32Array(4),gpuValue:o.createGPUBuffer(new Float32Array(4),GPUBufferUsage.STORAGE)};s.rColor=new a.default("rColor",{vs:n(1821),fs:n(1715),uniformDesc:{uniforms:[{name:"u_color",type:"vec4",defaultValue:new Float32Array([1,0,0,1])}]},marcos:u}),s.rUnlit=new a.default("rUnlit",{vs:n(1821),fs:n(933),uniformDesc:{uniforms:[{name:"u_baseColorFactor",type:"vec4",defaultValue:new Float32Array([1,1,1,1])}],textures:[{name:"u_baseColorTexture",defaultValue:i.default.white}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]},marcos:u}),s.rPBR=new a.default("rPBR",{vs:n(1821),fs:n(933),uniformDesc:{uniforms:[{name:"u_baseColorFactor",type:"vec4",defaultValue:new Float32Array([1,1,1,1])},{name:"u_normalTextureScale",type:"number",defaultValue:new Float32Array([1])},{name:"u_metallicFactor",type:"number",defaultValue:new Float32Array([1])},{name:"u_roughnessFactor",type:"number",defaultValue:new Float32Array([1])},{name:"u_specularFactor",type:"vec3",defaultValue:new Float32Array([3])},{name:"u_glossinessFactor",type:"number",defaultValue:new Float32Array([1])}],textures:[{name:"u_baseColorTexture",defaultValue:i.default.empty},{name:"u_normalTexture",defaultValue:i.default.empty},{name:"u_metallicRoughnessTexture",defaultValue:i.default.empty},{name:"u_specularGlossinessTexture",defaultValue:i.default.empty}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]},marcos:Object.assign({},u,{USE_SPEC_GLOSS:!1,USE_GLASS:!1})}),s.rSkybox=new a.default("rSkybox",{vs:n(2705),fs:n(3718),uniformDesc:{uniforms:[{name:"u_color",type:"vec4",defaultValue:r.mat4.identity(new Float32Array(4))},{name:"u_factor",type:"number",defaultValue:new Float32Array(1)},{name:"u_rotation",type:"number",defaultValue:new Float32Array(1)},{name:"u_exposure",type:"number",defaultValue:new Float32Array(1)}],textures:[{name:"u_cubeTexture",defaultValue:i.default.cubeWhite}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]}}),s.rRTGBuffer=new a.default("rRTGBuffer",{vs:n(9286),fs:n(4413),uniformDesc:{uniforms:[{name:"u_matId2TexturesId",type:"vec4",format:"i32",size:128,defaultValue:new Int32Array(256)},{name:"u_baseColorFactors",type:"vec4",size:128,defaultValue:new Float32Array(512)},{name:"u_metallicRoughnessFactorNormalScaleMaterialTypes",type:"vec4",size:128,defaultValue:new Float32Array(128)},{name:"u_specularGlossinessFactors",type:"vec4",size:128,defaultValue:new Float32Array(128)}],textures:[{name:"u_baseColorTextures",defaultValue:i.default.array1white},{name:"u_normalTextures",defaultValue:i.default.array1white},{name:"u_metalRoughOrSpecGlossTextures",defaultValue:i.default.array1white}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]},marcos:u}),s.rRTGBufferLight=new a.default("rRTGBufferLight",{vs:n(1821),fs:n(461),uniformDesc:{uniforms:[{name:"u_lightColor",type:"vec4",defaultValue:new Float32Array(4)}],textures:[],samplers:[]},marcos:u}),s.cRTSS=new a.default("cRTSS",{cs:n(1540),uniformDesc:{uniforms:[{name:"u_randoms",type:"vec4",size:4,defaultValue:new Float32Array(16)},{name:"u_matId2TexturesId",type:"vec4",format:"i32",size:128,defaultValue:new Int32Array(256)},{name:"u_baseColorFactors",type:"vec4",size:128,defaultValue:new Float32Array(512)},{name:"u_metallicRoughnessFactorNormalScaleMaterialTypes",type:"vec4",size:128,defaultValue:new Float32Array(128)},{name:"u_specularGlossinessFactors",type:"vec4",size:128,defaultValue:new Float32Array(128)}],storages:[{name:"u_positions",type:"vec3",defaultValue:e.value,gpuValue:e.gpuValue},{name:"u_normals",type:"vec3",defaultValue:e.value,gpuValue:e.gpuValue},{name:"u_uvs",type:"vec2",defaultValue:e.value,gpuValue:e.gpuValue},{name:"u_meshMatIndexes",type:"vec2",format:"u32",defaultValue:e.value,gpuValue:e.gpuValue},{name:"u_bvh",type:"vec4",defaultValue:e.value,gpuValue:e.gpuValue},{name:"u_debugInfo",type:"number",customStruct:{name:"DebugInfo",code:"\nstruct DebugRay {\n  preOrigin: vec4<f32>;\n  preDir: vec4<f32>;\n  origin: vec4<f32>;\n  dir: vec4<f32>;\n  nextOrigin: vec4<f32>;\n  nextDir: vec4<f32>;\n  normal: vec4<f32>;\n};\n\n[[block]] struct DebugInfo {\n  rays: array<DebugRay>;\n};"},writable:!0,defaultValue:e.value,gpuValue:e.gpuValue}],textures:[{name:"u_output",defaultValue:i.default.empty,storageAccess:"write-only",storageFormat:"rgba16float"},{name:"u_noise",defaultValue:i.default.empty},{name:"u_gbPositionMetalOrSpec",defaultValue:i.default.empty},{name:"u_gbBaseColorRoughOrGloss",defaultValue:i.default.empty},{name:"u_gbNormalGlass",defaultValue:i.default.empty},{name:"u_gbMeshIndexMatIndexMatType",format:"uint",defaultValue:i.default.empty},{name:"u_baseColorTextures",defaultValue:i.default.array1white},{name:"u_normalTextures",defaultValue:i.default.array1white},{name:"u_metalRoughOrSpecGlossTextures",defaultValue:i.default.array1white}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}},{name:"u_samplerGB",defaultValue:{magFilter:"nearest",minFilter:"nearest"}}]},marcos:{BVH_DEPTH:0}}),s.cRTDenoiseTempor=new a.default("cRTDenoiseTempor",{cs:n(1708),uniformDesc:{uniforms:[{name:"u_preWeight",type:"number",format:"f32",defaultValue:new Float32Array([1])}],textures:[{name:"u_output",defaultValue:i.default.empty,storageAccess:"write-only",storageFormat:"rgba16float"},{name:"u_pre",defaultValue:i.default.empty,storageAccess:"read-only",storageFormat:"rgba16float"},{name:"u_current",defaultValue:i.default.empty,storageAccess:"read-only",storageFormat:"rgba16float"}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]}}),s.cRTDenoiseSpace=new a.default("cRTDenoiseSpace",{cs:n(5536),uniformDesc:{uniforms:[{name:"u_filterFactors",type:"vec2",size:4,defaultValue:o.genGaussianParams(new Float32Array([1.5,.5,1.5,.5]),[2,3,1,3])}],textures:[{name:"u_output",defaultValue:i.default.empty,storageAccess:"write-only"},{name:"u_mixed",defaultValue:i.default.empty,storageAccess:"read-only",storageFormat:"rgba16float"},{name:"u_gbPositionMetalOrSpec",defaultValue:i.default.empty},{name:"u_gbNormalGlass",defaultValue:i.default.empty}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}}]},marcos:{WINDOW_SIZE:7}}),s.iRTGShow=new a.default("iRTGShow",{vs:n(2177),fs:n(5050),uniformDesc:{uniforms:[],textures:[{name:"u_gbPositionMetalOrSpec",defaultValue:i.default.empty},{name:"u_gbBaseColorRoughOrGloss",defaultValue:i.default.empty},{name:"u_gbNormalGlass",defaultValue:i.default.empty},{name:"u_gbMeshIndexMatIndexMatType",format:"uint",defaultValue:i.default.empty}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear"}}]},marcos:{FLIP:!1}}),s.iBlit=new a.default("iBlit",{vs:n(2177),fs:n(4784),uniformDesc:{uniforms:[],textures:[{name:"u_texture",defaultValue:i.default.white}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear"}}]},marcos:{FLIP:!1}}),s.iTone=new a.default("iTone",{vs:n(2177),fs:n(9682),uniformDesc:{uniforms:[],textures:[{name:"u_texture",defaultValue:i.default.white}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear"}}]},marcos:{FLIP:!1}}),s.cCreateSimpleBlur=function(e){var t=Math.pow(2*e+1,2),r=t+(4-t%4);return new a.default("cSimpleBlur-"+e,{cs:n(5128),uniformDesc:{uniforms:[{name:"u_kernel",type:"vec4",size:r/4,defaultValue:new Float32Array(r).fill(1)}],textures:[{name:"u_input",defaultValue:i.default.white},{name:"u_output",defaultValue:i.default.white,storageAccess:"write-only"}],samplers:[{name:"u_sampler",defaultValue:{magFilter:"linear",minFilter:"linear"}}]},marcos:{RADIUS:e,WINDOW_SIZE:2*e+1,TILE_SIZE:4*e+1}})}}},3310:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var r=n(31),a={};t.default=a,t.init=function(){a.skybox=new r.default([{layout:{arrayStride:8,attributes:[{name:"position",shaderLocation:0,offset:0,format:"float32x2"}]},data:new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1])}],new Uint16Array([0,1,2,3,4,5]),6),a.rectLight=new r.default([{layout:{arrayStride:12,attributes:[{name:"position",shaderLocation:0,offset:0,format:"float32x3"}]},data:new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0])}],new Uint16Array([0,1,2,2,3,0]),6);var e=function(e){var t=2*Math.PI/e,n=new Float32Array(1539),r=new Uint16Array(1536);n.set([0,0,0]);for(var a=0,o=0;o<e;o+=1)n[3*(o+1)]=Math.cos(a),n[3*(o+1)+1]=Math.sin(a),n[3*(o+1)+2]=0,r[3*o]=0,r[3*o+1]=o+2,r[3*o+2]=o+1,a+=t;return{vertexes:n,indexes:r}}(512);a.discLight=new r.default([{layout:{arrayStride:12,attributes:[{name:"position",shaderLocation:0,offset:0,format:"float32x3"}]},data:e.vertexes}],e.indexes,e.indexes.length)}},5927:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.init=t.buildinUBTemplates=t.buildinEffects=t.buildinGeometries=t.buildinTextures=void 0;var o=n(8140);t.buildinTextures=o.default;var i=n(3310);t.buildinGeometries=i.default;var s=n(3523);t.buildinEffects=s.default;var u=n(3955);t.buildinUBTemplates=u.default,t.init=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,o.init()];case 1:return e.sent(),u.init(),i.init(),s.init(),[2]}}))}))}},8140:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var o=n(7101),i=n(4329),s=n(5879),u={};function l(e,t,n){return r(this,void 0,void 0,(function(){var o,u,l,c,f=this;return a(this,(function(h){switch(h.label){case 0:return i.isArray(n)?(o=s.default.bind,u=[void 0,e,t],[4,Promise.all(n.map((function(n){return r(f,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,createImageBitmap(new ImageData(n,e,t))];case 1:return[2,r.sent()]}}))}))})))]):[3,2];case 1:return[2,new(o.apply(s.default,u.concat([h.sent()])))];case 2:return l=s.default.bind,c=[void 0,e,t],[4,createImageBitmap(new ImageData(n,e,t))];case 3:return[2,new(l.apply(s.default,c.concat([h.sent()])))]}}))}))}t.default=u,t.init=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,s,c;return a(this,(function(a){switch(a.label){case 0:return e=u,[4,l(1,1,new Uint8ClampedArray([255,255,255,255]))];case 1:return e.empty=a.sent(),t=u,[4,l(1,1,new Uint8ClampedArray([255,255,255,255]))];case 2:return t.white=a.sent(),n=u,[4,l(1,1,new Uint8ClampedArray([0,0,0,255]))];case 3:return n.black=a.sent(),r=u,[4,l(1,1,new Uint8ClampedArray([255,0,0,255]))];case 4:return r.red=a.sent(),i=u,[4,l(1,1,new Uint8ClampedArray([0,255,0,255]))];case 5:return i.green=a.sent(),s=u,[4,l(1,1,new Uint8ClampedArray([0,0,255,255]))];case 6:return s.blue=a.sent(),c=u,[4,l(1,1,[new Uint8ClampedArray([255,255,255,255]),new Uint8ClampedArray([255,255,255,255])])];case 7:return c.array1white=a.sent(),u.cubeWhite=new o.default(1,1,new Array(6).fill(new Uint8Array([255,255,255,255]).buffer)),u.cubeBlack=new o.default(1,1,new Array(6).fill(new Uint8Array([0,0,0,255]).buffer)),[2]}}))}))}},3955:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.init=void 0;var r=n(8872),a=n(582),o=n(8140),i={};t.default=i,t.init=function(){i.global=new a.default({uniforms:[{name:"u_vp",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_view",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_proj",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_viewInverse",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_projInverse",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_skyVP",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))},{name:"u_gameTime",type:"number",defaultValue:new Float32Array([0])},{name:"u_envColor",type:"vec4",defaultValue:new Float32Array([0,0,0,0])},{name:"u_lightInfos",customType:{name:"LightInfo",len:40,code:"\nstruct LightInfo {\n  lightType: u32;\n  areaMode: u32;\n  areaSize: vec2<f32>;\n  color: vec4<f32>;\n  worldTransform: mat4x4<f32>;\n  worldTransformInverse: mat4x4<f32>;\n};"},type:"vec4",size:4,defaultValue:new Float32Array(160)}],textures:[{name:"u_envTexture",defaultValue:o.default.cubeBlack}]},a.EUBGroup.Global),i.staticMesh=new a.default({uniforms:[{name:"u_world",type:"mat4x4",defaultValue:r.mat4.identity(new Float32Array(16))}]},a.EUBGroup.Mesh)}},3278:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8872),i=n(5927),s=n(1566),u=n(9280),l=n(1119),c=function(e){function t(t,n,r){void 0===r&&(r=!1);var a=e.call(this)||this;if(a._justAsView=r,a.isCamera=!0,a.controlMode="free",a.drawSkybox=!1,n=n||{},a._near=n.near||0,a._far=n.far||1e3,a._aspect=n.aspect||l.default.width/l.default.height,n.isOrth){var i=n.sizeX,s=n.sizeY;n.sizeX>n.sizeY?i=s*a._aspect:s=i/a._aspect,a._sizeX=i,a._sizeY=s,a._isOrth=!0}else a._fov=n.fov||Math.PI/3;return a.clearColor=t.clearColor||[0,0,0,1],a.clearDepth=void 0!==t.clearDepth?t.clearDepth:1,a.clearStencil=t.clearStencil||0,a.colorOp=t.colorOp||"store",a.depthOp=t.depthOp||"store",a.stencilOp=t.stencilOp||"store",a.viewport=t.viewport||{x:0,y:0,w:1,h:1},a._viewMat=o.mat4.identity(new Float32Array(16)),a._projMat=o.mat4.identity(new Float32Array(16)),a._projInverseMat=o.mat4.identity(new Float32Array(16)),a._vpMat=o.mat4.identity(new Float32Array(16)),a._skyVPMat=o.mat4.identity(new Float32Array(16)),a}return a(t,e),t.IS=function(e){return!!e.isCamera},Object.defineProperty(t.prototype,"isOrth",{get:function(){return this._isOrth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skyboxMat",{get:function(){return this._skyboxMat},set:function(e){this._skyboxMat=e,this._skyboxMesh?this._skyboxMesh.material=e:this._skyboxMesh=new s.default(i.buildinGeometries.skybox,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vpMat",{get:function(){return this._vpMat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invViewMat",{get:function(){return this._worldMat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invProjMat",{get:function(){return this._projInverseMat},enumerable:!1,configurable:!0}),t.prototype.updateMatrix=function(){if(e.prototype.updateMatrix.call(this),this._updateViewMat(),this._updateProjMat(),o.mat4.multiply(this._vpMat,this._projMat,this._viewMat),this._skyboxMat){var t=this._skyVPMat;t.set(this._viewMat);var n=this._skyboxMat.getUniform("u_rotation")[0];n&&o.mat4.rotateY(t,t,-n),t[12]=0,t[13]=0,t[14]=0,o.mat4.multiply(t,this._projMat,t),o.mat4.invert(t,t)}l.default.setUniform("u_vp",this._vpMat),l.default.setUniform("u_view",this._viewMat),l.default.setUniform("u_proj",this._projMat),l.default.setUniform("u_viewInverse",this._worldMat),l.default.setUniform("u_projInverse",this._projInverseMat),this._skyboxMat&&(l.default.setUniform("u_skyVP",this._skyVPMat),l.default.setUniform("u_envTexture",this._skyboxMat.getUniform("u_cubeTexture")),l.default.setUniform("u_envColor",this._skyboxMat.getUniform("u_color")))},t.prototype.render=function(e,t,n,r){var a=this;void 0===r&&(r=!1);var o=this.clearColor,i=o[0],s=o[1],u=o[2],c=o[3],f=this.viewport,h=f.x,d=f.y,p=f.w,m=f.h,v=t.width,g=t.height,b=t.colorViews,y=t.depthStencilView,_={colorAttachments:b.map((function(e){return{view:e,loadValue:r?{r:i,g:s,b:u,a:c}:"load",storeOp:a.colorOp}})),depthStencilAttachment:y&&{view:y,depthLoadValue:this.clearDepth,stencilLoadValue:this.clearStencil,depthStoreOp:this.depthOp,stencilStoreOp:this.stencilOp}},x=e.beginRenderPass(_);x.setViewport(h*v,d*g,p*v,m*g,0,1),x.setBindGroup(0,l.default.bindingGroup);for(var w=0,M=n;w<M.length;w++)M[w].render(x,t);this.drawSkybox&&this._skyboxMesh&&this._skyboxMesh.render(x,t),x.endPass()},t.prototype.cull=function(e){return 0},t.prototype._updateViewMat=function(){var e=this,t=e.controlMode,n=e.target,r=e._worldMat;if("target"===t&&!n)throw new Error('Camera with control mode "target" must has target!');if("target"===t){var a=o.mat4.getTranslation(new Float32Array(3),r),i=o.mat4.getTranslation(new Float32Array(3),n.worldMat),s=o.vec3.sub(new Float32Array(3),i,a);o.vec3.normalize(s,s);var u=this._worldMat.slice(4,7);o.vec3.normalize(u,u),0===o.vec3.sqrLen(u)&&u.set([0,1,0]),o.mat4.lookAt(this._viewMat,a,i,u)}else o.mat4.invert(this._viewMat,this._worldMat)},t.prototype._updateProjMat=function(){this._isOrth?this._orthHalfZ(this._projMat,-this._sizeX,this._sizeX,-this._sizeY,this._sizeY,this._near,this._far):o.mat4.perspective(this._projMat,this._fov,this._aspect,this._near,this._far),o.mat4.invert(this._projInverseMat,this._projMat)},t.prototype._orthHalfZ=function(e,t,n,r,a,o,i){var s=1/(n-t),u=1/(r-a),l=1/(i-o),c=(n+t)*s,f=(r+a)*u,h=o*l;e[0]=2*s,e[4]=0,e[8]=0,e[12]=-c,e[1]=0,e[5]=2*u,e[9]=0,e[13]=-f,e[2]=0,e[6]=0,e[10]=-1*l,e[14]=-h,e[3]=0,e[7]=0,e[11]=0,e[15]=1},t.CLASS_NAME="Node",t}(u.default);t.default=c},3067:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(25),s=n(1119),u=function(e){function t(t,n,r,a){var o=e.call(this)||this;if(o._effect=t,o._groups=n,o.isComputeUnite=!0,o._matVersion=-1,!t.isCompute)throw new Error("ComputeUnit can only receive effect has compute shader!");return o._material=new i.default(t,r,a),o}return a(t,e),Object.defineProperty(t.prototype,"groups",{get:function(){return this._groups},enumerable:!1,configurable:!0}),t.prototype.compute=function(e){var t=this._material,n=this._groups;t.version!==this._matVersion&&(this._createPipeline(),this._matVersion=t.version),e.setPipeline(this._pipeline),e.setBindGroup(1,t.bindingGroup),e.dispatch(n.x,n.y,n.z)},t.prototype.setUniform=function(e,t,n){this._material.setUniform(e,t,n)},t.prototype.getUniform=function(e){return this._material.getUniform(e)},t.prototype.setGroups=function(e,t,n){this._groups={x:e,y:t,z:n}},t.prototype._createPipeline=function(){var e=s.default.device,t=this._material,n=Object.assign({},t.marcos),r=t.effect.getShader(n,"",s.default.shaderPrefix,"").cs;this._pipeline=e.createComputePipeline({layout:e.createPipelineLayout({bindGroupLayouts:[s.default.uniformLayout,t.effect.uniformLayout]}),compute:{module:r,entryPoint:"main"}})},t.CLASS_NAME="ComputeUnit",t}(o.default);t.default=u},7101:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(1119),s=function(e){function t(t,n,r,a){void 0===a&&(a="rgba8unorm");var o=e.call(this)||this;if(o._width=t,o._height=n,o._src=r,o._format=a,o.isCubeTexture=!0,r.length<6)throw new Error("CubeTexture must has 6 slice");return o._gpuTexture=i.default.device.createTexture({size:{width:t,height:n,depthOrArrayLayers:6},format:a,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),o._view=o._gpuTexture.createView({dimension:"cube"}),r[0]instanceof ImageBitmap?o._loadImg():o._loadBuffer(),o}return a(t,e),t.IS=function(e){return!!e.isCubeTexture},Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!1,configurable:!0}),t.prototype._loadImg=function(){var e=this;this._src.forEach((function(t,n){i.default.device.queue.copyExternalImageToTexture({source:t},{texture:e._gpuTexture,origin:{x:0,y:0,z:n}},{width:e._width,height:e._height,depthOrArrayLayers:1})}))},t.prototype._loadBuffer=function(){var e=this;this._src.forEach((function(t,n){i.default.device.queue.writeTexture({texture:e._gpuTexture,origin:{x:0,y:0,z:n}},t,{},{width:e._width,height:e._height,depthOrArrayLayers:1})}))},t.CLASS_NAME="CubeTexture",t}(o.default);t.default=s},5553:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_RENDER_STATES=void 0;var o=n(4329),i=n(1119),s=n(7568),u=n(582);t.DEFAULT_RENDER_STATES={cullMode:"back",primitiveType:"triangle-list",depthCompare:"less-equal"};var l=function(e){function n(n,r){var a=e.call(this)||this;a._options=r,a.isEffect=!0,a._shaders={},a.name=n;var o=r,i=o.cs?GPUShaderStage.COMPUTE:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT;for(var s in a._ubTemplate=new u.default(o.uniformDesc,u.EUBGroup.Material,i),a._renderStates=Object.assign({},t.DEFAULT_RENDER_STATES,o.renderState||{}),a._marcos=o.marcos||{},a._marcosRegex={},a._marcos){var l=a._marcos[s];a._marcosRegex[s]="number"==typeof l?new RegExp("\\$\\{"+s+"\\}","g"):{hasElse:new RegExp("#if defined\\("+s+"\\)([\\s\\S]+?)#else([\\s\\S]+?)#endif","g"),noElse:new RegExp("#if defined\\("+s+"\\)([\\s\\S]+?)#endif","g")}}return function(e){return!!e.cs}(o)?a._cs=o.cs:(a._vs=o.vs,a._fs=o.fs),a}return a(n,e),Object.defineProperty(n.prototype,"ubTemplate",{get:function(){return this._ubTemplate},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"uniformLayout",{get:function(){return this._ubTemplate.uniformLayout},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"renderStates",{get:function(){return this._renderStates},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isCompute",{get:function(){return!!this._cs},enumerable:!1,configurable:!0}),n.prototype.createDefaultUniformBlock=function(){return this._ubTemplate.createUniformBlock()},n.prototype.getShader=function(e,t,n,r){e=Object.assign({},this._marcos,e);var a=i.default.device,o=this._calcHash(t,n,r,e),s=this._shaders[o];if(s)return s;var u=[this._vs,this._fs,this._cs],l=function(t){var n=e[t],r=c._marcosRegex[t];u.forEach((function(e,t){if(e)if("number"==typeof n)u[t]=e.replace(r,""+n);else{var a=r,o=a.hasElse,i=a.noElse;o.lastIndex=0,i.lastIndex=0,u[t]=e.replace(o,n?"$1":"$2"),u[t]=u[t].replace(i,n?"$1":"")}}))},c=this;for(var f in this._marcos)l(f);var h=n+"\n"+r+"\n"+this._ubTemplate.shaderPrefix,d=u[0],p=u[1],m=u[2];return this._shaders[o]={vs:d&&a.createShaderModule({code:t+h+d}),fs:p&&a.createShaderModule({code:h+p}),cs:m&&a.createShaderModule({code:h+m})}},n.prototype._calcHash=function(e,t,n,r){var a=o.hashCode(e);for(var i in a=((a=(a<<5)-a+o.hashCode(t))<<5)-a+o.hashCode(n),this._marcos){var s=r[i];a=(a<<5)-a+("number"==typeof s?s:s?1:0)}return a},n.CLASS_NAME="Effect",n}(s.default);t.default=l},31:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8872),i=n(7568),s=n(4329),u=function(e){function t(t,n,r,a){var o=e.call(this)||this;return o._vertexes=t,o._indexData=n,o.count=r,o._boundingBox=a,o.isGeometry=!0,o._iBuffer=s.createGPUBuffer(n,GPUBufferUsage.INDEX),o._vBuffers=new Array(t.length),o._vLayouts=new Array(t.length),o._indexFormat=n instanceof Uint16Array?"uint16":"uint32",o._vInfo={},o._marcos={},o._attributesDef="struct Attrs {\n",t.forEach((function(e,t){var n=e.layout,r=e.data,a=e.usage,i=s.createGPUBuffer(r,0|GPUBufferUsage.VERTEX|a);n.attributes.forEach((function(e){o._marcos["USE_"+e.name.toUpperCase()]=!0,o._attributesDef+="  [[location("+e.shaderLocation+")]] "+e.name+": "+o._convertFormat(e.format)+";\n",o._vInfo[e.name.toLowerCase()]={data:r,index:t,offset:e.offset/4,stride:n.arrayStride/4,length:o._getLength(e.format)}})),o._vBuffers[t]=i,o._vLayouts[t]=n,o._vertexCount=r.byteLength/n.arrayStride})),o._attributesDef+="};\n\n",o}return a(t,e),Object.defineProperty(t.prototype,"indexes",{get:function(){return this._iBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexData",{get:function(){return this._indexData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexes",{get:function(){return this._vBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexLayouts",{get:function(){return this._vLayouts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vertexInfo",{get:function(){return this._vInfo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributesDef",{get:function(){return this._attributesDef},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexFormat",{get:function(){return this._indexFormat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"marcos",{get:function(){return this._marcos},enumerable:!1,configurable:!0}),t.prototype.calculateNormals=function(){var e=this,t=e._vInfo,n=e._vertexCount,r=e._indexData,a=e.count;if(!t.normal){var i,s,u=t.position,l=new Float32Array(3*n),c=!this._boundingBox;c&&(s=[-1/0,-1/0,-1/0],i=[1/0,1/0,1/0]);for(var f,h,d,p,m=new Uint8Array(n),v=0;v<a;v+=1){p=u.offset+r[v]*u.stride,f=u.data.slice(p,p+u.length),p=u.offset+r[v+1]*u.stride,h=u.data.slice(p,p+u.length),p=u.offset+r[v+2]*u.stride,d=u.data.slice(p,p+u.length),c&&(this._calcBonding(s,i,f),this._calcBonding(s,i,h),this._calcBonding(s,i,d)),o.vec3.sub(h,h,f),o.vec3.sub(d,d,f),o.vec3.cross(h,h,d);for(var g=0;g<3;g+=1){var b=r[v+g];if(m[b]){var y=new Float32Array(l.buffer,3*b*4,3);o.vec3.scale(y,y,m[b]),o.vec3.add(y,y,h),o.vec3.scale(y,y,1/(m[v]+1))}else l.set(h,3*b);m[b]+=1}}t.normal={offset:0,length:3,stride:3,data:l,index:0},c&&(this._boundingBox={start:i,center:s.map((function(e,t){return(e+i[t])/2})),size:s.map((function(e,t){return e-i[t]}))})}},t.prototype.getValues=function(e){return{cpu:this._vInfo[e].data,gpu:this._vBuffers[this._vInfo[e].index]}},t.prototype._calcBonding=function(e,t,n){for(var r=0;r<3;r+=1)e[r]=Math.max(e[r],n[r]),t[r]=Math.min(t[r],n[r])},t.prototype._convertFormat=function(e){switch(e){case"float32":return"f32";case"float32x2":return"vec2<f32>";case"float32x3":return"vec3<f32>";case"float32x4":return"vec4<f32>";case"uint32":return"u32";case"uint32x2":return"vec2<u32>";case"uint32x3":return"vec3<u32>";case"uint32x4":return"vec4<u32>"}throw new Error("Not support format "+e+"!")},t.prototype._getLength=function(e){switch(e){case"float32":case"uint32":return 1;case"float32x2":case"uint32x2":return 2;case"float32x3":case"uint32x3":return 3;case"float32x4":case"uint32x4":return 4}throw new Error("Not support format "+e+"!")},t.prototype.updateVertexes=function(){console.warn("Not implemented!")},t.prototype.updateIndexes=function(){console.warn("Not implemented!")},t.CLASS_NAME="Geometry",t}(i.default);t.default=u},7568:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.isHObject=!0;var t=this.constructor.CLASS_NAME;if("string"!=typeof t)throw new Error('Class must has a static member "CLASS_NAME" !');e.IDS[t]=e.IDS[t]||0,this._id=++e.IDS[t],this._hash=t+"_"+this._id}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hash",{get:function(){return this._hash},enumerable:!1,configurable:!0}),e.IDS={},e.CLASS_NAME="HObject",e}();t.default=n},3862:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(1119),s=function(e){function t(t){var n=e.call(this)||this;return n._material=t,n.isImageMesh=!0,n}return a(t,e),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e,this._pipeline=null},enumerable:!1,configurable:!0}),t.prototype.render=function(e){var t=this._material;!this._pipeline&&this._createPipeline(),e.setBindGroup(1,t.bindingGroup),e.setPipeline(this._pipeline),e.draw(6,1,0,0)},t.prototype._createPipeline=function(){var e=i.default.device,t=i.default.swapChainFormat,n=this._material,r=n.effect.getShader(n.marcos,"",i.default.shaderPrefix,""),a=r.vs,o=r.fs;this._pipeline=e.createRenderPipeline({layout:e.createPipelineLayout({bindGroupLayouts:[i.default.uniformLayout,n.effect.uniformLayout]}),vertex:{module:a,entryPoint:"main"},fragment:{module:o,targets:[{format:t}],entryPoint:"main"},primitive:{topology:"triangle-list"}})},t.CLASS_NAME="ImageMesh",t}(o.default);t.default=s},4855:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EAreaLightMode=t.ELightType=void 0;var o,i,s=n(8872),u=n(3310),l=n(1566),c=n(9280);!function(e){e[e.INVALID=0]="INVALID",e[e.Area=1]="Area",e[e.Directional=2]="Directional",e[e.Point=3]="Point",e[e.Spot=4]="Spot"}(o=t.ELightType||(t.ELightType={})),function(e){e[e.Rect=0]="Rect",e[e.Disc=1]="Disc"}(i=t.EAreaLightMode||(t.EAreaLightMode={}));var f=function(e){function t(t,n,r){var a=e.call(this)||this;a._type=t,a.isLight=!0,a._worldPos=new Float32Array(3),a._worldDir=new Float32Array(3),a._color=new Float32Array(n),a._ubInfo=new Float32Array(40);var i=new Uint32Array(a._ubInfo.buffer);return i[0]=t,t===o.Area&&(a._areaMode=r.mode,a._areaSize=new Float32Array(r.size),i[1]=a._areaMode,a._ubInfo.set(a._areaSize,2)),a}return a(t,e),t.IS=function(e){return!!e.isLight},Object.defineProperty(t.prototype,"ubInfo",{get:function(){return this._ubInfo},enumerable:!1,configurable:!0}),t.prototype.setColor=function(e,t,n){this._color.set(new Float32Array([e,t,n]))},t.prototype.requireLightMesh=function(e){if(this._type!==o.Area)throw new Error("Light mesh only support area!");return this._mesh||(this._mesh=new l.default(this._areaMode===i.Rect?u.default.rectLight:u.default.discLight,e)),this._mesh},t.prototype.updateMatrix=function(){e.prototype.updateMatrix.call(this),s.mat4.getTranslation(this._worldPos,this._worldMat),s.vec3.transformMat4(this._worldDir,[0,0,1],this._worldMat),this._mesh&&(this._mesh.scale.set(this._areaMode===i.Disc?[this._areaSize[0],this._areaSize[0],0]:[this._areaSize[0],this._areaSize[1],0]),this._mesh.updateWorldMatrix(this),this._mesh.material.setUniform("u_lightColor",this._color)),this._ubInfo.set(this._color,4),this._ubInfo.set(this._worldMat,8),this._ubInfo.set(s.mat4.invert(new Float32Array(16),this._worldMat),24)},t.CLASS_NAME="Light",t}(c.default);t.default=f},25:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n,r,a){var o=e.call(this)||this;return o._effect=t,o.isMaterial=!0,o._version=0,o._isBufferDirty=!1,o._isDirty=!0,o._uniformBlock=t.createDefaultUniformBlock(),n&&Object.keys(n).forEach((function(e){return o.setUniform(e,n[e])})),o._marcos=r||{},o._renderStates=a||{},o}return a(t,e),Object.defineProperty(t.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"marcos",{get:function(){return this._marcos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bindingGroup",{get:function(){return this._bindingGroup=this._effect.ubTemplate.getBindingGroup(this._uniformBlock,this._bindingGroup),this._bindingGroup},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primitiveType",{get:function(){return this._renderStates.primitiveType||this._effect.renderStates.primitiveType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullMode",{get:function(){return this._renderStates.cullMode||this._effect.renderStates.cullMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthCompare",{get:function(){return this._renderStates.depthCompare||this._effect.renderStates.depthCompare},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendColor",{get:function(){return this._renderStates.blendColor||this._effect.renderStates.blendColor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendAlpha",{get:function(){return this._renderStates.blendAlpha||this._effect.renderStates.blendAlpha},enumerable:!1,configurable:!0}),t.prototype.setUniform=function(e,t,n){this._effect.ubTemplate.setUniform(this._uniformBlock,e,t,n)},t.prototype.getUniform=function(e){return this._effect.ubTemplate.getUniform(this._uniformBlock,e)},t.prototype.setMarcos=function(e){Object.assign(this._marcos,e),this._version+=1},t.CLASS_NAME="Material",t}(n(7568).default);t.default=o},1566:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(9280),i=n(1119),s=n(5927),u=function(e){function t(t,n){var r=e.call(this)||this;return r._geometry=t,r._material=n,r.isMesh=!0,r.sortZ=0,r._pipelines={},r._matVersion=-1,r._ubTemplate=s.buildinUBTemplates.staticMesh,r._uniformBlock=r._ubTemplate.createUniformBlock(),r}return a(t,e),t.IS=function(e){return!!e.isMesh},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e,this._pipelines={}},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var e=new t(this._geometry,this._material);return e.pos.set(this.pos),e.quat.set(this.quat),e.scale.set(this.scale),e},t.prototype.render=function(e,t){var n=this._geometry,r=this._material;r.version===this._matVersion&&this._pipelines[t.pipelineHash]||(this._createPipeline(t),this._matVersion=r.version),this.setUniform("u_world",this._worldMat),this._bindingGroup=this._ubTemplate.getBindingGroup(this._uniformBlock,this._bindingGroup),n.vertexes.forEach((function(t,n){e.setVertexBuffer(n,t)})),e.setIndexBuffer(n.indexes,n.indexFormat),e.setBindGroup(1,r.bindingGroup),e.setBindGroup(2,this._bindingGroup),e.setPipeline(this._pipelines[t.pipelineHash]),e.drawIndexed(n.count,1,0,0,0)},t.prototype.setUniform=function(e,t,n){this._ubTemplate.setUniform(this._uniformBlock,e,t,n)},t.prototype.getUniform=function(e){return this._ubTemplate.getUniform(this._uniformBlock,e)},t.prototype._createPipeline=function(e){var t=i.default.device,n=this,r=n._geometry,a=n._material,o=n._ubTemplate;this._bindingGroup=this._ubTemplate.getBindingGroup(this._uniformBlock,this._bindingGroup);var s=Object.assign({},r.marcos,a.marcos),u=a.effect.getShader(s,r.attributesDef,i.default.shaderPrefix,o.shaderPrefix),l=u.vs,c=u.fs;this._pipelines[e.pipelineHash]=t.createRenderPipeline({layout:t.createPipelineLayout({bindGroupLayouts:[i.default.uniformLayout,a.effect.uniformLayout,o.uniformLayout]}),vertex:{module:l,entryPoint:"main",buffers:r.vertexLayouts},fragment:{module:c,targets:e.colorFormats.map((function(e){return{format:e,blend:a.blendColor?{color:a.blendColor,alpha:a.blendAlpha}:void 0}})),entryPoint:"main"},primitive:{topology:a.primitiveType,cullMode:a.cullMode},depthStencil:e.depthStencilFormat&&{format:e.depthStencilFormat,depthWriteEnabled:!0,depthCompare:a.depthCompare}})},t.CLASS_NAME="Mesh",t}(o.default);t.default=u},9280:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(8872),s=new Float32Array([1,1,1]),u=function(e){function t(){var t=e.call(this)||this;return t.isNode=!0,t.active=!0,t._children=[],t._mem=new ArrayBuffer(416),t._pos=new Float32Array(t._mem,0,3),(t._scale=new Float32Array(t._mem,12,3)).set(s),t._quat=i.quat.identity(new Float32Array(t._mem,24,4)),t._worldMat=i.mat4.identity(new Float32Array(t._mem,40,16)),t}return a(t,e),Object.defineProperty(t.prototype,"pos",{get:function(){return this._pos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quat",{get:function(){return this._quat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldMat",{get:function(){return this._worldMat},enumerable:!1,configurable:!0}),t.prototype.addChild=function(e){this._children.push(e),e._parent=this},t.prototype.removeChild=function(e){var t=this._children.indexOf(e);t>=0&&(this._children.splice(t,1),e._parent=null)},t.prototype.setLocalMat=function(e){this._updateTRSFromMat(e)},t.prototype.updateMatrix=function(){this.updateWorldMatrix()},t.prototype.updateWorldMatrix=function(e){i.mat4.fromRotationTranslationScale(this._worldMat,this._quat,this._pos,this._scale),(e=e||this._parent)&&i.mat4.mul(this._worldMat,e.worldMat,this._worldMat)},t.prototype.dfs=function(e,t){for(var n=e(this,t),r=this._children,a=0;a<r.length;a+=1){var o=r[a];o.active&&o.dfs(e,n)}},t.prototype.updateSubTree=function(e){this.active&&this.dfs((function(t){t.updateMatrix(),e&&e(t)}))},t.prototype._updateTRSFromMat=function(e){i.mat4.getTranslation(this._pos,e),i.mat4.getRotation(this._quat,e),i.mat4.getScaling(this._scale,e)},t.CLASS_NAME="Node",t}(o.default);t.default=u},2581:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(1119),s=n(4329),u=function(e){function t(t){var n=e.call(this)||this;n._options=t,n.isRenderTexture=!0;var r=t.width,a=t.height,o=t.colors,u=t.depthStencil,l=t.forCompute;if(n._width=r,n._height=a,l&&u)throw new Error("RenderTexture with forCompute flag does not support depth!");return n._colorDescs=new Array(o.length),n._colorViews=new Array(o.length),n._colorFormats=new Array(o.length),n._colorNames={},n._colors=o.map((function(e,t){var o=i.default.device.createTexture(n._colorDescs[t]={label:n.hash+"_color_"+(e.name||t),size:{width:r,height:a},format:e.format||(l?"rgba8unorm":i.default.swapChainFormat),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|(l?GPUTextureUsage.STORAGE_BINDING:0)});return n._colorViews[t]=o.createView({label:o.label}),n._colorFormats[t]=n._colorDescs[t].format,e.name&&(n._colorNames[e.name]=t),o})),u&&(n._depthStencil=i.default.device.createTexture(n._depthDesc={label:n.hash+"_depth",size:{width:r,height:a},format:u.format||(u.needStencil?"depth24plus-stencil8":"depth24plus"),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),n._depthStencilView=n._depthStencil.createView({label:n.hash+"_depth"})),n._pipelineHash=s.hashCode(n._colorDescs.map((function(e){return e.format})).join("")+(n._depthDesc?n._depthDesc.format:"")),n}return a(t,e),t.IS=function(e){return!!e.isRenderTexture},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pipelineHash",{get:function(){return this._pipelineHash},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorView",{get:function(){return this._colorViews[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilView",{get:function(){return this._depthStencilView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorFormat",{get:function(){return this._colorDescs[0].format},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilFormat",{get:function(){var e;return null===(e=this._depthDesc)||void 0===e?void 0:e.format},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorViews",{get:function(){return this._colorViews},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colorFormats",{get:function(){return this._colorFormats},enumerable:!1,configurable:!0}),t.prototype.getColorViewByName=function(e){return this._colorViews[this._colorNames[e]]},t.CLASS_NAME="RenderTexture",t}(o.default);t.default=u},822:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5927),i=n(7568),s=n(3862),u=n(4855),l=n(25),c=n(1566),f=n(1119),h=n(2581),d=function(e){function t(){var t=e.call(this)||this;return t.isScene=!0,t._renderTarget=t._screen=new h.default({width:f.default.width,height:f.default.height,colors:[{}],depthStencil:{needStencil:!0}}),t._blit=new s.default(new l.default(o.buildinEffects.iBlit,{u_texture:t._screen})),t}return a(t,e),Object.defineProperty(t.prototype,"rootNode",{get:function(){return this._rootNode},set:function(e){this._rootNode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screen",{get:function(){return this._screen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lights",{get:function(){return this._lights},enumerable:!1,configurable:!0}),t.prototype.cullCamera=function(e){var t=[];return this._meshes.forEach((function(n){var r=e.cull(n);r>=0&&(n.sortZ=r,t.push(n))})),t.sort((function(e,t){return e.sortZ-t.sortZ})),t},t.prototype.setRenderTarget=function(e){this._renderTarget=e||this._screen},t.prototype.startFrame=function(e){var t=this;this._gameTime+=e,this._meshes=[],this._lights=[],this._rootNode.updateSubTree((function(e){c.default.IS(e)?t._meshes.push(e):u.default.IS(e)&&t._lights.push(e)}));var n=f.default.getUniform("u_lightInfos");n&&(this._lights.forEach((function(e,t){t<4&&n.set(e.ubInfo,16*t)})),f.default.setUniform("u_lightInfos",n)),f.default.setUniform("u_gameTime",new Float32Array([this._gameTime/1e3])),this._command=f.default.device.createCommandEncoder()},t.prototype.renderCamera=function(e,t,n){void 0===n&&(n=!0),e.render(this._command,this._renderTarget,t,n)},t.prototype.renderImages=function(e,t){void 0===t&&(t=!0);var n={colorAttachments:[{view:this._renderTarget.colorView,loadValue:t?{r:0,g:0,b:0,a:1}:"load",storeOp:"store"}]},r=this._command.beginRenderPass(n);r.setBindGroup(0,f.default.bindingGroup);for(var a=0,o=e;a<o.length;a++)o[a].render(r);r.endPass()},t.prototype.computeUnits=function(e){var t=this._command.beginComputePass();t.setBindGroup(0,f.default.bindingGroup);for(var n=0,r=e;n<r.length;n++)r[n].compute(t);t.endPass()},t.prototype.copyBuffer=function(e,t,n){this._command.copyBufferToBuffer(e,0,t,0,n)},t.prototype.endFrame=function(){var e={colorAttachments:[{view:f.default.currentTexture.createView(),loadValue:{r:0,g:0,b:0,a:1},storeOp:"store"}]},t=this._command.beginRenderPass(e);t.setBindGroup(0,f.default.bindingGroup),this._blit.render(t),t.endPass(),f.default.device.queue.submit([this._command.finish()])},t.CLASS_NAME="Scene",t}(i.default);t.default=d},5879:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7568),i=n(1119),s=n(4329),u=function(e){function t(t,n,r,a){void 0===a&&(a="rgba8unorm");var o=e.call(this)||this;return o._width=t,o._height=n,o._src=r,o._format=a,o.isTexture=!0,s.isTextureSourceArray(r)?(o._isArray=!0,o._arrayCount=r.length):(o._isArray=!1,o._arrayCount=1),o._gpuTexture=i.default.device.createTexture({label:o.hash,size:{width:o._width,height:o._height,depthOrArrayLayers:o._arrayCount},format:a||"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),s.isTextureSourceArray(r)?(r.forEach((function(e,t){return o._load(e,t)})),o._gpuTextureView=o._gpuTexture.createView({dimension:"2d-array",arrayLayerCount:o._arrayCount})):(o._load(r),o._gpuTextureView=o._gpuTexture.createView()),o}return a(t,e),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this._format},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._src},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gpuTexture",{get:function(){return this._gpuTexture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._gpuTextureView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isArray",{get:function(){return this._isArray},enumerable:!1,configurable:!0}),t.prototype._load=function(e,t){void 0===t&&(t=0),e instanceof ImageBitmap?this._loadImg(e,t):this._loadBuffer(e,t)},t.prototype._loadImg=function(e,t){i.default.device.queue.copyExternalImageToTexture({source:e},{texture:this._gpuTexture,origin:this._isArray?{x:0,y:0,z:t}:void 0},{width:this._width,height:this._height,depthOrArrayLayers:1})},t.prototype._loadBuffer=function(e,t){i.default.device.queue.writeTexture({texture:this._gpuTexture,origin:this._isArray?{x:0,y:0,z:t}:void 0},e,{bytesPerRow:4*this._width},{width:this._width,height:this._height,depthOrArrayLayers:1})},t.prototype.updateImg=function(e,t){void 0===t&&(t=0),console.warn("Not implemented!")},t.CLASS_NAME="Texture",t}(o.default);t.default=u},582:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EUBGroup=void 0;var o,i=n(4329),s=n(1119),u=n(2581),l=n(7568),c=n(7101);!function(e){e[e.Global=0]="Global",e[e.Material=1]="Material",e[e.Mesh=2]="Mesh"}(o=t.EUBGroup||(t.EUBGroup={}));var f=function(e){function t(t,n,r){var a=e.call(this)||this;a._uniformDesc=t,a._groupId=n,a._visibility=r,a.isUBTemplate=!0;var u=s.default.device,l=void 0===r?GPUShaderStage.COMPUTE|GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT:r,f=n===o.Global?"UniformsGlobal":n===o.Mesh?"UniformsObject":"UniformsMaterial",h=n===o.Global?"global":n===o.Mesh?"mesh":"material",d=0,p=0;a._shaderPrefix="",a._uniformsInfo={};var m=[];if(t.uniforms.length){t.uniforms.forEach((function(e){e.customType&&(a._shaderPrefix+=e.customType.code+"\n")})),a._shaderPrefix+="[[block]] struct "+f+" {\n",m.push({binding:0,visibility:l,buffer:{type:"uniform"}});var v=0;t.uniforms.forEach((function(e){var t=a._getRealLayoutInfo(e.type,e.size||1,e.defaultValue,e.customType),n=t.origLen,r=t.realLen,o=t.defaultValue;a._uniformsInfo[e.name]={bindingId:0,index:d,type:"buffer",offset:v,defaultValue:o,origLen:n,realLen:r,size:e.size||1},v+=o.length;var i=e.customType?e.customType.name:"number"===e.type?""+(e.format||"f32"):e.type+"<"+(e.format||"f32")+">",s=n!==r?"[[stride("+4*r+")]]":"";e.size?e.size>1&&(a._shaderPrefix+=" [[align(16)]] "+e.name+": "+s+" array<"+i+", "+e.size+">;\n"):a._shaderPrefix+="  [[align(16)]] "+e.name+": "+i+";\n",d+=1})),a._uniformsBufferDefault=new Uint32Array(v),a._shaderPrefix+="};\n[[group("+n+"), binding(0)]] var<uniform> "+h+": "+f+";\n",p+=1}if(t.textures&&t.textures.forEach((function(e){var t=c.default.IS(e.defaultValue),r=e.defaultValue.isArray,o=t?r?"cube-array":"cube":r?"2d-array":"2d";"read-only"===e.storageAccess&&(e.storageAccess=void 0,e.format=/uint/.test(e.storageFormat)?"uint":/sint/.test(e.storageFormat)?"sint":"float"),m.push({binding:p,visibility:l,texture:e.storageAccess?void 0:{sampleType:e.format||"float",viewDimension:o},storageTexture:"write-only"===e.storageAccess?Object.assign({format:e.storageFormat||"rgba8unorm",viewDimension:o,access:e.storageAccess}):void 0}),a._uniformsInfo[e.name]={bindingId:p,index:d,type:"texture",defaultGpuValue:e.defaultValue.view};var i="depth"===e.format?"depth":"uint"===e.format?"u32":"sint"===e.format?"i32":"f32";e.storageAccess?a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var "+e.name+": texture_storage_2d<"+(e.storageFormat||"rgba8unorm")+", "+e.storageAccess.replace("-only","")+">;\n":t?a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var "+e.name+": texture_cube<"+i+">;\n":e.defaultValue.isArray?a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var "+e.name+": texture_2d_array<"+i+">;\n":a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var "+e.name+": texture_2d<"+i+">;\n",p+=1,d+=1})),t.samplers&&t.samplers.forEach((function(e){m.push({binding:p,visibility:l,sampler:{type:"filtering"}}),a._uniformsInfo[e.name]={bindingId:p,index:d,type:"sampler",defaultGpuValue:u.createSampler(e.defaultValue)},a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var "+e.name+": sampler;\n",p+=1,d+=1})),a._shaderPrefix+="\n",t.uniforms.forEach((function(e,t){var n=a._uniformsInfo[e.name];a._uniformsBufferDefault.set(new Uint32Array(n.defaultValue.buffer),n.offset)})),t.storages){var g={};t.storages.forEach((function(e){m.push({binding:p,visibility:l,buffer:{type:e.writable?"storage":"read-only-storage"}});var t="Storage"+e.type+(e.format||"f32");e.customStruct||g[t]||(a._shaderPrefix+=(g[t]=g[t]||a._getStorageStruct(t,e.type,e.format||"f32"))+"\n"),e.customStruct&&(t=e.customStruct.name,a._shaderPrefix+=e.customStruct.code);var r=e.gpuValue?e.gpuValue:i.createGPUBuffer(e.defaultValue,GPUBufferUsage.STORAGE);a._uniformsInfo[e.name]={bindingId:p,index:d,type:"storage",defaultValue:e.defaultValue,defaultGpuValue:r},a._shaderPrefix+="[[group("+n+"), binding("+p+")]] var<storage, "+(e.writable?"read_write":"read")+"> "+e.name+": "+t+";\n",d+=1,p+=1}))}return a._uniformLayoutDesc={entries:m},a._uniformLayout=u.createBindGroupLayout(a._uniformLayoutDesc),a}return a(t,e),Object.defineProperty(t.prototype,"groupId",{get:function(){return this._groupId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shaderPrefix",{get:function(){return this._shaderPrefix},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniformLayout",{get:function(){return this._uniformLayout},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniformsInfo",{get:function(){return this._uniformsInfo},enumerable:!1,configurable:!0}),t.prototype._getRealLayoutInfo=function(e,t,n,r){if(r)return{origLen:r.len,realLen:r.len,defaultValue:n};var a,o;switch(e){case"number":a=1,o=4;break;case"vec2":a=2,o=4;break;case"vec3":a=3,o=4;break;case"vec4":case"mat2x2":a=4,o=4;break;case"mat3x3":a=9,o=12;break;case"mat4x4":a=16,o=16}for(var i=new(0,n.constructor)(o*t),s=0;s<t;s+=1)i.set(n.slice(s*a,(s+1)*a),s*o);return{origLen:a,realLen:o,defaultValue:i}},t.prototype._getStorageStruct=function(e,t,n){if("number"===t)return"[[block]] struct "+e+" { value: array<"+n+">; };";if("vec2"===t||"vec3"===t||"vec4"===t)return"[[block]] struct "+e+" { value: array<"+t+"<"+n+">>; };";throw new Error("Not support type!")},t.prototype.createUniformBlock=function(){var e,t,n=this,r=this,a=r._uniformDesc,o=r._uniformsInfo,s=r._uniformsBufferDefault,u={},l=[];return s&&(t=i.createGPUBuffer(s,GPUBufferUsage.UNIFORM),e=s.slice(),l.push({binding:0,resource:{buffer:t}}),a.uniforms.forEach((function(r){var a=n._uniformsInfo[r.name];u[r.name]={value:new n._uniformsInfo[r.name].defaultValue.constructor(e.buffer,4*a.offset,a.realLen*a.size),gpuValue:t}}))),a.textures&&a.textures.forEach((function(e){var t=o[e.name].defaultGpuValue;u[e.name]={value:e.defaultValue,gpuValue:t},l.push({binding:o[e.name].bindingId,resource:t})})),a.samplers&&a.samplers.forEach((function(e){var t=o[e.name].defaultGpuValue;u[e.name]={value:e.defaultValue,gpuValue:t},l.push({binding:o[e.name].bindingId,resource:t})})),a.storages&&a.storages.forEach((function(e){var t=o[e.name].defaultGpuValue;u[e.name]={value:e.defaultValue,gpuValue:t},l.push({binding:o[e.name].bindingId,resource:{buffer:t}})})),{entries:l,values:u,layout:this._uniformLayout,cpuBuffer:e,gpuBuffer:t,isBufferDirty:!1,isDirty:!0}},t.prototype.setUniform=function(e,t,n,r){var a=this._uniformsInfo[t];if(a&&void 0!==n){var o=e.entries,s=a.bindingId,l=a.type,c=(a.offset,a.realLen),f=a.origLen,h=e.values[t];if("buffer"===l){n=n;var d=h.value;if(n="number"==typeof n?[n]:n,f!==c)for(var p=n.length/f,m=0;m<p;m+=1)d.set(n.slice(f*m,f*(m+1)),c*m);else d.set(n);e.isBufferDirty=!0}else if("sampler"===l)h.value=n,console.warn("Not implemented!");else{if("storage"!==l){if(u.default.IS(n)){var v=r?n.getColorViewByName(r):n.colorView;return o[s].resource=h.gpuValue=v,h.value=n,void(e.isDirty=!0)}if((n=n).isArray!==h.value.isArray)throw new Error("Require texture2d array!");return o[s].resource=h.gpuValue=n.view,h.value=n,void(e.isDirty=!0)}h.value=n,o[s].resource.buffer=h.gpuValue=r||i.createGPUBuffer(n,GPUBufferUsage.STORAGE),e.isDirty=!0}}},t.prototype.getUniform=function(e,t){var n;return null===(n=e.values[t])||void 0===n?void 0:n.value},t.prototype.getBindingGroup=function(e,t){return e.isBufferDirty&&(s.default.device.queue.writeBuffer(e.gpuBuffer,0,e.cpuBuffer),e.isBufferDirty=!1),e.isDirty&&(t=s.default.device.createBindGroup({layout:e.layout,entries:e.entries}),e.isDirty=!1),t},t.CLASS_NAME="UBTemplate",t}(l.default);t.default=f},1119:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderEnv=void 0;var a=function(){function e(){this.isRenderEnv=!0,this._swapChainFormat="bgra8unorm"}return Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ctx",{get:function(){return this._ctx},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this._device},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bindingGroup",{get:function(){return this._bindingGroup=this._ubTemplate.getBindingGroup(this._uniformBlock,this._bindingGroup),this._bindingGroup},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderPrefix",{get:function(){return this._ubTemplate.shaderPrefix},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uniformLayout",{get:function(){return this._ubTemplate.uniformLayout},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"swapChainFormat",{get:function(){return this._swapChainFormat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTexture",{get:function(){return this._ctx.getCurrentTexture()},enumerable:!1,configurable:!0}),e.prototype.init=function(e){return n(this,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:if(!navigator.gpu)throw new Error("WebGPU is not supported!");return[4,navigator.gpu.requestAdapter()];case 1:if(!(t=r.sent()))throw new Error("Require adapter failed!");return n=this,[4,t.requestDevice()];case 2:if(n._device=r.sent(),!this._device)throw new Error("Require device failed!");return this._canvas=e,this._ctx=e.getContext("webgpu")||e.getContext("gpupresent"),this._ctx.configure({device:this._device,format:this._swapChainFormat}),[2]}}))}))},e.prototype.createGlobal=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this._ubTemplate=e,this._uniformBlock=this._ubTemplate.createUniformBlock(),[2]}))}))},e.prototype.setUniform=function(e,t,n){this._ubTemplate.setUniform(this._uniformBlock,e,t,n)},e.prototype.getUniform=function(e){return this._ubTemplate.getUniform(this._uniformBlock,e)},e.CLASS_NAME="RenderEnv",e}();t.RenderEnv=a;var o=new a;t.default=o},4329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.genGaussianParams=t.nthElement=t.partition=t.logCanvas=t.hashCode=t.createGPUBufferBySize=t.createGPUBuffer=t.copyTypedArray=t.callWithProfile=t.isArray=t.isTextureSourceArray=void 0;var r=n(1119);function a(e,t,n){var r=e[n];e[n]=e[t],e[t]=r}t.isTextureSourceArray=function(e){return!!e.push},t.isArray=function(e){return!!e.push},t.callWithProfile=function(e,t,n){var r=performance.now();t.apply(void 0,n),console.log("Ray Tracing, "+e+": "+(performance.now()-r)/1e3+"(s)")},t.copyTypedArray=function(e,t,n,r,a){for(var o=0;o<e;o+=1)t[n+o]=r[a+o]},t.createGPUBuffer=function(e,t){var n=e.byteLength+(4-e.byteLength%4),a=r.default.device.createBuffer({size:n,usage:t|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new e.constructor(a.getMappedRange(0,n)).set(e,0),a.unmap(),a},t.createGPUBufferBySize=function(e,t){var n=r.default.device.createBuffer({size:e,usage:t|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return n.unmap(),n},t.hashCode=function(e){return e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)},t.logCanvas=function(e,t){var n=t*e.height/e.width,r=e.toDataURL();console.log("%c+","font-size: 1px; padding: "+n/2+"px "+t/2+"px; line-height: "+n+"px; background: url("+r+"); background-size: "+t+"px "+n+"px; background-repeat: no-repeat; color: transparent;")},t.partition=function(e,t,n,r){for(void 0===n&&(n=0),void 0===r&&(r=e.length);n!==r;){for(;t(e[n]);)if((n+=1)===r)return n;do{if(n===(r-=1))return n}while(!t(e[r]));a(e,n,r),n+=1}return n},t.nthElement=function(e,t,n,r,o){void 0===n&&(n=0),void 0===r&&(r=e.length),void 0===o&&(o=Math.floor((n+r)/2));for(var i=n;i<=o;i+=1)for(var s=i,u=e[i],l=i+1;l<r;l+=1)t(u,e[l])||(s=l,u=e[l],a(e,i,s))},t.genGaussianParams=function(e,t){for(var n=new Float32Array(2*e.length),r=0;r<e.length;r+=1){var a=e[r];n[2*r]=Math.pow(1/(Math.sqrt(2*Math.PI)*a),t[r]),n[2*r+1]=-1/(2*a*a)}return n}},7408:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Bounds=void 0;var o,i=n(5927),s=n(31),u=n(7568),l=n(25),c=n(1566),f=n(4329);!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(o||(o={}));var h=function(){function e(){this._isDirty=!1}return Object.defineProperty(e.prototype,"center",{get:function(){return this._center&&!this._isDirty||this._updateCenterSize(),this._center},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size&&!this._isDirty||this._updateCenterSize(),this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxExtends",{get:function(){var e=this.size;return e[0]>e[2]?e[0]>e[1]?o.X:o.Y:e[1]>e[2]?o.Z:o.Y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"surfaceArea",{get:function(){var e=this.size;return 2*(e[0]*e[2]+e[0]*e[1]+e[2]*e[1])},enumerable:!1,configurable:!0}),e.prototype.initEmpty=function(){return this.max=new Float32Array([-1/0,-1/0,-1/0]),this.min=new Float32Array([1/0,1/0,1/0]),this},e.prototype.fromVertexes=function(e,t,n){return this.max=e.slice(),this.min=e.slice(),this.update(t).update(n),this},e.prototype.update=function(e){for(var t=0;t<3;t+=1)this.max[t]=Math.max(this.max[t],e[t]),this.min[t]=Math.min(this.min[t],e[t]);return this._isDirty=!0,this},e.prototype.mergeBounds=function(e){for(var t=e.max,n=e.min,r=0;r<3;r+=1)this.max[r]=Math.max(this.max[r],t[r]),this.min[r]=Math.min(this.min[r],n[r]);return this._isDirty=!0,this},e.prototype.pointIn=function(e){var t=this.max,n=this.min;return e[0]>n[0]&&e[0]<t[0]&&e[1]>n[1]&&e[1]<t[1]&&e[2]>n[2]&&e[2]<t[2]},e.prototype.getOffset=function(e,t){var n=t[e]-this.min[e];return this.max[e]>this.min[e]&&(n/=this.max[e]-this.min[e]),n},e.prototype.buildBox=function(t){var n=this.max,r=this.min,a=[];return e.BUILD_BOX_MAX_MIN_ORDER.forEach((function(e){for(var t=0;t<3;t+=1)a.push(e[t]?n[t]:r[t])})),{positions:a,indexes:"lines"===t?[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]:[0,1,2,2,3,0,4,5,6,6,7,4,0,4,5,5,1,0,1,5,6,6,2,1,3,2,6,6,7,3,0,3,7,7,4,0]}},e.prototype._updateCenterSize=function(){var e=this;this._isDirty&&(this._center=this.max.map((function(t,n){return(t+e.min[n])/2})),this._size=this.max.map((function(t,n){return t-e.min[n]})),this._isDirty=!1)},e.BUILD_BOX_MAX_MIN_ORDER=[[1,1,1],[1,1,0],[0,1,0],[0,1,1],[1,0,1],[1,0,0],[0,0,0],[0,0,1]],e}();t.Bounds=h;var d=new Float32Array(3),p=new Float32Array(3),m=new Float32Array(3),v=function(e){function t(t){var n=e.call(this)||this;return n._maxPrimitivesPerLeaf=t,n.isBVH=!0,n.process=function(e,t){f.callWithProfile("BVH setup bounds info",n._setupBoundsInfo,[e,t]),f.callWithProfile("BVH build tree",n._buildTree,[]),f.callWithProfile("BVH flatten",n._flatten,[]),n._debugMesh=null},n._setupBoundsInfo=function(e,t){n._boundsInfos=[];for(var r=0;r<t.length;r+=3){var a=t.slice(r,r+3);f.copyTypedArray(3,d,0,e,4*a[0]),f.copyTypedArray(3,p,0,e,4*a[1]),f.copyTypedArray(3,m,0,e,4*a[2]);var o=(new h).fromVertexes(d,p,m);n._boundsInfos.push({indexes:a,bounds:o})}},n._buildTree=function(){n._rootNode=n._buildRecursive(0,n._boundsInfos.length,0)},n._flatten=function(){n._bvhLeaves=[],n._bvhNodes=[];var e={maxDepth:1,nodes:[],leaves:[]};n._traverseNode(n._rootNode,e);var t=e.maxDepth,r=e.nodes,a=e.leaves,o=new ArrayBuffer(4*(r.length+a.length)),i=new Float32Array(o),s=new Uint32Array(o),u=r.length;n._bvhMaxDepth=t,i.set(r),s.set(a,u);for(var l=0;l<u;l+=8)for(var c=0;c<8;c+=4){var f=l+c;2147483648&r[f]?s[f]=r[f]+u/4:s[f]=r[f]}n._bvhMaxDepth=e.maxDepth,n._bvhBuffer=i},n._traverseNode=function(e,t,r,a,o){void 0===r&&(r=1),void 0===a&&(a=-1),void 0===o&&(o=0),t.maxDepth=Math.max(r,t.maxDepth);var i=t.nodes,s=t.leaves,u=n,l=u._boundsInfos,c=u._bvhNodes,f=u._bvhLeaves;if(void 0!==e.infoEnd){f.push(e),a>=0&&(i[8*a+o]=1<<31|s.length/4);for(var h=e.infoEnd-e.infoStart,d=e.infoStart;d<e.infoEnd;d+=1){var p=l[d].indexes;s.push(h,p[0],p[1],p[2])}}else{c.push(e);var m=e.bounds,v=i.length/8;a>=0&&(i[8*a+o]=2*v),i.push(0,m.min[0],m.min[1],m.min[2],0,m.max[0],m.max[1],m.max[2]),n._traverseNode(e.child0,t,r+1,v,0),n._traverseNode(e.child1,t,r+1,v,4)}},n}return a(t,e),Object.defineProperty(t.prototype,"maxDepth",{get:function(){return this._bvhMaxDepth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._bvhBuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debugMesh",{get:function(){return this._debugMesh||this._buildDebugMesh(),this._debugMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodesCount",{get:function(){return this._bvhNodes.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leavesCount",{get:function(){return this._bvhLeaves.length},enumerable:!1,configurable:!0}),t.prototype._buildRecursive=function(e,t,n){for(var r=this._boundsInfos,a=(new h).initEmpty(),o=e;o<t;o+=1)a.mergeBounds(r[o].bounds);var i=t-e;if(i<=this._maxPrimitivesPerLeaf)return{infoStart:e,infoEnd:t,bounds:a};var s=(new h).initEmpty();for(o=e;o<t;o+=1)s.update(r[o].bounds.center);var u=s.maxExtends,l=Math.floor((e+t)/2);if(i<=4)f.nthElement(r,(function(e,t){return e.bounds.center[u]<t.bounds.center[u]}),e,t,l);else{if(s.max[u]===s.min[u])return{infoStart:e,infoEnd:t,bounds:a};var c=[];for(o=0;o<12;o+=1)c.push({bounds:(new h).initEmpty(),count:0});for(o=e;o<t;o+=1){var d=Math.floor(c.length*s.getOffset(u,r[o].bounds.center));d===c.length&&(d=c.length-1),c[d].count+=1,c[d].bounds.mergeBounds(r[o].bounds)}var p=[];for(o=0;o<c.length-1;o+=1){for(var m=(new h).initEmpty(),v=(new h).initEmpty(),g=0,b=0,y=0;y<=o;y+=1)m.mergeBounds(c[y].bounds),g+=c[y].count;for(y=o+1;y<c.length;y+=1)v.mergeBounds(c[y].bounds),b+=c[y].count;p.push(.1+(g*m.surfaceArea+b*v.surfaceArea)/a.surfaceArea)}var _=p[0],x=0;for(o=1;o<p.length;o+=1)p[o]<_&&(_=p[o],x=o);l=f.partition(r,(function(e){var t=Math.floor(c.length*s.getOffset(u,e.bounds.center));return t===c.length&&(t=c.length-1),t<=x}),e,t)}var w=this._buildRecursive(e,l,n+1),M=this._buildRecursive(l,t,n+1);return{axis:u,bounds:(new h).initEmpty().mergeBounds(w.bounds).mergeBounds(M.bounds),child0:w,child1:M,depth:n}},t.prototype._buildDebugMesh=function(){var e,t=this._bvhNodes,n=this._bvhMaxDepth,r=t.length,a=new Float32Array(8*r*3),o=new Float32Array(8*r*3);e=new Uint32Array(24*r);var u=new Array(n).fill(0),f=new Array(n).fill(0);t.forEach((function(e){u[e.depth]+=1}));var h=0;t.forEach((function(t){for(var r=t.bounds.buildBox("lines"),i=8*h,s=8*h*3,l=8*h*3,c=h*r.indexes.length,d=function(e,t,n){var r,a,o;if(0==t)r=a=o=n;else{var i=n+t-n*t,s=1-i;r=g(s,i,e+1/3),a=g(s,i,e),o=g(s,i,e-1/3)}return[r,a,o]}(t.depth/n,f[t.depth]/u[t.depth]*.7+.3,.5),p=0;p<24;p+=3)o.set(d,l+p);e.set(r.indexes.map((function(e){return e+i})),c),a.set(r.positions,s),h+=1,f[t.depth]+=1})),this._debugMesh=new c.default(new s.default([{layout:{attributes:[{name:"position",shaderLocation:0,format:"float32x3",offset:0}],arrayStride:12},data:a},{layout:{attributes:[{name:"color_0",shaderLocation:1,format:"float32x3",offset:0}],arrayStride:12},data:o}],e,e.length),new l.default(i.buildinEffects.rColor,{u_color:new Float32Array([1,1,1,.4])},void 0,{primitiveType:"line-list",cullMode:"none",blendColor:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},blendAlpha:{srcFactor:"zero",dstFactor:"one"}}))},t.CLASS_NAME="BVH",t}(u.default);function g(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}t.default=v},3179:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(8872),i=n(1119),s=n(7568),u=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(3),f=new Float32Array(4),h=new Float32Array(16),d=new Float32Array([0,1,0]),p=function(e){function t(t){void 0===t&&(t="free");var n=e.call(this)||this;n._mode=t,n.isNodeControl=!0,n._start=!1,n._handleStart=function(e){n._x=e.clientX,n._y=e.clientY,"arc"===n._mode&&(n._arcRadius=o.vec3.distance(o.mat4.getTranslation(u,n._target.worldMat),o.mat4.getTranslation(l,n._node.worldMat))),n._start=!0},n._handleEnd=function(){n._start=!1},n._handleMove=function(e){var t=n,r=t._start,a=t._node,i=t._x,s=t._y;if(r&&a){var p=e.clientX,m=e.clientY,v=(p-i)/200,g=(m-s)/200;if("free"===n._mode){o.quat.rotateX(a.quat,a.quat,g),o.quat.invert(f,a.quat);var b=new Float32Array([0,1,0]);o.vec3.transformQuat(b,b,f),o.quat.setAxisAngle(f,b,v),o.quat.multiply(a.quat,a.quat,f)}else{o.mat4.getTranslation(u,n._target.worldMat),o.mat4.getTranslation(l,n._node.worldMat),l[0]+=2*v,l[1]+=2*g;var y=o.vec3.sub(c,u,l);o.vec3.normalize(y,y),o.vec3.scale(y,y,-n._arcRadius),o.vec3.add(l,u,y),o.mat4.lookAt(h,l,u,d),n._node.pos.set(l),o.mat4.getRotation(n._node.quat,h)}n._x=p,n._y=m,n.onChange&&n.onChange()}},n._handleZoom=function(e){var t=n._node,r=t.worldMat,a=t.pos,i=e.deltaY/200,s=r.slice(8,12);"arc"===n._mode&&(o.mat4.getTranslation(u,n._target.worldMat),o.mat4.getTranslation(l,n._node.worldMat),o.vec3.sub(s,u,l),i=-i),o.vec3.normalize(s,s),o.vec3.scale(s,s,i),o.vec3.add(a,a,s),"arc"===n._mode&&(n._arcRadius+=i),n.onChange&&n.onChange()},n._handleTouchStart=function(e){var t=e.targetTouches[0];n._touchId=t.identifier,n._handleStart(t)},n._handleTouchMove=function(e){if(n._start){for(var t=0;t<e.targetTouches.length;t+=1){var r=e.targetTouches[t];if(r.identifier===n._touchId)return n._handleMove(r)}n._handleEnd()}};var r=i.default.canvas;return r.addEventListener("mousedown",n._handleStart),r.addEventListener("mouseup",n._handleEnd),r.addEventListener("mouseleave",n._handleEnd),r.addEventListener("mouseout",n._handleEnd),r.addEventListener("mousemove",n._handleMove),r.addEventListener("wheel",n._handleZoom),r.addEventListener("touchstart",n._handleTouchStart),r.addEventListener("touchend",n._handleEnd),r.addEventListener("touchcancel",n._handleEnd),r.addEventListener("touchmove",n._handleTouchMove),n}return a(t,e),t.prototype.control=function(e,t){if(this._node=e,this._target=t,!t&&"arc"===this._mode)throw new Error("Mode arc must be given target!")},t.CLASS_NAME="NodeControl",t}(s.default);t.default=p},8072:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EPBRMaterialType=void 0;var o,i=n(8872),s=n(5927),u=n(3067),l=n(31),c=n(7568),f=n(25),h=n(1566),d=n(1119),p=n(4329),m=n(5879),v=n(7408);!function(e){e[e.METAL_ROUGH=0]="METAL_ROUGH",e[e.SPEC_GLOSS=1]="SPEC_GLOSS",e[e.GLASS_METAL_ROUGH=2]="GLASS_METAL_ROUGH",e[e.GLASS_SPEC_GLOSS=3]="GLASS_SPEC_GLOSS"}(o=t.EPBRMaterialType||(t.EPBRMaterialType={}));var g=function(e){function t(t){void 0===t&&(t=1);var n=e.call(this)||this;return n._maxPrimitivesPerBVHLeaf=t,n.isRayTracingManager=!0,n._materials=[],n._buildAttributeBuffers=function(e){var t=n._materials,r=0,a=0;e.forEach((function(e){a+=e.geometry.vertexCount,r+=e.geometry.count}));for(var o=(n._indexInfo={value:new Uint32Array(r)}).value,s=n._attributesInfo={position:{value:new Float32Array(4*a),length:4,format:"float32x3"},texcoord_0:{value:new Float32Array(2*a),length:2,format:"float32x2"},normal:{value:new Float32Array(4*a),length:4,format:"float32x3"},meshMatIndex:{value:new Uint32Array(2*a),length:2,format:"uint32x2"}},u=s.position,l=s.texcoord_0,c=s.normal,f=s.meshMatIndex,h=0,d=0,p=0;p<e.length;p+=1){var m=e[p],v=m.worldMat,g=i.mat4.getRotation(new Float32Array(4),v),b=m.geometry,y=m.material,_=b.indexData,x=b.vertexInfo,w=b.vertexCount,M=b.count;if("rPBR"!==y.effect.name)throw new Error("Only support Effect rPBR!");var S=t.indexOf(y);S<0&&(t.push(y),S=t.length-1),_.forEach((function(e,t){o[t+d]=e+h})),x.normal||b.calculateNormals();for(var T=0;T<w;T+=1)n._copyAttribute(x.position,u,h,T,v),n._copyAttribute(x.texcoord_0,l,h,T),n._copyAttribute(x.normal,c,h,T,g,!0),f.value.set([p,S],(h+T)*f.length);d+=M,h+=w}},n._buildCommonUniforms=function(e){var t=new Int32Array(4*e.length).fill(-1),r=new Float32Array(4*e.length).fill(1),a=new Float32Array(4*e.length).fill(1),i=new Float32Array(4*e.length).fill(1),u=[],l=[],c=[];e.forEach((function(e,f){var h=e.marcos.USE_GLASS,d=e.marcos.USE_SPEC_GLOSS,p=e.getUniform("u_baseColorFactor"),m=e.getUniform("u_metallicFactor"),v=e.getUniform("u_roughnessFactor"),g=e.getUniform("u_specularFactor"),b=e.getUniform("u_glossinessFactor"),y=e.getUniform("u_normalTextureScale"),_=e.getUniform("u_baseColorTexture"),x=e.getUniform("u_normalTexture"),w=e.getUniform("u_metallicRoughnessTexture"),M=e.getUniform("u_specularGlossinessTexture"),S=4*f;_!==s.buildinTextures.empty&&n._setTextures(S,u,_,t),x!==s.buildinTextures.empty&&n._setTextures(S+1,l,x,t),p&&r.set(p,4*f),void 0!==y&&a.set(y.slice(0,1),4*f+2),d?(void 0!==g&&i.set(g.slice(0,3),4*f),void 0!==b&&i.set(b.slice(0,1),4*f+3),M!==s.buildinTextures.empty&&n._setTextures(S+2,c,M,t),a.set([h?o.GLASS_SPEC_GLOSS:o.SPEC_GLOSS],4*f+3)):(void 0!==m&&a.set(m.slice(0,1),4*f),void 0!==v&&a.set(v.slice(0,1),4*f+1),w!==s.buildinTextures.empty&&n._setTextures(S+2,c,w,t),a.set([h?o.GLASS_METAL_ROUGH:o.METAL_ROUGH],4*f+3))})),n._commonUniforms={matId2TexturesId:t,baseColorFactors:r,metallicRoughnessFactorNormalScaleMaterialTypes:a,specularGlossinessFactors:i,baseColorTextures:n._generateTextureArray(u),normalTextures:n._generateTextureArray(l),metalRoughOrSpecGlossTextures:n._generateTextureArray(c)}},n._buildGBufferMesh=function(){var e=n,t=e._attributesInfo,r=e._indexInfo,a=e._commonUniforms,o=new l.default(Object.keys(t).map((function(e,n){var r=t[e],a=r.value;return{layout:{arrayStride:4*r.length,attributes:[{name:e,offset:0,format:r.format,shaderLocation:n}]},data:a,usage:GPUBufferUsage.STORAGE}})),r.value,r.value.length),i=new f.default(s.buildinEffects.rRTGBuffer,{u_matId2TexturesId:a.matId2TexturesId,u_baseColorFactors:a.baseColorFactors,u_metallicRoughnessFactorNormalScaleMaterialTypes:a.metallicRoughnessFactorNormalScaleMaterialTypes,u_specularGlossinessFactors:a.specularGlossinessFactors,u_baseColorTextures:a.baseColorTextures,u_normalTextures:a.normalTextures,u_metalRoughOrSpecGlossTextures:a.metalRoughOrSpecGlossTextures});n._gBufferMesh=new h.default(o,i)},n._buildRTUnit=function(e){var t=n,r=t._gBufferMesh,a=t._commonUniforms,o=t._bvh,i=r.geometry;n._rtUnit=new u.default(s.buildinEffects.cRTSS,{x:Math.ceil(d.default.width/16),y:Math.ceil(d.default.height/16)},{u_output:e,u_matId2TexturesId:a.matId2TexturesId,u_baseColorFactors:a.baseColorFactors,u_metallicRoughnessFactorNormalScaleMaterialTypes:a.metallicRoughnessFactorNormalScaleMaterialTypes,u_specularGlossinessFactors:a.specularGlossinessFactors,u_baseColorTextures:a.baseColorTextures,u_normalTextures:a.normalTextures,u_metalRoughOrSpecGlossTextures:a.metalRoughOrSpecGlossTextures,u_bvh:o.buffer},{BVH_DEPTH:n._bvh.maxDepth});var l=i.getValues("position");n._rtUnit.setUniform("u_positions",l.cpu,l.gpu),l=i.getValues("texcoord_0"),n._rtUnit.setUniform("u_uvs",l.cpu,l.gpu),l=i.getValues("normal"),n._rtUnit.setUniform("u_normals",l.cpu,l.gpu),l=i.getValues("meshmatindex"),n._rtUnit.setUniform("u_meshMatIndexes",l.cpu,l.gpu),console.log(n._materials)},n._bvh=new v.default(t),n}return a(t,e),Object.defineProperty(t.prototype,"gBufferMesh",{get:function(){return this._gBufferMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rtUnit",{get:function(){return this._rtUnit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bvhDebugMesh",{get:function(){return this._bvh.debugMesh},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bvh",{get:function(){return this._bvh},enumerable:!1,configurable:!0}),t.prototype.process=function(e,t){this.meshes=e,p.callWithProfile("build AttributeBuffers",this._buildAttributeBuffers,[e]),p.callWithProfile("build CommonUniforms",this._buildCommonUniforms,[this._materials]),p.callWithProfile("build GBufferMesh",this._buildGBufferMesh,[]),this._bvh.process(this._attributesInfo.position.value,this._indexInfo.value),p.callWithProfile("build RTUnit",this._buildRTUnit,[t]),console.log("Build done(max primitives per leaf is "+this._maxPrimitivesPerBVHLeaf+"): mesh("+e.length+"), material("+this._materials.length+"), vertexes("+this._attributesInfo.position.value.length/3+"), triangles("+this._indexInfo.value.length/3+"), bvhNodes("+this._bvh.nodesCount+"), bvhLeaves("+this._bvh.leavesCount+"), bvhDepth("+this._bvh.maxDepth+")")},t.prototype._copyAttribute=function(e,t,n,r,a,o){var s=e.offset+r*e.stride,u=e.data.slice(s,s+e.length);a&&(o?i.vec3.transformQuat(u,u,a):i.vec3.transformMat4(u,u,a)),t.value.set(u,(n+r)*t.length)},t.prototype._setTextures=function(e,t,n,r){if(n){var a=t.indexOf(n);a<0&&(t.push(n),a=t.length-1),r[e]=a}},t.prototype._generateTextureArray=function(e){if(!e.length)return s.buildinTextures.array1white;var n=0,r=0;e.forEach((function(e){n=Math.max(n,e.width),r=Math.max(r,e.height)}));var a=e.map((function(e){if(e.width===n&&e.height===r)return e.source;if(!(e.source instanceof ImageBitmap))throw new Error("Can only resize image bitmap!");t.RESIZE_CANVAS||(t.RESIZE_CANVAS=document.createElement("canvas"),t.RESIZE_CANVAS.width=2048,t.RESIZE_CANVAS.height=2048,t.RESIZE_CTX=t.RESIZE_CANVAS.getContext("2d"));var a=t.RESIZE_CTX;return a.drawImage(e.source,0,0,n,r),a.getImageData(0,0,n,r).data.buffer}));return new m.default(n,r,a,e[0].format)},t.CLASS_NAME="RayTracingManager",t}(c.default);t.default=g},3920:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.math=t.init=void 0;var s=n(1119),u=n(8872),l=n(822);Object.defineProperty(t,"Scene",{enumerable:!0,get:function(){return l.default}});var c=n(9280);Object.defineProperty(t,"Node",{enumerable:!0,get:function(){return c.default}});var f=n(3278);Object.defineProperty(t,"Camera",{enumerable:!0,get:function(){return f.default}});var h=n(4855);Object.defineProperty(t,"Light",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"EAreaLightMode",{enumerable:!0,get:function(){return h.EAreaLightMode}}),Object.defineProperty(t,"ELightType",{enumerable:!0,get:function(){return h.ELightType}});var d=n(31);Object.defineProperty(t,"Geometry",{enumerable:!0,get:function(){return d.default}});var p=n(582);Object.defineProperty(t,"UBTemplate",{enumerable:!0,get:function(){return p.default}});var m=n(5553);Object.defineProperty(t,"Effect",{enumerable:!0,get:function(){return m.default}});var v=n(25);Object.defineProperty(t,"Material",{enumerable:!0,get:function(){return v.default}});var g=n(1566);Object.defineProperty(t,"Mesh",{enumerable:!0,get:function(){return g.default}});var b=n(3862);Object.defineProperty(t,"ImageMesh",{enumerable:!0,get:function(){return b.default}});var y=n(3067);Object.defineProperty(t,"ComputeUnit",{enumerable:!0,get:function(){return y.default}});var _=n(2581);Object.defineProperty(t,"RenderTexture",{enumerable:!0,get:function(){return _.default}});var x=n(5879);Object.defineProperty(t,"Texture",{enumerable:!0,get:function(){return x.default}});var w=n(7101);Object.defineProperty(t,"CubeTexture",{enumerable:!0,get:function(){return w.default}});var M=n(1119);Object.defineProperty(t,"renderEnv",{enumerable:!0,get:function(){return M.default}});var S=n(8072);Object.defineProperty(t,"RayTracingManager",{enumerable:!0,get:function(){return S.default}});var T=n(7408);Object.defineProperty(t,"BVH",{enumerable:!0,get:function(){return T.default}});var O=n(3179);Object.defineProperty(t,"NodeControl",{enumerable:!0,get:function(){return O.default}});var P=n(5953);Object.defineProperty(t,"resource",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(t,"Resource",{enumerable:!0,get:function(){return P.Resource}});var I=n(5137);Object.defineProperty(t,"TextureLoader",{enumerable:!0,get:function(){return I.default}});var A=n(2868);Object.defineProperty(t,"GlTFLoader",{enumerable:!0,get:function(){return A.default}});var E=n(5927);a(n(5927),t);var C=n(4329);Object.defineProperty(t,"createGPUBuffer",{enumerable:!0,get:function(){return C.createGPUBuffer}}),Object.defineProperty(t,"createGPUBufferBySize",{enumerable:!0,get:function(){return C.createGPUBufferBySize}}),t.init=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,s.default.init(e)];case 1:return t.sent(),[4,E.init()];case 2:return t.sent(),[4,s.default.createGlobal(E.buildinUBTemplates.global)];case 3:return t.sent(),[2]}}))}))},t.math={vec2:u.vec2,vec3:u.vec3,vec4:u.vec4,quat:u.quat,quat2:u.quat2,mat2:u.mat2,mat3:u.mat3,mat4:u.mat4},window.H=this},2868:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5927),u=n(9280),l=n(3278),c=n(31),f=n(25),h=n(1566),d=n(5879),p=n(482),m=n(4855),v=n(7101),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isGlTFLoader=!0,t._buffers=[],t}return a(t,e),t.prototype.load=function(e,t){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return(t=e.split("/")).pop(),this._baseUri=t.join("/"),n=this,[4,this.request(e,"json")];case 1:return n._json=r.sent(),[4,this._loadBuffers()];case 2:return r.sent(),this._res={rootNode:new u.default,nodes:[],meshes:[],images:[],textures:[],cubeTextures:[],materials:[],cameras:[],lights:[]},[4,this._loadImages()];case 3:return r.sent(),[4,this._loadTextures()];case 4:return r.sent(),[4,this._loadCubeTextures()];case 5:return r.sent(),[4,this._loadMaterials()];case 6:return r.sent(),[4,this._loadMeshes()];case 7:return r.sent(),[4,this._loadCameras()];case 8:return r.sent(),[4,this._loadLights()];case 9:return r.sent(),[4,this._loadNodes()];case 10:return r.sent(),[2,this._res]}}))}))},t.prototype._loadBuffers=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o;return i(this,(function(i){switch(i.label){case 0:e=this._json.buffers,t=0,n=e,i.label=1;case 1:return t<n.length?(r=n[t].uri,o=(a=this._buffers).push,[4,this.request(this._baseUri+"/"+r,"buffer")]):[3,4];case 2:o.apply(a,[i.sent()]),i.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))},t.prototype._loadImages=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o,s;return i(this,(function(i){switch(i.label){case 0:if(e=this._json.images,t=this._res.images,!e)return[2];n=0,r=e,i.label=1;case 1:return n<r.length?(a=r[n].uri,[4,this._loadImage(this._baseUri+"/"+a)]):[3,5];case 2:return o=i.sent(),[4,createImageBitmap(o)];case 3:s=i.sent(),t.push(s),i.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},t.prototype._loadTextures=function(){var e,t,n;return o(this,void 0,void 0,(function(){var r,a,o,s,u,l,c,f,h,p,m;return i(this,(function(i){if(r=this._json,a=r.textures,o=r.images,s=this._res,u=s.images,l=s.textures,!a)return[2];for(c=0,f=a;c<f.length;c++)h=f[c].source,p=u[h],m=new d.default(p.width,p.height,p),"HDR"===(null===(e=o.extras)||void 0===e?void 0:e.type)&&(null===(t=o.extras)||void 0===t||t.format),null===(n=o.extras)||void 0===n||n.isNormalMap,l.push(m);return[2]}))}))},t.prototype._loadCubeTextures=function(){var e,t;return o(this,void 0,void 0,(function(){var n,r,a,o,s,u,l,c,f;return i(this,(function(i){switch(i.label){case 0:if(n=null===(t=null===(e=this._json.extensions)||void 0===e?void 0:e.Sein_cubeTexture)||void 0===t?void 0:t.textures,r=this._res,a=r.images,o=r.cubeTextures,!n)return[2];s=0,u=n,i.label=1;case 1:return s<u.length?(l=u[s].images,[4,Promise.all(l.map((function(e){return createImageBitmap(a[e])})))]):[3,4];case 2:c=i.sent(),f=new v.default(c[0].width,c[1].width,c),c.forEach((function(e){return e.close()})),o.push(f),i.label=3;case 3:return s++,[3,1];case 4:return[2]}}))}))},t.prototype._loadMaterials=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o,u,l,c,h,d,p,m,v,g,b,y,_,x,w,M,S,T,O,P,I,A;return i(this,(function(i){for(this._buffers,e=this._json.materials,t=this._res,n=t.materials,r=t.textures,a=0,o=e;a<o.length;a++)u=o[a],l=u.name,c=u.pbrMetallicRoughness,h=u.normalTexture,d=u.alphaMode,p=u.extensions,m=s.buildinEffects.rPBR,v={},g={},h&&(v.u_normalTexture=r[h.index],v.u_normalTextureScale=h.scale),c&&(b=c.baseColorTexture,y=c.metallicFactor,_=c.baseColorFactor,x=c.roughnessFactor,w=c.metallicRoughnessTexture,b&&(v.u_baseColorTexture=r[b.index]),w&&(v.u_metallicRoughnessTexture=r[w.index]),v.u_baseColorFactor=_,v.u_metallicFactor=y,v.u_roughnessFactor=x),(null==p?void 0:p.KHR_materials_pbrSpecularGlossiness)&&(M=null==p?void 0:p.KHR_materials_pbrSpecularGlossiness,S=M.diffuseFactor,T=M.diffuseTexture,O=M.specularFactor,P=M.glossinessFactor,I=M.specularGlossinessTexture,g.USE_SPEC_GLOSS=!0,T&&(v.u_baseColorTexture=r[T.index]),I&&(v.u_specularGlossinessTexture=r[I.index]),v.u_baseColorFactor=S,v.u_specularFactor=O,v.u_glossinessFactor=P),"BLEND"===d&&(g.USE_GLASS=!0),(A=new f.default(m,v,g)).name=l,n.push(A);return[2]}))}))},t.prototype._loadMeshes=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o,s,l,c,f,h,d,p,m;return i(this,(function(i){switch(i.label){case 0:e=this._json.meshes,t=this._res.meshes,n=0,r=e,i.label=1;case 1:return n<r.length?(a=r[n],o=a.primitives,s=a.name,1!==o.length?[3,3]:[4,this._createMesh(o[0])]):[3,9];case 2:return(l=i.sent()).name=s,t.push(l),[3,8];case 3:(c=new u.default).name=s,f=0,h=o,i.label=4;case 4:return f<h.length?(d=h[f],m=(p=c).addChild,[4,this._createMesh(d)]):[3,7];case 5:m.apply(p,[i.sent()]),i.label=6;case 6:return f++,[3,4];case 7:t.push(c),i.label=8;case 8:return n++,[3,1];case 9:return[2]}}))}))},t.prototype._loadCameras=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o,u,c,h,d,p,m,v,g,b;return i(this,(function(i){if(e=this._json.cameras,t=this._res,n=t.cameras,r=t.cubeTextures,!e)return[2];for(a=0,o=e;a<o.length;a++)u=o[a],c=u.perspective,h=u.orthographic,d=u.type,p=u.name,m=u.extensions,v=void 0,(v="perspective"===d?new l.default({},{near:c.znear,far:c.zfar,fov:1/c.yfov}):new l.default({},{isOrth:!0,near:h.znear,far:h.zfar,sizeX:h.xmag,sizeY:h.ymag})).name=p,(g=m&&m.Sein_skybox)&&("Cube"!==g.type?console.warn("Only support cube texture skybox now!"):(b=new f.default(s.buildinEffects.rSkybox,{u_factor:new Float32Array([g.factor]),u_color:new Float32Array(g.color),u_cubeTexture:r[g.texture.index],u_rotation:new Float32Array([g.rotation]),u_exposure:new Float32Array([g.exposure])}),v.skyboxMat=b)),n.push(v);return[2]}))}))},t.prototype._loadLights=function(){var e,t;return o(this,void 0,void 0,(function(){var n,r,a,o,s,u,l,c,f,h,d,p;return i(this,(function(i){if(!this._json.extensions)return[2];if(n=null===(t=null===(e=this._json.extensions)||void 0===e?void 0:e.KHR_lights_punctual)||void 0===t?void 0:t.lights,r=this._res.lights,n)for(a=function(e,t,n,a,o,i){if("directional"!==t&&"area"!==t)throw new Error("Only support directional and area light now!");var s=new m.default("directional"===t?m.ELightType.Directional:m.ELightType.Area,a.map((function(e){return e*n})),"directional"===t?{}:{mode:"rect"===o?m.EAreaLightMode.Rect:m.EAreaLightMode.Disc,size:i});s.name=e,r.push(s)},o=0,s=n;o<s.length;o++)u=s[o],l=u.name,c=u.type,f=u.intensity,h=u.color,d=u.mode,p=u.size,a(l,c,f,h,d,p);return[2]}))}))},t.prototype._loadNodes=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,a,o,s,l,c,f,h,d,p,m,v,g,b,y,_,x,w,M,S,T,O,P,I,A;return i(this,(function(i){for(e=this._json,t=e.nodes,n=e.scenes,r=this._res,a=r.rootNode,o=r.nodes,s=r.meshes,l=r.cameras,c=r.lights,f=0,h=t;f<h.length;f++)d=h[f],p=d.matrix,m=d.name,v=d.extensions,g=d.mesh,b=d.camera,w=void 0,(w=void 0!==g?s[g].clone():void 0!==b?l[b]:(null==v?void 0:v.KHR_lights_punctual)?c[v.KHR_lights_punctual.light]:new u.default).name=m,p&&w.setLocalMat(p),o.push(w);for(y=0,_=0,x=o;_<x.length;_++){if(w=x[_],M=t[y].children)for(S=0,T=M;S<T.length;S++)O=T[S],w.addChild(o[O]);y+=1}for(P=0,I=n[0].nodes;P<I.length;P++)A=I[P],a.addChild(o[A]);return[2]}))}))},t.prototype._createMesh=function(e){return o(this,void 0,void 0,(function(){var t,n,r,a,o,s,u,l,f,d,p,m,v,g,b,y,_,x,w,M,S,T,O,P,I,A,E;return i(this,(function(i){for(p in t=this._buffers,n=this._json,r=n.accessors,a=n.bufferViews,o=this._res.materials,s=[],u=0,l=0,e.attributes)m=r[e.attributes[p]],v=m.bufferView,g=m.byteOffset,b=m.componentType,y=m.type,_=m.max,x=m.min,w=a[v],M=this._convertVertexFormat(y,b),S=M[0],T=M[1],u+=T,f=f||new Float32Array(t[w.buffer],w.byteOffset||0,w.byteLength/4),"POSITION"===p&&3===(null==_?void 0:_.length)&&3===(null==x?void 0:x.length)&&(d=this._getBoundingBox(_,x)),s.push({name:p.toLowerCase(),format:S,offset:g||0,shaderLocation:l}),l+=1;return O=r[e.indices],P=a[O.bufferView],I=new Uint16Array(t[P.buffer],P.byteOffset,P.byteLength/2),A=new c.default([{layout:{arrayStride:u,attributes:s},data:f}],I,O.count,d),E=o[e.material],[2,new h.default(A,E)]}))}))},t.prototype._convertVertexFormat=function(e,t){if(5126!==t)throw new Error("Only support componentType float!");switch(e){case"SCALE":return["float32",4];case"VEC2":return["float32x2",8];case"VEC3":return["float32x3",12];case"VEC4":return["float32x4",16]}throw new Error("Not support type "+e+"!")},t.prototype._getBoundingBox=function(e,t){return{start:t,center:e.map((function(e,n){return(e+t[n])/2})),size:e.map((function(e,n){return e-t[n]}))}},t.prototype._loadImage=function(e){return o(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return(t=document.createElement("img")).src=e,[4,t.decode()];case 1:return n.sent(),[2,t]}}))}))},t.CLASS_NAME="GlTFLoader",t}(p.default);t.default=g},482:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isLoader=!0,t}return a(t,e),t.prototype.request=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new Promise((function(n,r){var a=new XMLHttpRequest;a.onload=function(){if(a.status<200||a.status>=300)r(new TypeError("Network request failed for "+a.status));else{var e="response"in a?a.response:a.responseText;if("json"===t)try{e=JSON.parse(e)}catch(e){return void r(new TypeError("JSON.parse error"+e))}n(e)}},a.onerror=function(){r(new TypeError("Network request failed"))},a.ontimeout=function(){r(new TypeError("Network request timed out"))},a.open("GET",e,!0),"buffer"===t&&(a.responseType="arraybuffer"),a.send()}))]}))}))},t.CLASS_NAME="Loader",t}(n(7568).default);t.default=s},5137:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5879),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isTextureLoader=!0,t}return a(t,e),t.prototype.load=function(e,t){return o(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return(t=document.createElement("img")).src=e,[4,t.decode()];case 1:return r.sent(),[4,createImageBitmap(t)];case 2:return n=r.sent(),[2,new s.default(t.naturalHeight,t.naturalHeight,n)]}}))}))},t.CLASS_NAME="TextureLoader",t}(n(482).default);t.default=u},5953:function(e,t,n){"use strict";var r,a=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Resource=void 0;var s=n(7568),u=n(5137),l=n(2868),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isResource=!0,t._loaders={},t._resources={},t}return a(t,e),t.prototype.register=function(e,t){this._loaders[e]=t},t.prototype.load=function(e,t){return o(this,void 0,void 0,(function(){var n=this;return i(this,(function(r){return this._resources[e.name]?[2,this._resources[e.name]]:[2,this._loaders[e.type].load(e.src,t||{}).then((function(t){return n._resources[e.name]=t,t}))]}))}))},t.prototype.get=function(e){return this._resources[e]},t.CLASS_NAME="Resource",t}(s.default);t.Resource=c;var f=new c;f.register("texture",new u.default),f.register("gltf",new l.default),t.default=f}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(7583)})();